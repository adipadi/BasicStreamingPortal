(function(){var g={};
(function(window){var k,aa=this;function n(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function q(a,b){function c(){}c.prototype=b.prototype;a.Pc=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Mc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}aa.COMPILED=!1;/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function r(){}function ba(){}function ca(){}console.assert||(console.assert=function(){});r=function(a,b){var c=b;if(!a&&!c)try{throw Error();}catch(d){c=d.stack.split("\n")[2]}console.assert(a,c)};ba=console.assert.bind(console,!1,"Not implemented.");ca=console.assert.bind(console,!1,"Unreachable reached.");function u(){}function v(){}function w(){}function x(){}function y(){}function da(){}function ea(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}ea("error");ea("warn");ea("info");ea("log");ea("debug");
n("shaka.log.setLevel",function(a){function b(){}u=1<=a?console.error.bind(console):b;v=2<=a?console.warn.bind(console):b;w=3<=a?console.info.bind(console):b;x=4<=a?console.log.bind(console):b;y=5<=a?console.debug.bind(console):b;da=6<=a?console.debug.bind(console):b});n("shaka.log.Level",{NONE:0,ERROR:1,Lc:2,Ic:3,Hc:4,Jc:5,Kc:6});n("shaka.log.Level.NONE",0);n("shaka.log.Level.ERROR",1);n("shaka.log.Level.WARNING",2);n("shaka.log.Level.INFO",3);n("shaka.log.Level.DEBUG",4);
n("shaka.log.Level.V1",5);n("shaka.log.Level.V2",6);u=console.error.bind(console);v=console.warn.bind(console);w=console.info.bind(console);function ga(a){ha[a]={ua:ia(),end:NaN}}function ja(a){var b=ha[a];b&&(b.end=ia(),x(a+": "+(b.end-b.ua).toFixed(3)+"ms"))}function ka(a){return(a=ha[a])&&a.end?a.end-a.ua:NaN}var ia=window.performance&&window.performance.now?window.performance.now.bind(window.performance):function(){return(new Date).getTime()},ha={};function la(a,b,c){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.active=!1}n("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function ma(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}ma.prototype.clone=function(){var a=new ma;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};n("shaka.player.Restrictions",ma);function na(){this.fontSize="100%";this.fontColor=oa;this.fontOpacity=pa;this.backgroundColor=qa;this.backgroundOpacity=pa;this.fontEdge=ra}n("shaka.player.TextStyle",na);na.prototype.a=function(){var a=window.localStorage.getItem("ShakaPlayerTextStyle");if(a){var b;try{b=JSON.parse(a)}catch(c){v("Loaded garbage from TextStyle storage!");return}if(b&&"object"==typeof b){var a=b,d;for(d in a)d in this&&(this[d]=a[d])}else v("Loaded non-object from TextStyle storage!")}};na.prototype.load=na.prototype.a;
na.prototype.b=function(){window.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))};na.prototype.store=na.prototype.b;
function sa(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+ta(a.fontColor,a.fontOpacity));b.push("background-color: "+ta(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){r(6==a.fontEdge[d].length);var e=a.fontEdge[d].slice(3,6);c.push(ta(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function ta(a,b){r(3==a.length);return"rgba("+a.concat(b).join(",")+")"}
var oa=[255,255,255],qa=[0,0,0];na.StandardColors={WHITE:oa,BLACK:qa,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var pa=1;na.StandardOpacities={OPAQUE:pa,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var ra=[];
na.EdgeStyles={NONE:ra,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function ua(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}n("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function va(a,b,c,d){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.active=!1}function wa(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}n("shaka.player.VideoTrack.compare",wa);function xa(){var a="CustomEvent"in window;if(a)try{new CustomEvent("")}catch(b){a=!1}a||(window.CustomEvent=ya)}n("shaka.polyfill.CustomEvent.install",xa);function ya(a,b){var c=document.createEvent("CustomEvent"),d=b||{bubbles:!1,cancelable:!1,detail:null};c.initCustomEvent(a,!!d.bubbles,!!d.cancelable,d.detail);return c};function za(){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen;a=Document.prototype;a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen;"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}});document.addEventListener("webkitfullscreenchange",
Aa);document.addEventListener("webkitfullscreenerror",Aa);document.addEventListener("mozfullscreenchange",Aa);document.addEventListener("mozfullscreenerror",Aa);document.addEventListener("MSFullscreenChange",Aa);document.addEventListener("MSFullscreenError",Aa)}n("shaka.polyfill.Fullscreen.install",za);function Aa(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),b=new Event(b,a);a.target.dispatchEvent(b)};function Ba(){x("PatchedMediaKeys.nop.requestMediaKeySystemAccess");r(this instanceof Navigator);return Promise.reject(Error("The key system specified is not supported."))}function Ca(a){x("PatchedMediaKeys.nop.setMediaKeys");r(this instanceof HTMLMediaElement);return null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Da(){throw new TypeError("Illegal constructor.");}Da.prototype.createSession=function(){};Da.prototype.setServerCertificate=function(){};
function Ea(){throw new TypeError("Illegal constructor.");}Ea.prototype.getConfiguration=function(){};Ea.prototype.createMediaKeys=function(){};function z(a){this.c=[];this.b=[];this.ha=Fa;if(a)try{a(this.na.bind(this),this.a.bind(this))}catch(b){this.a(b)}}var Fa=0;
function Ga(){window.Promise?w("Using native Promises."):(w("Using Promises polyfill."),window.Promise=z,window.Promise.resolve=Ha,window.Promise.reject=Ia,window.Promise.all=Ja,window.Promise.race=Ka,window.setImmediate?(La=function(a){return window.setImmediate(a)},Ma=function(a){return window.clearImmediate(a)}):(La=function(a){return window.setTimeout(a,0)},Ma=function(a){return window.clearTimeout(a)}))}n("shaka.polyfill.Promise.install",Ga);function Ha(a){var b=new z;b.na(a);return b}
function Ia(a){var b=new z;b.a(a);return b}function Ja(a){function b(a,b,c){r(1!=a.ha);a.ha==Fa&&(e[b]=c,d++,d==e.length&&a.na(e))}var c=new z;if(!a.length)return c.na([]),c;for(var d=0,e=Array(a.length),f=c.a.bind(c),g=0;g<a.length;++g)a[g]&&a[g].then?a[g].then(b.bind(null,c,g),f):b(c,g,a[g]);return c}function Ka(a){for(var b=new z,c=b.na.bind(b),d=b.a.bind(b),e=0;e<a.length;++e)a[e]&&a[e].then?a[e].then(c,d):c(a[e]);return b}
z.prototype.then=function(a,b){var c=new z;switch(this.ha){case 1:Na(this,c,a);break;case 2:Na(this,c,b);break;case Fa:this.c.push({kb:c,Ya:a}),this.b.push({kb:c,Ya:b})}return c};z.prototype.then=z.prototype.then;z.prototype.catch=function(a){return this.then(void 0,a)};z.prototype["catch"]=z.prototype.catch;z.prototype.na=function(a){if(this.ha==Fa){this.Ua=a;this.ha=1;for(a=0;a<this.c.length;++a)Na(this,this.c[a].kb,this.c[a].Ya);this.c=[];this.b=[]}};
z.prototype.a=function(a){if(this.ha==Fa){this.Ua=a;this.ha=2;for(a=0;a<this.b.length;++a)Na(this,this.b[a].kb,this.b[a].Ya);this.c=[];this.b=[]}};function Na(a,b,c){r(a.ha!=Fa);Oa.push(function(){if(c&&"function"==typeof c){try{var a=c(this.Ua)}catch(e){b.a(e);return}a instanceof z?a==b?b.a(new TypeError("Chaining cycle detected")):a.then(b.na.bind(b),b.a.bind(b)):b.na(a)}else 1==this.ha?b.na(this.Ua):b.a(this.Ua)}.bind(a));null==Pa&&(Pa=La(Qa))}
function Qa(){for(;Oa.length;){null!=Pa&&(Ma(Pa),Pa=null);var a=Oa;Oa=[];for(var b=0;b<a.length;++b)a[b]()}}function La(){return 0}function Ma(){}var Pa=null,Oa=[];function Ra(){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=Sa)}n("shaka.polyfill.VideoPlaybackQuality.install",Ra);function Sa(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}};function Ta(a,b){for(var c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};function Ua(){return(new Date).getTime()+Va}var Va=0;function Wa(a){this.b=a;this.c=0==Xa;this.a=0}var Xa=1;function Ya(a){return a.a<a.b.byteLength}function Za(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function $a(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function ab(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function bb(a){r(!0);if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function cb(a,b){r(0<=b);if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function db(a){this.b=a;this.a=new Wa(a);eb||(eb=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var eb;
function fb(a){var b;b=gb(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=gb(a);a:{for(d=0;d<eb.length;d++)if(ib(c,eb[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);cb(a.a,c);return new jb(b,d)}function gb(a){var b=Za(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Za(a.a);return d}function jb(a,b){this.id=a;this.a=b}
function kb(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};function lb(a){var b=mb[a];r(b||"usable"===a||"output-downscaled"===a||"status-pending"===a,"Unexpected key status value: "+a);return b||null}var mb={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function nb(a){r(0<a);this.c=Math.exp(Math.log(.5)/a);this.a=this.b=0}nb.prototype.sample=function(a,b){var c=Math.pow(this.c,a);this.b=b*(1-c)+c*this.b;this.a+=a};function ob(a){var b=1-Math.pow(a.c,a.a);return a.b/b};function A(a){var b=new CustomEvent(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b?r(b[c]==a[c],"key = "+c):b[c]=a[c];return b}function B(a){r(null!=a);return new CustomEvent("error",{detail:a,bubbles:!0})};function pb(a,b,c){r(b==qb(b));r(c==qb(c));return c==b||a>=rb&&c==b.split("-")[0]||a>=sb&&c.split("-")[0]==b.split("-")[0]?!0:!1}var rb=1,sb=2;function qb(a){a=a.toLowerCase().split("-");var b=tb[a[0]];b&&(a[0]=b);return a.join("-")}
var tb={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function ub(a){return Object.keys(a).map(function(b){return a[b]})}function vb(a,b){return wb(a,b,"boolean")}function xb(a,b){var c=wb(a,b,"number");if(null==c)return null;if(isNaN(c)||c==Number.NEGATIVE_INFINITY||c==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(0>c)throw new RangeError("'"+b+"' must be >= 0");return c}function yb(a,b){return wb(a,b,"string")}
function wb(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function zb(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function E(){this.a={}}E.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};E.prototype.set=function(a,b){this.a[a]=b};E.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function Ab(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function Bb(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function Cb(a){var b=[],c;for(c in a.a)b.push(c);return b};function Db(){this.a=new E}Db.prototype.destroy=function(){Eb(this);this.a=null};function F(a,b,c,d){b=new Fb(b,c,d);a.a.push(c,b)}Db.prototype.Ka=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.Ka(),Bb(this.a,b,e))}};function Eb(a){for(var b=Ab(a.a),c=0;c<b.length;++c)b[c].Ka();a.a.a={}}function Fb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
Fb.prototype.Ka=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function G(a){this.Va=new E;this.M=a}n("shaka.util.FakeEventTarget",G);G.prototype.addEventListener=function(a,b,c){r(!c);c||this.Va.push(a,b)};G.prototype.removeEventListener=function(a,b,c){r(!c);c||Bb(this.Va,a,b)};
G.prototype.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return Gb(this,
a)};function Gb(a,b){b.currentTarget=a;for(var c=a.Va.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){u("Uncaught exception in event handler",f)}}a.M&&b.bubbles&&Gb(a.M,b);return b.defaultPrevented};function Hb(){G.call(this,null);this.a=new nb(3);this.c=new nb(10);this.b=0}q(Hb,G);n("shaka.util.EWMABandwidthEstimator",Hb);Hb.prototype.sample=function(a,b){if(!(2E4>b)){a=Math.max(a,50);var c=8E3*b/a,d=a/1E3;this.a.sample(d,c);this.c.sample(d,c);this.dispatchEvent(A({type:"bandwidth"}));this.b=(new Date).getTime()}};Hb.prototype.getBandwidth=function(){return.5>this.a.a?5E5:Math.min(ob(this.a),ob(this.c))};Hb.prototype.getDataAge=function(){return((new Date).getTime()-this.b)/1E3};
Hb.prototype.supportsCaching=function(){return!1};function H(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=H.prototype.destroy;return c}H.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function Ib(a){return a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function Jb(){this.g=new H;this.f=!1;this.a=null;this.b=[];this.c=null}function Kb(a,b){if(a.f)throw Error("Cannot append to a running task!");a.b.push(b)}Jb.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0;this.b.unshift(function(){});Lb(this,void 0)};Jb.prototype.end=function(){this.b.splice(1)};
function Lb(a,b){var c=a.b[0](b),d;c?(r(1==c.length||2==c.length),d=c[0],r(d),a.c=c[1]):(d=Promise.resolve(),a.c=null);d.then(I(a,function(a){this.a?(this.b=[],this.c=null,Mb(this)):(this.b.shift(),this.b.length?Lb(this,a):(this.g.resolve(a),this.c=null))})).catch(I(a,function(a){this.b=[];this.c=null;this.a?Mb(this):this.g.reject(a)}))}function Mb(a){r(a.g);r(a.a);var b=Error("Task aborted.");b.type="aborted";a.g.reject(b);window.setTimeout(function(){this.a.resolve();this.a=null}.bind(a),5)};function I(a,b){return b.bind(a)};function Nb(a,b){r("readonly"==a||"readwrite"==a);G.call(this,b);this.a=null;this.h=a}q(Nb,G);
function Ob(a){if(!window.indexedDB)return a=Error("Persistant storage requires IndexedDB support."),a.type="storage",Promise.reject(a);if(a.a)return a=Error("A database connection is already open."),a.type="storage",Promise.reject(a);var b=new H,c=window.indexedDB.open("content_database",1);c.onupgradeneeded=I(a,function(a){this.a=a.target.result;Pb(this,"group_store",{keyPath:"group_id"});Pb(this,"stream_index_store",{keyPath:"stream_id"});a=Pb(this,"content_store",{autoIncrement:"true"});a.createIndex("segment",
["stream_id","segment_id"],{unique:!0});a.createIndex("stream","stream_id",{unique:!1})});c.onsuccess=I(a,function(a){this.a=a.target.result;b.resolve()});c.onerror=function(){b.reject(c.error)};return b}function Qb(a){a.a&&(a.a.close(),a.a=null)}function Pb(a,b,c){a.a.objectStoreNames.contains(b)&&a.a.deleteObjectStore(b);return a.a.createObjectStore(b,c)}function Rb(a){return Sb(a,"content_store")}function Tb(a){return Sb(a,"stream_index_store")}function Ub(a){return Sb(a,"group_store")}
function Sb(a,b){r(a.a,"A database connection should be open.");return a.a.transaction([b],a.h).objectStore(b)}function Vb(a,b){var c=new H,d=a.get(b);d.onerror=function(){c.reject(d.error)};d.onsuccess=function(){if(d.result)c.resolve(d.result);else{var a=Error("Item not found.");a.type="storage";c.reject(a)}};return c};function Wb(){Nb.call(this,"readonly",null)}q(Wb,Nb);function Xb(a){var b=new H,c=[],d=Ub(a).openCursor();d.onerror=function(){b.reject(d.error)};d.onsuccess=function(a){(a=a.target.result)?(c.push(a.key),a.continue()):b.resolve(c)};return b}
function Yb(a,b){return Vb(Ub(a),b).then(I(a,function(a){a.session_ids=Ta(a.session_ids);return a.hasOwnProperty("duration")||a.hasOwnProperty("key_system")?Promise.resolve(a):Zb(this,a.stream_ids[0]).then(function(b){a.duration=b.duration;a.key_system=b.key_system;a.license_server=b.license_server;a.with_credentials=b.with_credentials;a.distinctive_identifier=b.distinctive_identifier;a.audio_robustness=b.audio_robustness;a.video_robustness=b.video_robustness;return Promise.resolve(a)})}))}
function Zb(a,b){return Vb(Tb(a),b)}function $b(a,b,c){return Vb(Rb(a).index("segment"),[b,c]).then(function(a){return Promise.resolve(a.content)})};function ac(a,b,c){r("open"==a.readyState,"The MediaSource should be in the 'open' state.");r(0<b.length);r(MediaSource.isTypeSupported(b));var d=a.addSourceBuffer(b);r(d,"SourceBuffer should not be null.");this.h=a;this.f=d;this.s=c;this.l=new Db;this.g=null;this.b=[];this.M=0;this.c=this.a=null;this.w=0;this.i=b.split(";")[0];r(0<this.i.length);F(this.l,this.f,"updateend",this.C.bind(this))}var bc=1/60;
ac.prototype.destroy=function(){cc(this).catch(function(){});this.c&&this.c.destroy();this.a=this.c=null;this.g&&(Qb(this.g),this.g=null);this.b=null;this.l.destroy();this.h=this.f=this.l=null};function dc(a,b){for(var c=a.f.buffered,d=0;d<c.length;++d){var e=c.start(d)-bc,f=c.end(d)+bc;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function ec(a,b,c,d){y(J(a),"fetch");r(!a.a);if(a.a)return a=Error("Cannot fetch ("+a.i+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Jb;c!=a.f.timestampOffset&&(x(J(a),"setting timestampOffset to",c),a.f.timestampOffset=c);"idb"!=b.url.a[0].ca||a.g||(a.g=new Wb,Kb(a.a,function(){return[Ob(this.g)]}.bind(a)));d&&Kb(a.a,function(){return[fc(this,d),this.j.bind(this)]}.bind(a));Kb(a.a,function(){var a=b.a?b.a-b.startTime:1,c=new gc;c.a=3;c.i=1E3*a;c.c=1E3*this.w;c.g=
this.g;return[hc(b.url,c,this.s),K.prototype.h.bind(b.url)]}.bind(a));var e;Kb(a.a,I(a,function(a){e=this.h.duration;x("Estimated bandwidth:",(this.s.getBandwidth()/1E6).toFixed(2),"Mbps");return[fc(this,a),this.j.bind(this)]}));var f=0==a.f.buffered.length&&0==a.b.length,g=null;Kb(a.a,function(){var a=this.h.duration;a!=e&&v(J(this),"appendBuffer() should not modify the MediaSource's duration:","before",e,"after",a,"delta",a-e);if(0==this.f.buffered.length)return a=Error("Failed to buffer segment ("+
this.i+")."),a.type="stream",[Promise.reject(a)];f&&(r(0==this.b.length),a=b.startTime,g=this.f.buffered.start(0)-a);a=ic(this.b,b.startTime);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return jc(a).then(function(){return Promise.resolve(g)}.bind(a))}
function kc(a){y(J(a),"clear");r(!a.a);if(a.a)return a=Error("Cannot clear ("+a.i+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Jb;Kb(a.a,function(){var a;a:if(r(!this.c),0==this.f.buffered.length)y(J(this),"nothing to clear."),r(0==this.b.length),a=Promise.resolve();else{try{this.f.remove(0,this.h.duration)}catch(c){a=Promise.reject(c);break a}this.b=[];a=this.c=new H}return[a,this.j.bind(this)]}.bind(a));return jc(a)}
function lc(a,b){y(J(a),"clearAfter");r(!a.a);if(a.a){var c=Error("Cannot clearAfter ("+a.i+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.a=new Jb;Kb(a.a,function(){return[mc(this,b),this.j.bind(this)]}.bind(a));return jc(a)}function cc(a){y(J(a),"abort");a.a?(a=a.a,a.a?a=a.a:a.f?(a.c&&a.c(),a.a=new H,a=a.a):(a.f=!0,a=Promise.resolve())):a=Promise.resolve();return a}
function nc(a){return 1<a.f.buffered.length?(u(J(a),"multiple buffered ranges detected:","Either the content has gaps in it,","the content's segments are not aligned across bitrates,","or the browser has evicted the middle of the buffer."),!0):!1}function jc(a){r(a.a);a.a.start();return a.a.g.then(I(a,function(){this.a=null})).catch(I(a,function(a){y(J(this),"task failed!");this.a=null;return Promise.reject(a)}))}
function fc(a,b){r(!a.c);r(a.a);try{a.f.appendBuffer(b)}catch(c){return Promise.reject(c)}a.c=new H;return a.c}function mc(a,b){r(!a.c);if(0==a.f.buffered.length)return y(J(a),"nothing to clear."),r(0==a.b.length),Promise.resolve();var c=ic(a.b,b);if(-1==c||c==a.b.length-1)return y(J(a),"nothing to clear: no segments on or after timestamp."),Promise.resolve();try{a.f.remove(a.b[c+1].startTime,a.h.duration)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.c=new H;return a.c}
ac.prototype.j=function(){y(J(this),"abort_");this.c&&"open"==this.h.readyState&&this.f.abort()};ac.prototype.C=function(){y(J(this),"onSourceBufferUpdateEnd_");this.c&&(r(!this.f.updating),this.c.resolve(),this.c=null)};function J(a){return"SBM "+a.i+":"};function oc(a){return String.fromCharCode.apply(null,a)}n("shaka.util.Uint8ArrayUtils.toString",oc);function pc(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}n("shaka.util.Uint8ArrayUtils.fromString",pc);n("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(oc(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function qc(a){return pc(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
n("shaka.util.Uint8ArrayUtils.fromBase64",qc);n("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function rc(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}n("shaka.util.Uint8ArrayUtils.toHex",rc);function ib(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function sc(){this.h=this.a="";this.i=!1;this.w=this.s=null;this.l=this.g=!1;this.j=this.f="";this.c=null;this.b=[]}
function tc(a){var b=new sc;if(!a)return b;var c=yb(a,"keySystem");if(null!=c)b.a=c;else throw Error("'keySystem' cannot be null.");var d=yb(a,"licenseServerUrl");if(null!=d)b.h=d;else if(c)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");c=vb(a,"withCredentials");null!=c&&(b.i=c);c=zb(a,"licensePostProcessor",Function);null!=c&&(b.s=c);c=zb(a,"licensePreProcessor",Function);null!=c&&(b.w=c);c=vb(a,"distinctiveIdentifierRequired");null!=c&&(b.g=c);c=vb(a,
"persistentStateRequired");null!=c&&(b.l=c);c=yb(a,"audioRobustness");null!=c&&(b.f=c);c=yb(a,"videoRobustness");null!=c&&(b.j=c);c=zb(a,"serverCertificate",Uint8Array);null!=c&&(b.c=c);if(c=zb(a,"initData",Object)){a=zb(c,"initData",Uint8Array);if(null==a)throw Error("'initData.initData' cannot be null.");c=yb(c,"initDataType");if(null==c)throw Error("'initData.initDataType' cannot be null.");b.b.push({initData:new Uint8Array(a.buffer),initDataType:c})}return b}
function uc(a,b){vc(a,b)||v("combine() should only be called with a compatible DrmInfo object:","this",a,"other",b);var c=new sc;c.a=a.a;c.h=a.h;c.i=a.i;c.s=a.s;c.w=a.w;c.g=a.g;c.l=a.l;c.f=a.f;c.j=a.j;c.c=a.c?new Uint8Array(a.c.buffer):null;wc(c,a.b);wc(c,b.b);return c}function vc(a,b){return a.a==b.a&&a.h==b.h&&a.i==b.i&&a.g==b.g&&a.l==b.l&&a.f==b.f&&a.j==b.j&&ib(a.c,b.c)}
function wc(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=Ta(c,xc)}function xc(a,b){return a.initDataType==b.initDataType&&ib(a.initData,b.initData)};function yc(a,b){x("v01b.requestMediaKeySystemAccess");r(this instanceof Navigator);try{var c=new zc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}function Ac(a){x("v01b.setMediaKeys");r(this instanceof HTMLMediaElement);var b=this.mediaKeys;b&&b!=a&&(r(b instanceof Cc),Dc(b,null));delete this.mediaKeys;if(this.mediaKeys=a)r(a instanceof Cc),Dc(a,this);return Promise.resolve()}
function zc(a,b){x("v01b.MediaKeySystemAccess");this.a=this.keySystem=a;var c=!0;"org.w3.clearkey"==a&&(this.a="webkit-org.w3.clearkey",c=!1);var d=!1,e;e=document.getElementsByTagName("video");e=e.length?e[0]:document.createElement("video");for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"]},l=!1;if(g.audioCapabilities)for(var m=0;m<g.audioCapabilities.length;++m){var p=
g.audioCapabilities[m];p.contentType&&(l=!0,e.canPlayType(p.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(p),d=!0))}if(g.videoCapabilities)for(m=0;m<g.videoCapabilities.length;++m)p=g.videoCapabilities[m],p.contentType&&(l=!0,e.canPlayType(p.contentType,this.a)&&(h.videoCapabilities.push(p),d=!0));l||(d=e.canPlayType("video/mp4",this.a)||e.canPlayType("video/webm",this.a));"required"==g.persistentState&&(c?(h.persistentState="required",h.sessionTypes=["persistent-license"]):d=!1);if(d){this.b=
h;return}}c="Unsupported keySystem";if("org.w3.clearkey"==a||"com.widevine.alpha"==a)c="None of the requested configurations were supported.";c=Error(c);c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}zc.prototype.createMediaKeys=function(){x("v01b.MediaKeySystemAccess.createMediaKeys");var a=new Cc(this.a);return Promise.resolve(a)};zc.prototype.getConfiguration=function(){x("v01b.MediaKeySystemAccess.getConfiguration");return this.b};
function Cc(a){x("v01b.MediaKeys");this.g=a;this.b=null;this.a=new Db;this.c=[];this.f={}}function Dc(a,b){a.b=b;Eb(a.a);b&&(F(a.a,b,"webkitneedkey",a.yc.bind(a)),F(a.a,b,"webkitkeymessage",a.xc.bind(a)),F(a.a,b,"webkitkeyadded",a.vc.bind(a)),F(a.a,b,"webkitkeyerror",a.wc.bind(a)))}k=Cc.prototype;
k.createSession=function(a){x("v01b.MediaKeys.createSession");var b=a||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+a+" is unsupported on this platform.");a=this.b||document.createElement("video");a.src||(a.src="about:blank");b=new Ec(a,this.g,b);this.c.push(b);return b};k.setServerCertificate=function(){x("v01b.MediaKeys.setServerCertificate");return Promise.reject(Error("setServerCertificate not supported on this platform."))};
k.yc=function(a){x("v01b.onWebkitNeedKey_",a);r(this.b);a=A({type:"encrypted",initDataType:"webm",initData:a.initData});this.b.dispatchEvent(a)};k.xc=function(a){x("v01b.onWebkitKeyMessage_",a);var b=Fc(this,a.sessionId);b?(a=A({type:"message",messageType:void 0==b.keyStatuses.cb()?"licenserequest":"licenserenewal",message:a.message}),x("v01b.MediaKeySession.generated"),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a)):u("Session not found",a.sessionId)};
k.vc=function(a){x("v01b.onWebkitKeyAdded_",a);a=Fc(this,a.sessionId);r(a);a&&(x("v01b.MediaKeySession.ready"),Gc(a,"usable"),a.a&&a.a.resolve(),a.a=null)};
k.wc=function(a){x("v01b.onWebkitKeyError_",a);var b=Fc(this,a.sessionId);r(b);if(b){x("v01b.MediaKeySession.handleError",a);var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45==a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Gc(b,"output-restricted"):
1==c?Gc(b,"expired"):Gc(b,"internal-error"))}};function Fc(a,b){var c=a.f[b];return c?(x("v01b.MediaKeys.findSession_",c),c):(c=a.c.shift())?(c.sessionId=b,a.f[b]=c,x("v01b.MediaKeys.findSession_",c),c):null}function Ec(a,b,c){x("v01b.MediaKeySession");G.call(this,null);this.g=a;this.h=!1;this.a=this.b=null;this.c=b;this.f=c;this.sessionId="";this.expiration=NaN;this.closed=new H;this.keyStatuses=new Hc}q(Ec,G);
function Ic(a,b,c){if(a.h)return Promise.reject(Error("The session is already initialized."));a.h=!0;var d;try{if("persistent-license"==a.f)if(c)d=pc("LOAD_SESSION|"+c);else{var e=new Uint8Array(b);d=pc("PERSISTENT|"+oc(e))}else r("temporary"==a.f),r(!c),d=new Uint8Array(b);r(d)}catch(f){return Promise.reject(f)}r(null==a.b);a.b=new H;try{a.g.webkitGenerateKeyRequest(a.c,d)}catch(g){if("InvalidStateError"!=g.name)return a.b=null,Promise.reject(g);setTimeout(function(){try{this.g.webkitGenerateKeyRequest(this.c,
d)}catch(a){this.b.reject(a),this.b=null}}.bind(a),10)}return a.b}k=Ec.prototype;
k.ub=function(a,b){if(this.a)this.a.then(this.ub.bind(this,a,b)).catch(this.ub.bind(this,a,b));else{this.a=a;var c,d;"webkit-org.w3.clearkey"==this.c?(c=oc(new Uint8Array(b)),d=JSON.parse(c),"oct"!=d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),c=qc(d.keys[0].k),d=qc(d.keys[0].kid)):(c=new Uint8Array(b),d=null);try{this.g.webkitAddKey(this.c,c,d,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}};
function Gc(a,b){a.keyStatuses.ob(b);var c=A({type:"keystatuseschange"});a.dispatchEvent(c)}k.generateRequest=function(a,b){x("v01b.MediaKeySession.generateRequest");return Ic(this,b,null)};k.load=function(a){x("v01b.MediaKeySession.load");return"persistent-license"==this.f?Ic(this,null,a):Promise.reject(Error("Not a persistent session."))};k.update=function(a){x("v01b.MediaKeySession.update",a);r(this.sessionId);var b=new H;this.ub(b,a);return b};
k.close=function(){x("v01b.MediaKeySession.close");if("persistent-license"!=this.f){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.g.webkitCancelKeyRequest(this.c,this.sessionId)}this.closed.resolve();return this.closed};k.remove=function(){x("v01b.MediaKeySession.remove");return"persistent-license"!=this.f?Promise.reject(Error("Not a persistent session.")):this.close()};function Hc(){this.size=0;this.a=void 0}var Jc;k=Hc.prototype;
k.ob=function(a){this.size=void 0==a?0:1;this.a=a};k.cb=function(){return this.a};k.forEach=function(a){this.a&&a(Jc,this.a)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=Jc;return this.a&&ib(new Uint8Array(a),new Uint8Array(b))?!0:!1};function Kc(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Wa(new DataView(a.buffer));try{for(;Ya(a);){var b=a.a,c=$a(a),d=$a(a);1==c?c=ab(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)v("Non-PSSH box found!"),cb(a,c-(a.a-b));else{var e=Za(a);if(1<e)v("Unrecognized PSSH version found!"),cb(a,c-(a.a-b));else{cb(a,3);var f=rc(bb(a)),g=[];if(0<e)for(var h=$a(a),l=0;l<h;++l){var m=rc(bb(a));g.push(m)}var p=$a(a);cb(a,p);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,
end:a.a-1});a.a!=b+c&&(v("Mismatch between box size and data size!"),cb(a,c-(a.a-b)))}}}}catch(t){v("PSSH parse failure!  Some data may be missing or incorrect.")}};function Lc(a,b){x("PatchedMediaKeys.v20140218.requestMediaKeySystemAccess");r(this instanceof Navigator);try{var c=new Mc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}
function Mc(a,b){x("v20140218.MediaKeySystemAccess");this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"]},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];if(l.contentType){var g=!0,m=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.audioCapabilities.push(l),
c=!0)}}if(e.videoCapabilities)for(h=0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,m=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==e.persistentState&&(f.persistentState="required",f.sessionTypes=["persistent-license"]);if(c){this.a=f;return}}c=Error("Unsupported keySystem");c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;
throw c;}Mc.prototype.createMediaKeys=function(){x("v20140218.MediaKeySystemAccess.createMediaKeys");var a=new Nc(this.keySystem);return Promise.resolve(a)};Mc.prototype.getConfiguration=function(){x("v20140218.MediaKeySystemAccess.getConfiguration");return this.a};function Oc(a){x("v20140218.setMediaKeys");var b=this.mediaKeys;b&&b!=a&&(r(b instanceof Nc),Pc(b,null));delete this.mediaKeys;return(this.mediaKeys=a)?(r(a instanceof Nc),Pc(a,this)):Promise.resolve()}
function Nc(a){x("v20140218.MediaKeys");this.a=new MSMediaKeys(a);this.b=new Db}Nc.prototype.createSession=function(a){x("v20140218.MediaKeys.createSession");if("temporary"!=(a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new Qc(this.a)};Nc.prototype.setServerCertificate=function(){x("v20140218.MediaKeys.setServerCertificate");return Promise.reject(Error("setServerCertificate not supported on this platform."))};
function Pc(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener("loadedmetadata",c)}Eb(a.b);if(!b)return Promise.resolve();F(a.b,b,"msneedkey",Rc);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener("loadedmetadata",c),Promise.resolve()}catch(e){return Promise.reject(e)}}
function Qc(a){x("v20140218.MediaKeySession");G.call(this,null);this.c=null;this.g=a;this.b=this.a=null;this.f=new Db;this.sessionId="";this.expiration=NaN;this.closed=new H;this.keyStatuses=new Sc}q(Qc,G);k=Qc.prototype;
k.generateRequest=function(a,b){x("v20140218.MediaKeySession.generateRequest");this.a=new H;try{this.c=this.g.createSession("video/mp4",new Uint8Array(b),null),F(this.f,this.c,"mskeymessage",this.lc.bind(this)),F(this.f,this.c,"mskeyadded",this.jc.bind(this)),F(this.f,this.c,"mskeyerror",this.kc.bind(this)),Tc(this,"status-pending")}catch(c){this.a.reject(c)}return this.a};k.load=function(){x("v20140218.MediaKeySession.load");return Promise.reject(Error("MediaKeySession.load not yet supported"))};
k.update=function(a){x("v20140218.MediaKeySession.update");this.b=new H;try{this.c.update(new Uint8Array(a))}catch(b){this.b.reject(b)}return this.b};k.close=function(){x("v20140218.MediaKeySession.close");try{this.c.close(),this.closed.resolve(),Eb(this.f)}catch(a){this.closed.reject(a)}return this.closed};k.remove=function(){x("v20140218.MediaKeySession.remove");return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function Rc(a){x("v20140218.onMsNeedKey_",a);var b=a.initData;if(b){var c=new Kc(b);if(1>=c.a.length)a=b;else{var d=[];for(a=0;a<c.a.length;a++)d.push(b.subarray(c.a[a].start,c.a[a].end+1));b=Ta(d,Uc);for(a=c=0;a<b.length;a++)c+=b[a].length;c=new Uint8Array(c);for(a=d=0;a<b.length;a++)c.set(b[a],d),d+=b[a].length;a=c}}else a=b;a=A({type:"encrypted",initDataType:"cenc",initData:a});this.dispatchEvent(a)}function Uc(a,b){return ib(a,b)}
k.lc=function(a){x("v20140218.onMsKeyMessage_",a);r(this.a);this.a&&(this.a.resolve(),this.a=null);a=A({type:"message",messageType:void 0==this.keyStatuses.cb()?"licenserequest":"licenserenewal",message:a.message.buffer});this.dispatchEvent(a)};k.jc=function(a){x("v20140218.onMsKeyAdded_",a);this.a?(x("Simulating completion for a PR persistent license."),r(null==this.b),this.a.resolve(),this.a=null):(r(null!=this.b),this.b&&(Tc(this,"usable"),this.b.resolve(),this.b=null))};
k.kc=function(a){x("v20140218.onMsKeyError_",a);a=Error("EME v20140218 key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Tc(this,"output-not-allowed");default:Tc(this,"internal-error")}};function Tc(a,b){a.keyStatuses.ob(b);var c=A({type:"keystatuseschange"});a.dispatchEvent(c)}
function Sc(){this.size=0;this.a=void 0}var Vc;k=Sc.prototype;k.ob=function(a){this.size=void 0==a?0:1;this.a=a};k.cb=function(){return this.a};k.forEach=function(a){this.a&&a(Vc,this.a)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=Vc;return this.a&&ib(new Uint8Array(a),new Uint8Array(b))?!0:!1};function Wc(){x("MediaKeys.install");Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?w("Using native EME as-is."):HTMLMediaElement.prototype.webkitGenerateKeyRequest?(w("Using prefixed EME v0.1b."),x("v01b.install"),r(HTMLMediaElement.prototype.webkitGenerateKeyRequest),Jc=(new Uint8Array([0])).buffer,Navigator.prototype.requestMediaKeySystemAccess=yc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=
Ac,window.MediaKeys=Cc,window.MediaKeySystemAccess=zc):window.MSMediaKeys?(w("Using EME v20140218"),x("PatchedMediaKeys.v20140218.install"),Vc=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Oc,window.MediaKeys=Nc,window.MediaKeySystemAccess=Mc,Navigator.prototype.requestMediaKeySystemAccess=Lc):(w("EME not available."),x("PatchedMediaKeys.nop.install"),Navigator.prototype.requestMediaKeySystemAccess=
Ba,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ca,window.MediaKeys=Da,window.MediaKeySystemAccess=Ea)}n("shaka.polyfill.MediaKeys.install",Wc);n("shaka.polyfill.installAll",function(){xa();za();Ra();Ga();Wc()});function M(){}var Yc=Xc(9007199254740992);Math.log(9007199254740992);M.a=function(a){return"undefined"===typeof a?M[0]:N(a)};function O(a,b){this.value=a;this.sign=b;this.R=!1}O.prototype=Object.create(M.prototype);function P(a){this.value=a;this.sign=0>a;this.R=!0}P.prototype=Object.create(M.prototype);function Zc(a){return-9007199254740992<a&&9007199254740992>a}function Xc(a){return 1E7>a?[a]:1E14>a?[a%1E7,Math.floor(a/1E7)]:[a%1E7,Math.floor(a/1E7)%1E7,Math.floor(a/1E14)]}
function $c(a){ad(a);var b=a.length;if(4>b&&0>bd(a,Yc))switch(b){case 0:return 0;case 1:return a[0];case 2:return a[0]+1E7*a[1];default:return a[0]+1E7*(a[1]+1E7*a[2])}return a}function ad(a){for(var b=a.length;0===a[--b];);a.length=b+1}function cd(a){for(var b=Array(a),c=-1;++c<a;)b[c]=0;return b}function dd(a){return 0<a?Math.floor(a):Math.ceil(a)}
function ed(a,b){var c=a.length,d=b.length,e=Array(c),f=0,g,h;for(h=0;h<d;h++)g=a[h]+b[h]+f,f=1E7<=g?1:0,e[h]=g-1E7*f;for(;h<c;)g=a[h]+f,f=1E7===g?1:0,e[h++]=g-1E7*f;0<f&&e.push(f);return e}function fd(a,b){return a.length>=b.length?ed(a,b):ed(b,a)}function gd(a,b){var c=a.length,d=Array(c),e,f;for(f=0;f<c;f++)e=a[f]-1E7+b,b=Math.floor(e/1E7),d[f]=e-1E7*b,b+=1;for(;0<b;)d[f++]=b%1E7,b=Math.floor(b/1E7);return d}
O.prototype.add=function(a){a=N(a);if(this.sign!==a.sign)return this.qa(a.ma());var b=this.value,c=a.value;return a.R?new O(gd(b,Math.abs(c)),this.sign):new O(fd(b,c),this.sign)};P.prototype.add=function(a){a=N(a);var b=this.value;if(0>b!==a.sign)return this.qa(a.ma());var c=a.value;if(a.R){if(Zc(b+c))return new P(b+c);c=Xc(Math.abs(c))}return new O(gd(c,Math.abs(b)),0>b)};
function hd(a,b){var c=a.length,d=b.length,e=Array(c),f=0,g,h;for(g=0;g<d;g++)h=a[g]-f-b[g],0>h?(h+=1E7,f=1):f=0,e[g]=h;for(g=d;g<c;g++){h=a[g]-f;if(0>h)h+=1E7;else{e[g++]=h;break}e[g]=h}for(;g<c;g++)e[g]=a[g];ad(e);return e}function id(a,b,c){var d=a.length,e=Array(d);b=-b;var f,g;for(f=0;f<d;f++)g=a[f]+b,b=Math.floor(g/1E7),g%=1E7,e[f]=0>g?g+1E7:g;e=$c(e);return"number"===typeof e?(c&&(e=-e),new P(e)):new O(e,c)}
O.prototype.qa=function(a){var b=N(a);if(this.sign!==b.sign)return this.add(b.ma());a=this.value;var c=b.value;b.R?a=id(a,Math.abs(c),this.sign):(b=this.sign,0<=bd(a,c)?a=hd(a,c):(a=hd(c,a),b=!b),a=$c(a),"number"===typeof a?(b&&(a=-a),a=new P(a)):a=new O(a,b));return a};P.prototype.qa=function(a){a=N(a);var b=this.value;if(0>b!==a.sign)return this.add(a.ma());var c=a.value;return a.R?new P(b-c):id(c,Math.abs(b),0<=b)};O.prototype.ma=function(){return new O(this.value,!this.sign)};
P.prototype.ma=function(){var a=new P(-this.value);a.sign=!this.sign;return a};O.prototype.abs=function(){return new O(this.value,!1)};P.prototype.abs=function(){return new P(Math.abs(this.value))};function jd(a,b){var c=a.length,d=b.length,e=cd(c+d),f,g,h,l;for(h=0;h<c;++h){l=a[h];for(var m=0;m<d;++m)f=b[m],f=l*f+e[h+m],g=Math.floor(f/1E7),e[h+m]=f-1E7*g,e[h+m+1]+=g}ad(e);return e}
function kd(a,b){var c=a.length,d=Array(c),e=0,f,g;for(g=0;g<c;g++)f=a[g]*b+e,e=Math.floor(f/1E7),d[g]=f-1E7*e;for(;0<e;)d[g++]=e%1E7,e=Math.floor(e/1E7);return d}function ld(a,b){for(var c=[];0<b--;)c.push(0);return c.concat(a)}function md(a,b){var c=Math.max(a.length,b.length);if(30>=c)return jd(a,b);var c=Math.ceil(c/2),d=a.slice(c),e=a.slice(0,c),f=b.slice(c),g=b.slice(0,c),h=md(e,g),l=md(d,f),d=md(fd(e,d),fd(g,f)),c=fd(fd(h,ld(hd(hd(d,h),l),c)),ld(l,2*c));ad(c);return c}
O.prototype.multiply=function(a){var b=N(a);a=this.value;var c=b.value,d=this.sign!==b.sign;if(b.R){if(0===c)return M[0];if(1===c)return this;if(-1===c)return this.ma();c=Math.abs(c);if(1E7>c)return new O(kd(a,c),d);c=Xc(c)}var b=a.length,e=c.length;return 0<-.012*b-.012*e+1.5E-5*b*e?new O(md(a,c),d):new O(jd(a,c),d)};O.prototype.$b=O.prototype.multiply;function nd(a,b,c){return 1E7>a?new O(kd(b,a),c):new O(jd(b,Xc(a)),c)}
P.prototype.zb=function(a){return Zc(a.value*this.value)?new P(a.value*this.value):nd(Math.abs(a.value),Xc(Math.abs(this.value)),this.sign!==a.sign)};O.prototype.zb=function(a){return 0===a.value?M[0]:1===a.value?this:-1===a.value?this.ma():nd(Math.abs(a.value),this.value,this.sign!==a.sign)};P.prototype.multiply=function(a){return N(a).zb(this)};P.prototype.$b=P.prototype.multiply;
function od(a){var b=a.length,c=cd(b+b),d,e,f,g;for(f=0;f<b;f++){g=a[f];for(var h=0;h<b;h++)d=a[h],d=g*d+c[f+h],e=Math.floor(d/1E7),c[f+h]=d-1E7*e,c[f+h+1]+=e}ad(c);return c}O.prototype.Yb=function(){return new O(od(this.value),!1)};P.prototype.Yb=function(){var a=this.value*this.value;return Zc(a)?new P(a):new O(od(Xc(Math.abs(this.value))),!1)};function pd(a,b){var c=a.length,d=cd(c),e,f;f=0;for(c=c-1;0<=c;--c)f=1E7*f+a[c],e=dd(f/b),f=f-e*b,d[c]=e|0;return[d,f|0]}
function qd(a,b){var c,d=N(b),e=a.value;c=d.value;if(0===c)throw Error("Cannot divide by zero");if(a.R)return d.R?[new P(dd(e/c)),new P(e%c)]:[M[0],a];if(d.R){if(1===c)return[a,M[0]];if(-1==c)return[a.ma(),M[0]];c=Math.abs(c);if(1E7>c)return c=pd(e,c),e=$c(c[0]),c=c[1],a.sign&&(c=-c),"number"===typeof e?(a.sign!==d.sign&&(e=-e),[new P(e),new P(c)]):[new O(e,a.sign!==d.sign),new P(c)];c=Xc(c)}var f=bd(e,c);if(-1===f)return[M[0],a];if(0===f)return[M[a.sign===d.sign?1:-1],M[0]];if(200>=e.length+c.length){var g=
c,h=e.length;c=g.length;var f=cd(g.length),l=g[c-1],m=Math.ceil(1E7/(2*l)),e=kd(e,m),g=kd(g,m),p,t,C,D,L,fa;e.length<=h&&e.push(0);g.push(0);l=g[c-1];for(p=h-c;0<=p;p--){h=9999999;e[p+c]!==l&&(h=Math.floor((1E7*e[p+c]+e[p+c-1])/l));C=t=0;L=g.length;for(D=0;D<L;D++)t+=h*g[D],fa=Math.floor(t/1E7),C+=e[p+D]-(t-1E7*fa),t=fa,0>C?(e[p+D]=C+1E7,C=-1):(e[p+D]=C,C=0);for(;0!==C;){--h;for(D=t=0;D<L;D++)t+=e[p+D]-1E7+g[D],0>t?(e[p+D]=t+1E7,t=0):(e[p+D]=t,t=1);C+=t}f[p]=h}e=pd(e,m)[0];e=[$c(f),$c(e)]}else{f=
e.length;l=c.length;m=[];for(g=[];f;)if(g.unshift(e[--f]),0>bd(g,c))m.push(0);else{h=g.length;p=1E7*g[h-1]+g[h-2];t=1E7*c[l-1]+c[l-2];h>l&&(p=1E7*(p+1));h=Math.ceil(p/t);do{p=kd(c,h);if(0>=bd(p,g))break;h--}while(h);m.push(h);g=hd(g,p)}m.reverse();e=[$c(m),$c(g)]}c=e;e=c[0];d=a.sign!==d.sign;c=c[1];f=a.sign;"number"===typeof e?(d&&(e=-e),e=new P(e)):e=new O(e,d);"number"===typeof c?(f&&(c=-c),c=new P(c)):c=new O(c,f);return[e,c]}function rd(a,b){return qd(a,b)[0]}
O.prototype.pow=function(a){var b=N(a),c=this.value;a=b.value;var d;if(0===a)return M[1];if(0===c)return M[0];if(1===c)return M[1];if(-1===c)return b.va()?M[1]:M[-1];if(b.sign)return M[0];if(!b.R)throw Error("The exponent "+b.toString()+" is too large.");if(this.R&&Zc(d=Math.pow(c,a)))return new P(dd(d));d=this;for(b=M[1];;){a&1&&(b=b.$b(d),--a);if(0===a)break;a/=2;d=d.Yb()}return b};P.prototype.pow=O.prototype.pow;
function bd(a,b){if(a.length!==b.length)return a.length>b.length?1:-1;for(var c=a.length-1;0<=c;c--)if(a[c]!==b[c])return a[c]>b[c]?1:-1;return 0}O.prototype.compare=function(a){if(Infinity===a)return-1;if(-Infinity===a)return 1;a=N(a);return this.sign!==a.sign?a.sign?1:-1:a.R?this.sign?-1:1:bd(this.value,a.value)*(this.sign?-1:1)};
P.prototype.compare=function(a){if(Infinity===a)return-1;if(-Infinity===a)return 1;a=N(a);var b=this.value,c=a.value;return a.R?b==c?0:b>c?1:-1:0>b!==a.sign?0>b?-1:1:0>b?1:-1};O.prototype.Za=function(a){return 0===this.compare(a)};P.prototype.Za=O.prototype.Za;O.prototype.Sa=function(a){return 0<this.compare(a)};P.prototype.Sa=O.prototype.Sa;O.prototype.hb=function(a){return 0>this.compare(a)};P.prototype.hb=O.prototype.hb;O.prototype.va=function(){return 0===(this.value[0]&1)};
P.prototype.va=function(){return 0===(this.value&1)};O.prototype.gb=function(){return this.sign};P.prototype.gb=function(){return 0>this.value};O.prototype.Jb=function(){return!1};P.prototype.Jb=function(){return 1===Math.abs(this.value)};O.prototype.Fa=function(){return!1};P.prototype.Fa=function(){return 0===this.value};O.prototype.next=function(){var a=this.value;return this.sign?id(a,1,this.sign):new O(gd(a,1),this.sign)};
P.prototype.next=function(){var a=this.value;return 9007199254740992>a+1?new P(a+1):new O(Yc,!1)};O.prototype.jb=function(){var a=this.value;return this.sign?new O(gd(a,1),!0):id(a,1,this.sign)};P.prototype.jb=function(){var a=this.value;return-9007199254740992<a-1?new P(a-1):new O(Yc,!0)};for(var sd=[1];1E7>=sd[sd.length-1];)sd.push(2*sd[sd.length-1]);var td=sd.length,ud=sd[td-1];
function vd(a){return("number"===typeof a||"string"===typeof a)&&1E7>=+Math.abs(a)||a instanceof O&&1>=a.value.length}O.prototype.shiftLeft=function(a){if(!vd(a))throw Error(String(a)+" is too large for shifting.");a=+a;if(0>a)return this.rb(-a);for(var b=this;a>=td;)b=b.multiply(ud),a-=td-1;return b.multiply(sd[a])};P.prototype.shiftLeft=O.prototype.shiftLeft;
O.prototype.rb=function(a){var b;if(!vd(a))throw Error(String(a)+" is too large for shifting.");a=+a;if(0>a)return this.shiftLeft(-a);for(b=this;a>=td;){if(b.Fa())return b;b=qd(b,ud);b=b[1].gb()?b[0].jb():b[0];a-=td-1}b=qd(b,sd[a]);return b[1].gb()?b[0].jb():b[0]};P.prototype.rb=O.prototype.rb;function wd(a){a=a.value;a="number"===typeof a?a|1073741824:a[0]+1E7*a[1]|1073758208;return a&-a}function xd(a,b){a=N(a);b=N(b);return a.Sa(b)?a:b}function yd(a,b){a=N(a);b=N(b);return a.hb(b)?a:b}
function zd(a,b){a=N(a).abs();b=N(b).abs();if(a.Za(b))return a;if(a.Fa())return b;if(b.Fa())return a;for(var c=M[1],d;a.va()&&b.va();)d=Math.min(wd(a),wd(b)),a=rd(a,d),b=rd(b,d),c=c.multiply(d);for(;a.va();)a=rd(a,wd(a));do{for(;b.va();)b=rd(b,wd(b));a.Sa(b)&&(d=b,b=a,a=d);b=b.qa(a)}while(!b.Fa());return c.Jb()?a:a.multiply(c)}O.prototype.toString=function(){for(var a=this.value,b=a.length,c=String(a[--b]),d;0<=--b;)d=String(a[b]),c+="0000000".slice(d.length)+d;return(this.sign?"-":"")+c};
P.prototype.toString=function(){return String(this.value)};O.prototype.valueOf=function(){return+this.toString()};O.prototype.tb=O.prototype.valueOf;P.prototype.valueOf=function(){return this.value};P.prototype.tb=P.prototype.valueOf;
function Ad(a){if(Zc(+a)){var b=+a;if(b===dd(b))return new P(b);throw"Invalid shaka.vimond.Integer: "+a;}(b="-"===a[0])&&(a=a.slice(1));var c=a.split(/e/i);if(2<c.length)throw Error("Invalid shaka.vimond.Integer: "+c.join("e"));if(2===c.length){a=c[1];"+"===a[0]&&(a=a.slice(1));a=+a;if(a!==dd(a)||!Zc(a))throw Error("Invalid shaka.vimond.Integer: "+a+" is not a valid exponent.");var c=c[0],d=c.indexOf(".");0<=d&&(a-=c.length-d-1,c=c.slice(0,d)+c.slice(d+1));if(0>a)throw Error("Cannot include negative exponent part for shaka.vimond.Integers");
a=c+=Array(a+1).join("0")}if(!/^([0-9][0-9]*)$/.test(a))throw Error("Invalid shaka.vimond.Integer: "+a);for(var c=[],d=a.length,e=d-7;0<d;)c.push(+a.slice(e,d)),e-=7,0>e&&(e=0),d-=7;ad(c);return new O(c,b)}function N(a){if("number"===typeof a)if(Zc(a)){if(a!==dd(a))throw Error(a+" is not an shaka.vimond.Integer.");a=new P(a)}else a=Ad(a.toString());else a="string"===typeof a?Ad(a):a;return a}for(var Bd=0;1E3>Bd;Bd++)M[Bd]=new P(Bd),0<Bd&&(M[-Bd]=new P(-Bd));M.i=M[1];M.l=M[0];M.h=M[-1];M.max=xd;
M.min=yd;M.b=zd;M.g=function(a,b){a=N(a).abs();b=N(b).abs();return rd(a,zd(a,b)).multiply(b)};M.f=Zc;M.c=function(a){return a instanceof O||a instanceof P};M.j=function(a,b){a=N(a);b=N(b);var c=yd(a,b),d=xd(a,b).qa(c);if(d.R)return c.add(Math.round(Math.random()*d));for(var e=[],f=!0,g=d.value.length-1;0<=g;g--){var h=f?d.value[g]:1E7,l=dd(Math.random()*h);e.unshift(l);l<h&&(f=!1)}e=$c(e);return c.add("number"===typeof e?new P(e):new O(e,!1))};n("shaka.vimond.dash.ManifestModificationSetup",function(a,b,c){this.c=a||null;this.b=c||null;this.a=b||null});function Cd(a){this.a=a||null}function Dd(a,b){if("string"===typeof b&&a.a){var c=a.a.c;c&&(b=c.reduce(function(a,b){var c=b.a instanceof RegExp?b.a:new RegExp(b.a.toString(),b.b),g=a.replace(c,b.ba);g!==a?w("Manifest modifier in action: Replaced matches for %s with %s.",c,b.ba):w("Manifest modifier found nothing for pattern %s to be replaced with %s.",c,b.ba);return g},b))}return b};n("shaka.vimond.dash.ReplacementRule",function(a,b,c){this.a=a;this.b=c||null;this.ba=b});var Ed=/((type="static"|availabilityStartTime="([A-Z]|[0-9]|-|\+|:|\.)+")((.|\n)*) t="[0-9]{16,}")/,Fd=/(type)="static"|(availabilityStartTime)="(?:.*?)"|<(SegmentTemplate) |(presentationTimeOffset)="[0-9]*?"|(timescale)="[0-9]*?"| (t)="[0-9]*?"/g;function Gd(){this.ea=this.$=null}function Hd(a){if((a=a.split('"'))&&2<a.length)return a[a.length-2]}
var Id={type:function(a,b){var c=100,d=c;a.Ga&&a.Ga.$&&(c=a.Ga.$,d=a.Ga.ea,w("Switching to dynamic to static manifest. Applying big int workaround start offsets kept from live state.",a.Ga));return{ra:{Oc:!0,$:c,ea:d},ba:b}},availabilityStartTime:function(a,b){var c,d,e,f=b;try{c=Hd(b),d=(new Date(c)).getTime()/1E3}catch(g){v("Parse date failed.",g)}d&&(e=86400*(Math.floor(d/86400)-1),f='availabilityStartTime="'+(new Date(1E3*e)).toISOString()+'" _availabilityStartTime="'+c+'"');return{ra:{$:d,ea:e},
ba:f}},SegmentTemplate:function(a,b){return{ra:{Qa:1,Pa:0},ba:b}},timescale:function(a,b){var c;try{c=parseInt(Hd(b),10)}catch(d){v("Parse timescale failed.",d)}return{ra:{Qa:c},ba:b}},presentationTimeOffset:function(a,b){var c;try{c=parseInt(Hd(b),10)}catch(d){v("Parse presentationTimeOffset failed.",d)}return{ra:{Pa:c},ba:'presentationTimeOffset="0"'}},t:function(a,b){var c=b;try{var d=Hd(b)||0,e=M.a(d||0).qa(a.Pa||0).add((a.$-a.ea)*a.Qa).tb(),f=a.ea+rd(M.a(a.Pa),a.Qa).tb()-a.$,c=' t="'+e+'" _t="'+
d+'" _timestampOffset="'+f.toString()+'"';w("Adjusting start offset to JS compatible integer, and keeping the old big one.",c);w("Original/adjusted availability start time",new Date(1E3*a.$),new Date(1E3*a.ea))}catch(g){v("Start offset adjustment failed.",g)}return{ra:{},ba:c}}};
function Kd(a,b){function c(a,b,c,e,f,t,C){if(b=b||c||e||f||t||C)try{var D=Id[b](d,a);Object.getOwnPropertyNames(D.ra).forEach(function(a){d[a]=D.ra[a]});return D.ba}catch(L){return d.error=L,console.log("Error while finding replacement.",L),a}else return a}var d={$:null,ea:null,Qa:1,Pa:0,Ga:b};if(Ed.test(a)){var e=a.replace(Fd,c),f=new Gd;f.$=d.$;f.ea=d.ea;return new Ld(e,f)}return new Ld(a)};var Md=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function Q(a){var b;a instanceof Q?(Nd(this,a.ca),this.sa=a.sa,this.ga=a.ga,Od(this,a.xa),this.aa=a.aa,Pd(this,a.a.clone()),this.pa=a.pa):a&&(b=String(a).match(Md))?(Nd(this,b[1]||"",!0),this.sa=Qd(b[2]||""),this.ga=Qd(b[3]||"",!0),Od(this,b[4]),this.aa=Qd(b[5]||"",!0),Pd(this,b[6]||"",!0),this.pa=Qd(b[7]||"")):this.a=new Rd(null)}k=Q.prototype;k.ca="";k.sa="";k.ga="";k.xa=null;k.aa="";k.pa="";
k.toString=function(){var a=[],b=this.ca;b&&a.push(Sd(b,Td,!0),":");if(b=this.ga){a.push("//");var c=this.sa;c&&a.push(Sd(c,Td,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.xa;null!=b&&a.push(":",String(b))}if(b=this.aa)this.ga&&"/"!=b.charAt(0)&&a.push("/"),a.push(Sd(b,"/"==b.charAt(0)?Ud:Vd,!0));(b=this.a.toString())&&a.push("?",b);(b=this.pa)&&a.push("#",Sd(b,Wd));return a.join("")};
k.resolve=function(a){var b=this.clone();"data"===b.ca&&(b=new Q);var c=!!a.ca;c?Nd(b,a.ca):c=!!a.sa;c?b.sa=a.sa:c=!!a.ga;c?b.ga=a.ga:c=null!=a.xa;var d=a.aa;if(c)Od(b,a.xa);else if(c=!!a.aa){if("/"!=d.charAt(0))if(this.ga&&!this.aa)d="/"+d;else{var e=b.aa.lastIndexOf("/");-1!=e&&(d=b.aa.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==
h?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.aa=d:c=""!==a.a.toString();c?Pd(b,a.a.clone()):c=!!a.pa;c&&(b.pa=a.pa);return b};k.clone=function(){return new Q(this)};function Nd(a,b,c){a.ca=c?Qd(b,!0):b;a.ca&&(a.ca=a.ca.replace(/:$/,""))}function Od(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.xa=b}else a.xa=null}function Pd(a,b,c){b instanceof Rd?a.a=b:(c||(b=Sd(b,Xd)),a.a=new Rd(b))}
function Qd(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function Sd(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,Yd),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Yd(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Td=/[#\/\?@]/g,Vd=/[\#\?:]/g,Ud=/[\#\?]/g,Xd=/[\#\?@]/g,Wd=/#/g;function Rd(a){this.a=a||null}k=Rd.prototype;k.X=null;k.Oa=null;
k.add=function(a,b){if(!this.X&&(this.X={},this.Oa=0,this.a))for(var c=this.a.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("="),f=null,g=null;0<=e?(f=c[d].substring(0,e),g=c[d].substring(e+1)):f=c[d];f=decodeURIComponent(f.replace(/\+/g," "));g=g||"";this.add(f,decodeURIComponent(g.replace(/\+/g," ")))}this.a=null;(c=this.X.hasOwnProperty(a)&&this.X[a])||(this.X[a]=c=[]);c.push(b);this.Oa++;return this};
k.toString=function(){if(this.a)return this.a;if(!this.X)return"";var a=[],b;for(b in this.X)for(var c=encodeURIComponent(b),d=this.X[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.a=a.join("&")};k.clone=function(){var a=new Rd;a.a=this.a;if(this.X){var b={},c;for(c in this.X)b[c]=this.X[c].concat();a.X=b;a.Oa=this.Oa}return a};function Zd(a,b,c){a=(new DOMParser).parseFromString(a,"text/xml");return a?R({Nb:b,B:c},a,$d):(u("Failed to parse MPD XML."),null)}function $d(){this.id=this.url=null;this.type="static";this.c=this.l=this.B=this.Nb=null;this.h=5;this.f=this.j=this.b=this.g=null;this.i=1;this.a=[]}function ae(){this.m=this.c=this.b=this.B=this.a=this.start=this.id=null;this.L=[]}
function be(){this.g=this.a=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.b=!1;this.m=this.f=this.c=this.B=null;this.h=[];this.I=[]}function ce(){this.value=null}function de(){this.contentType=this.lang=this.id=null}function ee(){this.m=this.a=this.b=this.B=this.g=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function fe(){this.b=this.a=this.c=this.f=null}function ge(){this.parsedPssh=this.psshBox=null}function he(){this.url=null}
function ie(){this.url=null}function je(){this.B=null;this.u=1;this.c=this.b=this.a=this.D=null}je.prototype.clone=function(){var a=new je;a.B=ke(this.B);a.u=this.u;a.D=this.D;a.a=le(this.a);a.b=le(this.b);a.c=le(this.c);return a};function me(){this.a=this.url=null}me.prototype.clone=function(){var a=new me;a.url=ke(this.url);a.a=le(this.a);return a};function ne(){this.a=this.url=null}ne.prototype.clone=function(){var a=new ne;a.url=ke(this.url);a.a=le(this.a);return a};
function oe(){this.B=null;this.u=1;this.b=this.D=null;this.f=1;this.c=null;this.a=[];this.A=null}oe.prototype.clone=function(){var a=new oe;a.B=ke(this.B);a.u=this.u;a.D=this.D;a.b=this.b;a.f=this.f;a.c=le(this.c);a.a=ke(this.a)||[];a.A=le(this.A);return a};function pe(){this.a=this.b=null}pe.prototype.clone=function(){var a=new pe;a.b=ke(this.b);a.a=le(this.a);return a};function qe(){this.u=1;this.a=this.D=null;this.g=1;this.A=this.f=this.b=this.c=null}
qe.prototype.clone=function(){var a=new qe;a.u=this.u;a.D=this.D;a.a=this.a;a.g=this.g;a.c=this.c;a.b=this.b;a.f=this.f;a.A=le(this.A);return a};function re(){this.O=[]}re.prototype.clone=function(){var a=new re;a.O=ke(this.O)||[];return a};function se(){this.f=this.a=this.c=this.b=this.startTime=null}se.prototype.clone=function(){var a=new se;a.startTime=this.startTime;a.b=this.b;a.c=this.c;a.a=this.a;a.f=this.f;return a};function te(a,b){this.ua=a;this.end=b}
te.prototype.clone=function(){return new te(this.ua,this.end)};$d.TAG_NAME="MPD";ae.TAG_NAME="Period";be.TAG_NAME="AdaptationSet";ce.TAG_NAME="Role";de.TAG_NAME="ContentComponent";ee.TAG_NAME="Representation";fe.TAG_NAME="ContentProtection";ge.TAG_NAME="cenc:pssh";he.TAG_NAME="BaseURL";ie.TAG_NAME="Location";je.TAG_NAME="SegmentBase";me.TAG_NAME="RepresentationIndex";ne.TAG_NAME="Initialization";oe.TAG_NAME="SegmentList";pe.TAG_NAME="SegmentURL";qe.TAG_NAME="SegmentTemplate";re.TAG_NAME="SegmentTimeline";
se.TAG_NAME="S";
$d.prototype.parse=function(a,b){this.url=a.Nb;this.id=S(b,"id",T);this.type=S(b,"type",T)||"static";this.c=S(b,"mediaPresentationDuration",ue);this.h=S(b,"minBufferTime",ue,this.h);this.g=S(b,"minimumUpdatePeriod",ue,this.g);this.b=S(b,"availabilityStartTime",ve,this.b);this.j=S(b,"_availabilityStartTime",ve,this.j);this.f=S(b,"timeShiftBufferDepth",ue,this.f);this.i=S(b,"suggestedPresentationDelay",ue,this.i);var c=a.B,d=we(this,b,he);this.B=xe(c,d);if(d=R(this,b,ie))this.l=ye(c,d.url);this.a=we(this,
b,ae)};function ze(a,b,c,d){if(0!==a.a.length){var e=new be;e.contentType="text";e.lang=c||"en";e.b=!0;c=new ee;c.bandwidth=0;c.f=d||"text/vtt";c.B=[new Q(b)];e.I.push(c);a.a[0].L.push(e);Ae(a.a[0])}}ae.prototype.parse=function(a,b){this.id=S(b,"id",T);this.start=S(b,"start",ue);this.a=S(b,"duration",ue);var c=we(this,b,he);this.B=xe(a.B,c);this.b=R(this,b,je);this.c=R(this,b,oe);this.m=R(this,b,qe);this.L=we(this,b,be);Ae(this)};
function Ae(a){for(var b=[],c=0;c<a.L.length;++c){var d=a.L[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.L.length;++c)if(d=a.L[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
be.prototype.parse=function(a,b){var c=R(this,b,de)||{},d=R(this,b,ce);this.id=S(b,"id",T);this.group=S(b,"group",U);this.lang=S(b,"lang",T,c.lang);this.contentType=S(b,"contentType",T,c.contentType);this.width=S(b,"width",Be);this.height=S(b,"height",Be);this.a=S(b,"mimeType",T);this.g=S(b,"codecs",T);this.b=d&&"main"==d.value;this.lang&&(this.lang=qb(this.lang));c=we(this,b,he);this.B=xe(a.B,c);this.h=we(this,b,fe);!this.contentType&&this.a&&(this.contentType=this.a.split("/")[0]);this.c=a.b?Ce(this,
b,a.b):R(this,b,je);this.f=a.c?Ce(this,b,a.c):R(this,b,oe);this.m=a.m?Ce(this,b,a.m):R(this,b,qe);this.I=we(this,b,ee);!this.a&&this.I.length&&(this.a=this.I[0].f,!this.contentType&&this.a&&(this.contentType=this.a.split("/")[0]))};ce.prototype.parse=function(a,b){this.value=S(b,"value",T)};de.prototype.parse=function(a,b){this.id=S(b,"id",T);this.lang=S(b,"lang",T);this.contentType=S(b,"contentType",T);this.lang&&(this.lang=qb(this.lang))};
ee.prototype.parse=function(a,b){this.id=S(b,"id",T);this.bandwidth=S(b,"bandwidth",Be);this.width=S(b,"width",Be,a.width);this.height=S(b,"height",Be,a.height);this.f=S(b,"mimeType",T,a.a);this.g=S(b,"codecs",T,a.g);this.lang=a.lang;var c=we(this,b,he);this.B=xe(a.B,c);this.c=we(this,b,fe);this.b=a.c?Ce(this,b,a.c):R(this,b,je);this.a=a.f?Ce(this,b,a.f):R(this,b,oe);this.m=a.m?Ce(this,b,a.m):R(this,b,qe);this.c=this.c.concat(a.h)};
fe.prototype.parse=function(a,b){this.f=b;this.c=S(b,"schemeIdUri",T);var c=S(b,"cenc:default_KID",T);c&&(this.b=c.replace(/[-]/g,""));this.a=R(this,b,ge)};ge.prototype.parse=function(a,b){var c=De(b);if(c){this.psshBox=qc(c);try{this.parsedPssh=new Kc(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};he.prototype.parse=function(a,b){this.url=De(b)};ie.prototype.parse=function(a,b){this.url=De(b)};
je.prototype.parse=function(a,b){this.B=a.B||this.B;this.u=S(b,"timescale",Be,this.u);this.D=S(b,"presentationTimeOffset",U,this.D);this.a=S(b,"indexRange",Ee,this.a);this.b=R(this,b,me)||this.b;this.c=R(this,b,ne)||this.c};me.prototype.parse=function(a,b){var c=S(b,"sourceURL",T);this.url=ye(a.B,c);this.a=S(b,"range",Ee,le(a.a))};ne.prototype.parse=function(a,b){var c=S(b,"sourceURL",T);this.url=ye(a.B,c);this.a=S(b,"range",Ee)};
oe.prototype.parse=function(a,b){this.B=a.B||this.B;this.u=S(b,"timescale",Be,this.u);this.D=S(b,"presentationTimeOffset",U,this.D);this.b=S(b,"duration",Be,this.b);var c=S(b,"startNumber",Be);null!=c&&(this.f=c);this.c=R(this,b,ne)||this.c;this.a=(c=we(this,b,pe))&&0<c.length?c:this.a;this.A=R(this,b,re)||this.A};pe.prototype.parse=function(a,b){var c=S(b,"media",T);this.b=ye(a.B,c);this.a=S(b,"mediaRange",Ee)};
qe.prototype.parse=function(a,b){this.u=S(b,"timescale",Be,this.u);this.D=S(b,"presentationTimeOffset",U,this.D);this.a=S(b,"duration",Be,this.a);var c=S(b,"startNumber",U);null!=c&&(this.g=c);this.c=S(b,"media",T,this.c);this.b=S(b,"index",T,this.b);this.f=S(b,"initialization",T,this.f);this.A=R(this,b,re)||this.A};re.prototype.parse=function(a,b){this.O=we(this,b,se)};
se.prototype.parse=function(a,b){this.startTime=S(b,"t",U);this.a=S(b,"d",U);this.f=S(b,"r",Fe);this.b=S(b,"_t",T);this.c=S(b,"_timestampOffset",Fe)};function xe(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new Q(e)):(e=ye(a.slice(0,1),e),c.push(e[0]))}return c}function ye(a,b){if(!b)return a;var c=new Q(b);return a?a.map(function(a){return a.resolve(c)}):[c]}
function Ce(a,b,c){var d=le(c);r(d);(b=Ge(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function R(a,b,c){var d=null;if(b=Ge(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}function Ge(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function we(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}
function De(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function ke(a){return a?a.map(function(a){return a.clone()}):null}function le(a){return a?a.clone():null}function S(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function ve(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function ue(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return v("Invalid duration string:",a),null;a=0;var c=U(b[1]);c&&(a+=31536E3*c);(c=U(b[2]))&&(a+=2592E3*c);(c=U(b[3]))&&(a+=86400*c);(c=U(b[4]))&&(a+=3600*c);(c=U(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Ee(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=U(b[1]);if(null==a)return null;b=U(b[2]);return null==b?null:new te(a,b)}function Fe(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function Be(a){a=window.parseInt(a,10);return 0<a?a:null}function U(a){a=window.parseInt(a,10);return 0<=a?a:null}function T(a){return a};function He(a,b){this.url=a;this.b=b||new gc;this.g=this.i=this.h=0;this.a=null;this.c=new H;this.f=null}function gc(){this.body=null;this.a=1;this.i=1E3;this.c=0;this.method="GET";this.h="arraybuffer";this.b={};this.f=this.j=!1;this.g=null}var Ie=!0;function Je(a){Ke(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}function Ke(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}k=He.prototype;
k.Xb=function(){r(null==this.a);if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.h&&(b=pc(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);Je(this);return b}if(0==this.url.lastIndexOf("idb:",0))return r(!0),Le(this);this.h++;
this.i=(new Date).getTime();this.g||(this.g=this.b.i);this.a=new XMLHttpRequest;a=this.url;Ie&&(this.f&&!this.f.supportsCaching()||this.b.f)&&(a=new Q(a),a.a.add("_",(new Date).getTime()),a=a.toString());this.a.open(this.b.method,a,!0);this.a.responseType=this.b.h;this.a.timeout=this.b.c;this.a.withCredentials=this.b.j;this.a.onload=this.hc.bind(this);this.b.f&&(this.a.onreadystatechange=this.oc.bind(this));this.a.onerror=this.Dc.bind(this);this.a.ontimeout=this.sc.bind(this);for(b in this.b.b)this.a.setRequestHeader(b,
this.b.b[b]);this.a.send(this.b.body);return this.c};function Le(a){var b=a.url.split("/");r(4==b.length);var c=parseInt(b[2],10),b=parseInt(b[3],10);r(!isNaN(c));r(!isNaN(b));r(a.b.g);return $b(a.b.g,c,b).then(I(a,function(a){var b=JSON.parse(JSON.stringify(new XMLHttpRequest));b.response=a;a=this.c;a.resolve(b);Je(this);return a})).catch(I(a,function(a){Je(this);return Promise.reject(a)}))}
function Me(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.xhr=a.a;return b}k.hc=function(a){r(a.target==this.a);this.f&&this.f.sample((new Date).getTime()-this.i,a.loaded);200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Je(this)):this.h<this.b.a?Ne(this):(a=Me(this,"HTTP error.","net"),this.c.reject(a),Je(this))};
k.oc=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){r(this.b.f);var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Va=a-(new Date).getTime())}};k.Dc=function(a){r(a.target==this.a);a=Me(this,"Network failure.","net");this.c.reject(a);Je(this)};k.sc=function(){if(this.h<this.b.a)Ne(this);else{var a=Me(this,"Request timed out.","net");this.c.reject(a);Je(this)}};function Ne(a){Ke(a);window.setTimeout(a.Xb.bind(a),a.g*(1+.5*(2*Math.random()-1)));a.g*=2};function K(a,b,c,d){r(b);r(0<b.length);this.a=b;this.g=c||0;this.i=null!=d?d:null;this.c=this.b=null;this.j=a;this.f=null}function Oe(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}function hc(a,b,c){if(a.b)return a.b;b=b||new gc;if(a.g||a.i)b.b.Range="bytes="+(a.g+"-"+(null!=a.i?a.i:""));r(!a.c);a.b=Pe(a,0,b,c);return a.b}
K.prototype.h=function(){if(this.c){this.b=null;var a=this.c;if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){r(0!=a.a.readyState);a.a.abort();var b=Me(a,"Request aborted.","aborted");a.c.reject(b);Je(a)}this.f=this.c=null}};
function Pe(a,b,c,d){r(b<a.a.length);var e=a.a[b].toString();a.j&&(e=a.j(e,c.b)||e);a.c=new He(e,c);d&&(a.c.f=d);e=a.c.Xb().then(I(a,function(a){this.f=this.c=this.b=null;this.f=a.a?new Q(a.a):this.a[b];return Promise.resolve(a.response)}));return e=e.catch(I(a,function(a){if(this.b&&b+1<this.a.length)return w("Trying fallback URL..."),this.b=Pe(this,b+1,c,d);this.b=this.c=null;return Promise.reject(a)}))}
K.prototype.clone=function(){return new K(this.j,this.a.map(function(a){return a.clone()}),this.g,this.i)};K.prototype.toString=function(){return this.a[0].toString()};function Qe(a,b){this.b=new gc;this.b.h="text";this.b.a=3;this.b.c=1E3*(null!=b?b:0);this.b.f=!0;this.i=a}Qe.prototype.c=function(){var a=this.i;return hc(a,this.b).then(function(b){if(b=Zd(b,a.a,[a.f]))return Promise.resolve(b);b=Error("MPD parse failure.");b.type="dash";return Promise.reject(b)})};function Re(a,b,c,d){r(b.m);r(0<b.m.u);r(b.m.a);r(0<c);for(var e=b.m,f=[],g=0;g<d;++g){var h=g+c,l=(h-1)*e.a,m=l/e.u,p=(l+e.a)/e.u,h=Se(a,b,e.g+h-1,l);if(!h)return null;f.push(new Te(m,p,h))}return f}function Se(a,b,c,d){r(b.m);if(!b.m)return null;var e=b.m.c;if(!e)return v("The SegmentTemplate's media URL template is missing:","using the Representation's BaseURL instead.",b),b.B?new K(a,b.B,0,null):null;c=Ue(e,b.id,c,b.bandwidth,d);if(!c)return null;b=Oe(b.B,c);return new K(a,b,0,null)}
function Ue(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};b=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(b,c,d){if("$$"==b)return"$";var e=f[c];r(void 0!==e);if(null==e)return v("URL template does not have an available substitution for identifier",'"'+c+'":',a),b;"RepresentationID"==c&&d&&(v("URL template should not contain a width specifier for identifier",'"RepresentationID":',a),d=void 0);b=e.toString();d=window.parseInt(d,10)||1;d=Math.max(0,
d-b.length);return Array(d+1).join("0")+b});try{return new Q(b)}catch(g){if(g instanceof URIError)return v("URL template contains an illegal character:",a),null;throw g;}}
function Ve(a,b,c){r(a);var d=0;c*=b;a=a.O;for(var e,f=[],g=0;g<a.length;++g){if(!a[g].a){v('SegmentTimeline "S" element does not have a duration:','ignoring the remaining "S" elements.',a[g]);break}var h=a[g].startTime;a[g].b&&(e=M.a(a[g].b).qa(h));var h=null!=h?h:d,l=a[g].f||0;if(0>l)if(l=a[g].a,g+1===a.length)var m=a[0].startTime+c-h,l=Math.ceil(m/l)-1;else l=Math.ceil((a[g+1].startTime-h)/l)-1;0<f.length&&h!=d&&(m=h-d,.03125<=Math.abs(m/b)&&v("SegmentTimeline contains a large gap/overlap.","The content may have errors in it.",
a[g]),f[f.length-1].end=h);for(m=0;m<=l;++m){var d=h+a[g].a,p={start:h,end:d};e&&(p.ac=e.add(h),p.Nc=e.add(d));f.push(p);h=d}}return f};function We(a,b){r(!a||!b);this.a=a;this.b=b||null}We.prototype.destroy=function(){this.a&&(this.a.h(),this.a=null);this.b=null};We.prototype.create=function(){return this.a?hc(this.a):Promise.resolve(this.b)};function Te(a,b,c){r(null==b||a<=b,"startTime should be <= endTime");this.startTime=a;this.a=b;this.url=c}function Xe(a,b,c){return new Te(b,c,a.url)}function ic(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.a||b<d.a))return c}return-1}function Ye(a,b){return a.map(function(a){return Xe(a,a.startTime+b,null!=a.a?a.a+b:null)})}
function Ze(a){for(var b=a[0],c=1;c<a.length;++c){var d=a[c],e=d.startTime>b.startTime&&d.startTime<=b.a&&(d.a&&d.a>=b.a||c==a.length-1);r(e,"SegmentReferences are not correct.");e||x("SegmentReferences should be sorted without gaps:","previous",b,"current",d);b=d}};function $e(){}
$e.prototype.parse=function(a,b,c,d){var e=null;try{a:{var f=[],g=new Wa(a),h=$a(g);if(1936286840!=$a(g))u('Invalid box type, expected "sidx".'),e=null;else{1==h&&(h=ab(g));var l=Za(g);cb(g,3);cb(g,4);var m=$a(g);r(0!=m);if(0==m)u("Invalid timescale."),e=null;else{var p,t;0==l?(p=$a(g),t=$a(g)):(p=ab(g),t=ab(g));cb(g,2);var C=g.b.getUint16(g.a,g.c);g.a+=2;a=p;b=b+h+t;for(h=0;h<C;h++){var D=$a(g);t=(D&2147483648)>>>31;var l=D&2147483647,L=$a(g);$a(g);if(1==t){u("Heirarchical SIDXs are not supported.");e=
null;break a}var fa=new K(d,c,b,b+l-1);f.push(new Te(a/m,(a+L)/m,fa));a+=L;b+=l}e=f}}}}catch(Bc){if(!(Bc instanceof RangeError))throw Bc;}return e};function V(a){this.o=a;this.l=0}V.prototype.destroy=function(){this.o=null};k=V.prototype;k.length=function(){return this.o.length};function af(a){if(0==a.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.o[0]}k.F=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]};
k.get=function(a){if(0>a||a>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[a]};k.Aa=function(a){a=ic(this.o,a);return 0<=a?this.o[a]:null};k.fb=function(a){bf(this,a);return!0};
function bf(a,b){if(a.l!=b.l){var c=a.l-b.l;da("Shifting new SegmentReferences by",c,"seconds before merging.");b=new V(Ye(b.o,c))}if(0==a.length())a.o=b.o.slice(0),Ze(a.o);else if(0==b.length())x("Nothing to merge: new SegmentIndex is empty.");else if(null==a.F().a)x("Nothing to merge:","existing SegmentIndex ends at the end of the stream.");else if(null!=b.F().a&&b.F().a<a.F().a)x("Nothing to merge:","new SegmentIndex ends before the existing one ends.");else{if(a.F().a<=af(b).startTime)c=Xe(a.F(),
a.F().startTime,af(b).startTime),c=a.o.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.o.length&&!(a.o[d].a>=af(b).startTime);++d);r(d<a.o.length);a.o[d].startTime<af(b).startTime?(c=Xe(a.o[d],a.o[d].startTime,af(b).startTime),c=a.o.slice(0,d).concat([c])):(r(af(a).startTime>af(b).startTime||a.o[d].startTime==af(b).startTime),c=a.o.slice(0,d))}a.o=c.concat(b.o);Ze(a.o)}}
k.za=function(a){var b=a-this.l;if(0==b)return da("Already applied timestamp correction of",a,"seconds to",this),0;this.o=Ye(this.o,b);Ze(this.o);this.l=a;x("Applied timestamp correction of",a,"seconds to SegmentIndex",this);return b};k.bb=function(){return 0<this.length()?{start:af(this).startTime,end:this.F().a}:{start:0,end:0}};function cf(a,b,c,d){r(null!=b.b);r(null!=c.start);V.call(this,a);this.h=b;this.w=c;this.g=d;this.i=this.h.c||this.h.a.reduce(function(a,b){return null==b.a?NaN:a+b.a},0)||0;this.a=this.f=this.b=null;df(this)}q(cf,V);cf.prototype.destroy=function(){this.w=this.h=null;V.prototype.destroy.call(this)};cf.prototype.Aa=function(a){ef(this,Ua()/1E3);return V.prototype.Aa.call(this,a)};
cf.prototype.fb=function(a){if(!(a instanceof cf))return v("Cannot integrate SegmentIndex:","Only a LiveSegmentIndex can be integrated into","another LiveSegmentIndex.",this),!1;bf(this,a);this.i=Math.max(this.i,a.i);null==this.b?(this.g=a.g,df(this)):ff(this);return!0};
function df(a){r(null==a.b);r(null==a.f);r(null==a.a);ff(a);if(0!=a.length()){r(0<a.length());var b=null!=a.F().a?a.F().a:a.F().startTime;if(a.h.b>a.g)v("The stream might not be available yet!",a.w),a.b=b;else{var c=a.g-(a.h.b+a.w.start);0>c?(v("The Period might not be available yet!",a.w),a.b=b):c<Math.max(a.F().startTime,a.F().a||0)?(v("@availabilityStartTime seems to be inaccurate;","some segments may not be available yet:","currentPresentationTime",c,"latestAvailableSegmentEndTime",a.F().a,"difference",
a.F().a-c),a.b=b):a.b=c}a.f=a.F().startTime-10;a.a=af(a).startTime;y("originalPresentationTime_",a.b);y("originalLiveEdge_",a.f);y("seekStartTime_",a.a);b=a.b+(Ua()/1E3-a.g);a.f>b&&u("The live-edge ("+a.f+")","should not be greater than","the current presentation time ("+b+")")}}
cf.prototype.za=function(a){var b=V.prototype.za.call(this,a),c=Math.min.apply(null,this.o.filter(function(a){return null!=a.a}).map(function(a){return a.a-a.startTime}));Math.abs(b)>c&&v("Timestamp correction ("+a+")","is unreasonably large for live content.","The content may have errors in it.");null!=this.b&&(r(null!=this.f),r(null!=this.a),this.f+=b,this.a+=b,this.b+=b,r(this.f<=this.b));return b};cf.prototype.bb=function(){return gf(this,Ua()/1E3)};
function gf(a,b){ef(a,b);if(null==a.b||null==a.f||null==a.a)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.i&&(c=a.i);var d=b-a.g,e=a.b+d;null!=a.h.f&&(e-=a.a,r(0<=e),e-=a.h.f,0<e&&(a.a+=e));a.a=Math.min(a.a,c);0<a.length()&&r(a.a>=af(a).startTime,"The seek start time ("+a.a+")should not be less thanthe first segment's start time ("+af(a).startTime+")");d=a.f+d;if(d<a.a)return{start:a.a,end:a.a};d=0<a.length()?null!=a.F().a?Math.min(d,a.F().a):d:a.a;a.a>d&&x("The seek start time ("+a.a+")",
"has surpassed the target seek end time ("+d+")");d=Math.max(d,a.a);d=Math.min(d,c);return{start:a.a,end:d}}function ef(a,b){ff(a);if(null!=a.h.f)if(null==a.b)r(0==a.length());else{for(var c=a.b+(b-a.g),d=0,e=0;e<a.o.length;++e){var f=null;e<a.o.length-1?f=a.o[e+1].a:(f=a.o[e],f=null!=f.a?f.a+(f.a-f.startTime):null);if(null!=f&&f<c-a.h.f)++d;else break}0<d&&(a.o.splice(0,d),x("Evicted",d,"SegmentReference(s),",a.o.length,"SegmentReference(s) remain."))}}
function ff(a){if(a.i){for(var b=0,c=a.o.length-1;0<=c;--c)if(a.o[c].startTime>a.i)++b;else break;0<b&&(a.o.splice(-b),v("Segments found after stream end, evicted",b,"SegmentReference(s),",a.o.length,"SegmentReference(s) remain."))}};function sf(a,b,c,d,e){r(null!=a.b);r(null!=b.start);r(c.m);r(c.m.a);r(0<c.m.u);var f=1,g=0,h;r(null!=b.start);r(c.m);r(c.m.a);r(0<c.m.u);if(a.b>d)v("The stream is not available yet!",c),h=null;else{var l=a.i||0,m=a.f||0;h=c.m;h=h.a/h.u;var p=d-(a.b+b.start);0>p?(v("The Period is not available yet!",c),h=null):(m=p-2*h-m,0>m&&(y("The earliest available segment is not available yet.",c),m=0),m=Math.ceil(m/h)*h,p-=h,0>p?(u("The current segment is not available yet!",c),h=null):(l=Math.floor(p/h)*h-
l,0>l&&(y("bestAvailableTimestamp < 0"),l=0),l=Math.floor(l/h)*h,l>=m?x("The best available segment is still available."):(l=m,x("The best available segment is no longer available.")),m=m/h+1,r(m==Math.round(m),"earliestSegmentNumber should be an integer."),h=l/h+1,r(h==Math.round(h),"currentSegmentNumber should be an integer."),y("earliestSegmentNumber",m),y("currentSegmentNumber",h),h={Eb:m,current:h}))}h&&(f=h.Eb,g=h.current-h.Eb+1);f=Re(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),
a.type="stream",a;r(0==f.length||null!=f[f.length-1].a);cf.call(this,f,a,b,d);this.M=c;this.c=0<this.length()?a.b+b.start+this.F().a:null;r(this.c<=d);this.j=this.c;this.s=h?h.current+1:null;this.C=e}q(sf,cf);sf.prototype.destroy=function(){this.C=this.M=null;cf.prototype.destroy.call(this)};sf.prototype.Aa=function(a){var b=Ua()/1E3;tf(this,b);ef(this,b);return V.prototype.Aa.call(this,a)};
sf.prototype.fb=function(a){if(null!=this.c)return x("Ignoring SegmentIndex integration.",this),!1;if(!(a instanceof sf))return v("Cannot integrate SegmentIndex:","Only a DynamicLiveSegmentIndex can be integrated into","another DynamicLiveSegmentIndex.",this),!1;if(null==a.c)return!1;this.c=a.c;this.j=a.j;this.s=a.s;this.g=a.g;this.i=a.i;bf(this,a);tf(this,Ua()/1E3);df(this);return!0};sf.prototype.za=function(a){a=cf.prototype.za.call(this,a);null!=this.c&&(r(null!=this.j),this.c+=a,this.j+=a);return a};
sf.prototype.bb=function(){var a=Ua()/1E3;tf(this,a);return gf(this,a)};function tf(a,b){if(null!=a.c&&null!=a.j&&null!=a.s){var c=a.j+(b-a.g)-a.c;r(0<=c);var d=a.M.m,d=d.a/d.u,c=Math.floor(c/d);if(0!=c){var e=Re(a.C,a.M,a.s,c);r(e);Array.prototype.push.apply(a.o,Ye(e,a.l));Ze(a.o);a.c+=c*d;a.s+=c;x("Generated",c,"SegmentReference(s).")}}};function uf(a,b,c,d,e){r(null!=b.start);r("dynamic"==a.type||null!=b.a);r(c.m);r(0<c.m.u);r(c.m.a);this.c=a;this.b=b;this.f=c;this.h=d;this.a=null;this.g=e}uf.prototype.destroy=function(){this.g=this.f=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
uf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.c.type)try{this.a=new sf(this.c,this.b,this.f,this.h,this.g)}catch(a){return Promise.reject(a)}else{r("static"==this.c.type);var b;b=this.f.m;if(b=Re(this.g,this.f,1,Math.ceil(this.b.a/(b.a/b.u)))){if(0<b.length){var c=b[b.length-1];r(c.startTime<=this.b.a);r(c.a>=this.b.a);b[b.length-1]=Xe(c,c.startTime,this.b.a)}b=new V(b)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),
b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function vf(a,b,c,d,e){r(c.a);var f=c.a.A;r(c.a.b||1==c.a.a.length||null!=f&&0<f.O.length);r(0<c.a.u);this.c=a;this.b=b;this.g=c;this.a=null;this.h=d;this.f=e}vf.prototype.destroy=function(){this.f=this.g=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
vf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.g.a,b=[];a.A&&(b=Ve(a.A,a.u||1,this.b.a||0));var c=0;a.b&&a.f?c=(a.f-1)*a.b:0<b.length&&(c=b[0].start-(a.D||0));var d=a.a.length;0<b.length&&b.length!=a.a.length&&(d=Math.min(b.length,a.a.length),v("The length of the segment timeline and segment","urls does not match, truncating",a.a.length,"to",d));for(var e=[],f=0;f<d;++f){var g=a.a[f];r(0<=c);var h=c/a.u,l=null,m=null;a.b?(l=c+a.b,m=l/a.u):0<b.length?(l=b[f].end-
(a.D||0),m=l/a.u):(r(1==a.a.length),r(this.b.a),m=h+this.b.a,l=m*a.u);var c=l,l=0,p=null;g.a&&(l=g.a.ua,p=g.a.end);e.push(new Te(h,m,new K(this.f,g.b,l,p)))}"dynamic"==this.c.type?this.a=new cf(e,this.c,this.b,this.h):(r("static"==this.c.type),this.a=new V(e));return Promise.resolve(this.a)};function wf(a,b,c,d,e){r(null!=b.start);r(c.m);r(c.m.c);r(0<c.m.u);r(c.m.A);this.b=a;this.f=b;this.g=c;this.i=d;this.a=null;this.h=e;this.c=null}wf.prototype.destroy=function(){this.h=this.g=this.f=this.b=null;this.a&&(this.a.destroy(),this.a=null);var a=this.c;this.c=null;return a};
wf.prototype.create=function(a){if(this.a)return Promise.resolve(this.a);var b=this.g.m,c=Ve(b.A,b.u||1,this.f.a||0);this.c={A:c};var d=[],e=0;if(a&&a.A&&a.o){for(var e=a.A,f=0,g=0;g<e.length;g++){var h=e[g];if(c[0].start===h.start&&c[0].end===h.end)break;else f=g+1}(e=f)&&a.o.splice(0,e);a:{e=a.A;e=e[e.length-1];for(f=c.length;0<f;f--)if(g=c[f-1],e.start===g.start&&e.end===g.end){e=f;break a}e=0}}for(;e<c.length;++e){var h=c[e].start,l=c[e].ac,f=h/b.u,g=c[e].end/b.u,h=Se(this.h,this.g,e+b.g,l?l.toString():
h);if(!h)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);l=(b.D||0)/b.u;d.push(new Te(f-l,g-l,h))}a&&a.o&&(d=a.o.concat(d));this.c.o=d;"dynamic"==this.b.type?this.a=new cf(d,this.b,this.f,this.i):(r("static"==this.b.type),this.a=new V(d));return Promise.resolve(this.a)};function xf(a){this.b=a;this.a=null}xf.prototype.destroy=function(){this.b=null;this.a&&(this.a.destroy(),this.a=null)};xf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=[],b=0;b<this.b.length;++b){var c=this.b[b];a.push(new Te(c.start_time,c.end_time,new K(null,[new Q(c.url)],c.start_byte,null)))}this.b=null;this.a=new V(a);return Promise.resolve(this.a)};function yf(){this.G=zf++;this.id=this.N=this.S=null;this.f=0;this.height=this.width=this.bandwidth=null;this.c=this.a="";this.g=[];this.fa=!1;this.b=!0}var zf=0;yf.prototype.destroy=function(){var a;this.S&&(a=this.S.destroy(),this.S=null);this.N&&(this.N.destroy(),this.N=null);return a};function Af(a){return a.fa&&a.b}function Bf(a){var b=a.a||"";a.c&&(b+='; codecs="'+a.c+'"');return b}function Cf(){this.G=Df++;this.id=null;this.contentType=this.lang="";this.b=!1;this.v=[];this.a=[]}var Df=0;
Cf.prototype.destroy=function(){for(var a={},b=0;b<this.v.length;++b){var c=this.v[b];c.id?a[c.id]=c.destroy():c.destroy()}this.a=this.v=null;return a};function Ef(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Ff;d.id=a.G;d.a=a.a[c];d.contentType=a.contentType;d.b=a.v.length?Bf(a.v[0]):"";b.push(d)}return b}function Gf(){this.id=null;this.start=0;this.b=null;this.a=[]}
Gf.prototype.destroy=function(){for(var a={},b=0;b<this.a.length;++b){var c=this.a[b].destroy();Object.getOwnPropertyNames(c).forEach(function(b){a[b]=c[b]})}this.a=null;return a};function Hf(){this.a=!1;this.h=this.g=this.f=null;this.c=0;this.b=[]}Hf.prototype.destroy=function(){for(var a={},b=0;b<this.b.length;++b){var c=this.b[b].destroy();Object.getOwnPropertyNames(c).forEach(function(b){a[b]=c[b]})}this.b=null;return a};function Ff(){this.id=0;this.a=null;this.b=this.contentType=""};function If(a,b,c,d,e){G.call(this,a);this.l=b;this.a=new ac(c,d,e);this.C=this.H=this.i=null;this.U=!1;this.b=null;this.f=!1;this.w=null;this.h=!1;this.s=new H;this.j=this.c=!1;this.J=0;this.Y=15;this.g=this.K=!1;this.T=d.split(";")[0];r(0<this.T.length)}q(If,G);
If.prototype.P=function(a){null!=a.initialStreamBufferSize&&(this.J=Number(a.initialStreamBufferSize));null!=a.streamBufferSize&&(this.Y=Number(a.streamBufferSize));if(null!=a.segmentRequestTimeout){var b=this.a;a=Number(a.segmentRequestTimeout);r(!isNaN(a));b.w=a}};If.prototype.destroy=function(){Jf(this);this.s.destroy();this.i=this.s=null;this.a.destroy();this.M=this.l=this.a=null};k=If.prototype;k.Ea=function(){return this.i};k.Ib=function(){return this.H};
k.Zb=function(a){this.c||a.then(function(){r(this.h);r(!this.c);r(!this.j);x(W(this),"proceeding...");this.c=!0;this.b||Kf(this,0)}.bind(this)).catch(function(a){r("destroy"==a.type)});return this.s};k.eb=function(){return this.j};
k.Ja=function(a,b,c){r(a.a==this.T,"The stream's type must match the Stream's SourceBuffer's type.");if(a==this.i)x(W(this),"already using stream",a);else{var d=[a.S.create(),a.N.create()];Promise.all(d).then(I(this,function(d){if(this.l){var f=this.i;this.i=a;this.H=d[0];this.C=d[1];this.U=!0;this.f||(f?b?Lf(this,!0,c):r(null!=this.b||this.g):Kf(this,0))}})).catch(I(this,function(a){"aborted"!=a.type&&(this.c?(a=B(a),this.dispatchEvent(a)):this.s.reject(a))}))}};
k.Pb=function(){x(W(this),"resync");return Lf(this,!1)};
function Lf(a,b,c){a.i&&!a.f&&(r(null!=a.b||a.g||a.h&&!a.c,"Unexpected call to resync_()."),r(!c||0<c),a.f=!0,Jf(a),cc(a.a).then(I(a,function(){y(W(this),"abort done.");r(null==this.b&&this.f);r(!this.g);var a=this.l.currentTime;if(!b&&0<dc(this.a,a)&&0<=ic(this.a.b,a))return x(W(this),"no clear required."),Promise.resolve();x(W(this),"clear required.");if(c)return lc(this.a,this.l.currentTime+c);x(W(this),"nudge needed!");this.K=!0;return kc(this.a)})).then(I(a,function(){r(null==this.b&&this.f);
r(!this.g);this.f=!1;Kf(this,0)})).catch(I(a,function(a){r("aborted"!=a.type);this.f=!1;this.c?(a=B(a),this.dispatchEvent(a)):this.s.reject(a)})))}k.Qb=function(a){return 0<dc(this.a,a)&&0<=ic(this.a.b,a)};k.Ta=function(){};k.ab=function(){return!0};
k.uc=function(){da(W(this),"onUpdate_");r(this.i);r(this.H);r(null!=this.b&&!this.f);r(!this.g);if(this.h&&!this.c)y(W(this),"waiting to proceed..."),this.b=null;else if(this.c&&!this.j&&nc(this.a))Lf(this,!0);else{this.b=null;var a=this.i,b=this.H,c=this.l.currentTime;dc(this.a,this.h?c:c+(this.w||0))>=(this.h?Math.max(this.J,this.Y):this.J)?(y(W(this),"buffering goal reached."),Mf(this),Kf(this,1E3/(Math.abs(this.l.playbackRate)||1))):(b=Nf(this,c,b))?(this.g=!0,this.C&&y(W(this),"appending initialization data..."),
y(W(this),"fetching segment",b),b=ec(this.a,b,a.f,this.C),this.C=null,this.U&&(this.U=!1,Of(this,a)),this.j=!1,b.then(I(this,function(a){y(W(this),"fetch done.");r(null==this.b&&!this.f);r(this.g);this.g=!1;null==this.w&&(r(!this.h),r(null!=a),this.w=a);this.K&&0<dc(this.a,c)&&(x(W(this),"applying nudge..."),this.K=!1,this.l.currentTime+=.001);Kf(this,0)})).catch(I(this,function(a){this.g=!1;if("aborted"==a.type)y(W(this),"fetch aborted."),r(!this.a||this.f);else{var b=[0,404,410];"net"==a.type&&
-1!=b.indexOf(a.xhr.status)&&this.i&&(w(W(this),"retrying segment request in 5 seconds..."),Kf(this,5E3));a=B(a);this.dispatchEvent(a)}}))):(y(W(this),"new segment is not needed or is not available."),Mf(this),this.c&&!this.j&&(r(this.h),x(W(this),"stream has ended."),this.j=!0,Pf(this)),Kf(this,1E3))}};function Nf(a,b,c){a=a.a;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.a?c.Aa(a.a):null:c.Aa(b)||(c.length()?c.F():null)}
function Mf(a){if(!a.h&&null!=a.w){r(!a.c);r(!a.j);w(W(a),"stream has started.");a.h=!0;var b=a.a,c=a.w,d=c-b.M;0!=d&&(b.b=Ye(b.b,d),b.M=c,x(J(b),"applied timestamp correction of",c,"seconds to SourceBufferManager",b));a.s.resolve(a.w)}}function Of(a,b){var c;c=b.a.split("/")[0];c=A({type:"adaptation",bubbles:!0,contentType:c,size:"video"!=c?null:{width:b.width,height:b.height},bandwidth:b.bandwidth});a.dispatchEvent(c)}function Pf(a){r(a.j);var b=A({type:"ended"});a.dispatchEvent(b)}
function Kf(a,b){r(null==a.b);a.b=window.setTimeout(a.uc.bind(a),b)}function Jf(a){null!=a.b&&(window.clearTimeout(a.b),a.b=null)}function W(a){return"Stream "+a.T+":"};function Qf(a){this.b=a;this.a=null}Qf.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};Qf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new Te(0,null,this.b);this.a=new V([a]);return Promise.resolve(this.a)};function Rf(a,b){G.call(this,a);this.b=b;this.g=!0;this.h=this.f=null;this.c=new H;this.a=null}q(Rf,G);Rf.prototype.P=function(){};Rf.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.c.destroy();this.M=this.b=this.f=this.h=this.a=this.c=null};k=Rf.prototype;k.Ea=function(){return this.f};k.Ib=function(){return this.h};k.Zb=function(){return this.c};k.eb=function(){return!0};
k.Ja=function(a){w("Switching stream to",a);a.S.create().then(I(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.f;this.f=a;this.h=b;b=af(b).url.a[0].toString();var d=this.ab();this.a&&(this.Ta(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.Ta(d);b=A({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.c.resolve(0)}}))};
k.Pb=function(){};k.Qb=function(){return!0};k.Ta=function(a){this.g=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};k.ab=function(){this.a&&(this.g="showing"==this.a.track.mode);return this.g};function Sf(){}
Sf.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new db(b);if(440786851!=fb(g).id)u("EBML element does not exist."),f=null;else{var h=fb(g);if(408125543!=h.id)u("Segment element does not exist."),f=null;else{var l=h.a.byteOffset,m;var p=new db(h.a);for(b=null;Ya(p.a);){var t=fb(p);if(357149030==t.id){b=t;break}}if(b){for(var C=new db(b.a),p=1E6;Ya(C.a);){var D=fb(C);if(2807729==D.id){p=kb(D);break}}m=p/1E9}else u("Info element does not exist."),m=null;f=m?{Ac:l,Ec:m}:null}}if(f){var L=
fb(new db(a));if(475249515!=L.id)u("CuesElement does not exist."),e=null;else{var fa=f.Ac,Bc=f.Ec;a=[];var hf=new db(L.a);for(f=L=-1;Ya(hf.a);){var jf=fb(hf);if(187==jf.id){var hb;var kf=new db(jf.a),lf=fb(kf);if(179!=lf.id)v("CueTime element does not exist."),hb=null;else{var Mg=kb(lf),mf=fb(kf);if(183!=mf.id)v("CueTrackPositions element does not exist."),hb=null;else{for(var nf=new db(mf.a),l=0;Ya(nf.a);){var of=fb(nf);if(241==of.id){l=kb(of);break}}hb={Gc:Mg,zc:l}}}if(hb){var pf=Bc*hb.Gc,qf=fa+
hb.zc;if(0<=L){r(0<=f);var Jd=new K(d,c,f,qf-1);a.push(new Te(L,pf,Jd))}L=pf;f=qf}}}0<=L&&(r(0<=f),Jd=new K(d,c,f,null),a.push(new Te(L,null,Jd)));e=a}}else e=null}catch(rf){if(!(rf instanceof RangeError))throw rf;}return e};function Tf(a,b,c,d,e,f,g){r("webm"!=c||e);this.f=a;this.i=b;this.g=c;this.a=d;this.c=e;this.j=f;this.b=null;this.h=g}Tf.prototype.destroy=function(){this.h=this.i=this.f=null;this.a.h();this.a=null;this.c&&(this.c.h(),this.c=null);this.b=null};
Tf.prototype.create=function(){if(this.b)return this.b;var a=[hc(this.a)];"webm"==this.g&&a.push(hc(this.c));return this.b=Promise.all(a).then(I(this,function(a){var c=a[0];a=a[1]||null;var d=null;"mp4"==this.g?(d=new $e,d=d.parse(new DataView(c),this.a.g,this.a.a,this.h)):"webm"==this.g?(r(a),d=new Sf,d=d.parse(new DataView(c),new DataView(a),this.a.a,this.h)):ca();if(!d)return c=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);
"dynamic"==this.f.type?c=new cf(d,this.f,this.i,this.j):(r("static"==this.f.type),c=new V(d));return Promise.resolve(c)}))};function Uf(a){this.a=a}
function Vf(a,b,c){for(var d=Ua()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.L.length;++g){var h=f.L[g];if("text"!=h.contentType)for(var l=0;l<h.I.length;++l){var m=h.I[l],p=0,p=p+(m.b?1:0),p=p+(m.a?1:0),p=p+(m.m?1:0);0==p?(v("Representation does not contain any segment information:","the Representation must contain one of SegmentBase,","SegmentList, or SegmentTemplate.",m),h.I.splice(l,1),--l):1!=p&&(v("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,",
"SegmentList, or SegmentTemplate.",m),m.b?(w("Using SegmentBase by default."),m.a=null,m.m=null):m.a?(w("Using SegmentList by default."),m.m=null):ca())}}Wf(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.L.length;++g){l=h=f.L[g];m=null;for(p=0;p<l.I.length;++p){var t=l.I[p].f||"";m?t!=m&&(v("Representation does not have the same MIME type as other","Representations within its AdaptationSet.",l.I[p]),l.I.splice(p,1),--p):m=t}0==h.I.length&&(f.L.splice(g,1),--g)}"dynamic"==b.type&&null==b.b&&(v("The MPD is 'dynamic' but @availabilityStartTime is not specified:",
"treating @availabilityStartTime as if it were the current time."),b.b=d);e=new Hf;"dynamic"==b.type&&(e.a=!0,e.f=b.g,e.g=new K(c,b.l||b.url),e.h=b.b);e.c=b.h||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start){v("Skipping Period",f+1,"and any subsequent Periods:","Period",f+1,"does not have a valid start time.",g);break}g=Xf(a,b,g,d,c);e.b.push(g)}return e}
function Wf(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.c=null);b(a.c)&&1==a.a.length&&!b(a.a[0].a)&&(a.a[0].a=a.c);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.c};!b(g.start)&&f&&b(f.start)&&b(f.a)&&(g.start=f.start+f.a);!b(g.a)&&b(h.start)&&(g.a=h.start-g.start);null!=g.start&&null!=g.a?c+=g.a:d=!1}b(a.c)?a.c!=c&&v("@mediaPresentationDuration does not match the total duration of all","Periods."):
(e=a.a[a.a.length-1],d?(r(b(e.start)&&b(e.a)),r(c==e.start+e.a),a.c=c):b(e.start)&&b(e.a)?(v("Some Periods may not have valid start times or durations."),a.c=e.start+e.a):"dynamic"!=a.type&&(v("Some Periods may not have valid start times or durations;","@mediaPresentationDuration may not include the duration of all","periods."),a.c=c))}}
function Xf(a,b,c,d,e){r(null!=c.start);var f=new Gf;f.id=c.id;f.start=c.start;f.b=c.a;var g=new E;c.L.forEach(function(a){g.push(a.contentType||"",a)});for(var h=Cb(g),l=0;l<h.length;++l){var m=new E;g.get(h[l]).forEach(function(a){m.push(a.group,a)});for(var p=Cb(m),t=0;t<p.length;++t){var C=p[t];r(null!=C);var D=new E;m.get(C).forEach(function(a){D.push(a.lang,a)});for(var C=Cb(D),L=0;L<C.length;++L){var fa=D.get(C[L]),fa=Yf(a,b,c,fa,d,e);f.a.push(fa)}}}return f}
function Yf(a,b,c,d,e,f){r(0<d.length);r(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new Cf,h=d.filter(function(a){return null!=a.id});h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.b=d.some(function(a){return a.b});for(var h={},l=0;l<d.length;++l)for(var m=d[l],p=0;p<m.I.length;++p){var t=m.I[p],
C=Zf(a,t),D=g.a.slice(0);$f(C,D);if(0==D.length&&0<g.a.length)v("Representation does not contain any ContentProtection elements","that are compatible with other Representations within its","AdaptationSet or AdaptationSet group.",t);else if(t=ag(b,c,t,e,f))g.v.push(t),g.a=D,h[t.G]=m}if(g.a.some(function(a){return""==a.a}))return g.v.forEach(function(a){a.fa=!0}),g;a=bg(d);for(l=0;l<g.v.length;++l)t=g.v[l],m=h[t.G],m==a&&(y("Assuming the key system can decrypt stream",t.id+"."),t.fa=!0);return g}
function bg(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.I.length;++f){var g=e.I[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}function $f(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e)if(vc(b[c],a[e])){d=!0;wc(b[c],a[e].b);break}d||(b.splice(c,1),--c)}}
function Zf(a,b){var c=[];if(0==b.c.length)c.push(new sc);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,cg(a,b.c[d]));return c}
function cg(a,b){var c=[];if(2!=a.a.length)return u("You must use the new-style ContentProtection interpretation API.","See shaka.player.DashVideoSource.ContentProtectionCallback."),[];var d=a.a(b.c||"",b.f);if(!d)return[];if(!(d instanceof Array))return u("ContentProtection interpretation callback must return","an array of shaka.player.DrmInfo.Config objects."),[];for(var e=0;e<d.length;++e){var f=tc(d[e]);0==f.b.length&&b.a&&b.a.psshBox&&wc(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function ag(a,b,c,d,e){if(!c.B||0===c.B.length)return v("Representation does not contain sufficient segment information:","the Representation must contain a BaseURL.",c),null;var f=null,g=1,h=0,l=0;if(c.b)r(c.b),r(0<c.b.u),f=c.f.split("/")[1],"mp4"!=f&&"webm"!=f?(v("SegmentBase specifies an unsupported container type.",c),f=null):(g=c.b,"webm"!=f||g.c?g.a||g.b&&g.b.a?(h=g.b,h||(h=new me,h.url=c.B,h.a=g.a?g.a.clone():null),h=dg(h,e),g=g.c?dg(g.c,e):null,a=new Tf(a,b,f,h,g,d,e),b=new We(g),d=new yf,
d.S=a,d.N=b,f=d):(v("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",g),f=null):(v("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",g),f=null)),g=c.b.u,h=c.b.D;else if(c.a)r(c.a),f=c.a,!f.b&&!f.A&&1<f.a.length?(v("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,",
"but does not specify a segment duration or timeline.",f),f=null):f.b||b.a||f.A||1!=f.a.length?f.A&&0===f.A.O.length?(v("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",f),f=null):(f=f.c?dg(f.c,e):null,a=new vf(a,b,c,d,e),b=new We(f),d=new yf,d.S=a,d.N=b,f=d):(v("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",f),f=
null),g=c.a.u,h=c.a.D;else if(c.m){a:if(r(c.m),f=c.m,g=0+(f.b?1:0),g+=f.A?1:0,g+=f.a?1:0,0==g?(v("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",f),g=!1):(1!=g&&(v("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",f),f.b?(w("Using the index URL template by default."),
f.A=null,f.a=null):f.A?(w("Using the SegmentTimeline by default."),f.a=null):ca()),g=!0),g){g=null;if(f.f&&(r(c.m),g=(f=c.m.f)?eg(c,f,ne):null,!g)){f=null;break a}f=g?dg(g,e):null;r(c.m);g=c.m;g.b?(r(c.m),r(c.m.b),g=c.f.split("/")[1],"mp4"!=g&&"webm"!=g?(v("SegmentTemplate specifies an unsupported container type.",c),a=null):(h=c.m,"webm"!=g||f?Se(e,c,1,0)?(r(c.m),(h=(h=c.m.b)?eg(c,h,me):null)?(h=dg(h,e),a=new Tf(a,b,g,h,f,d,e)):a=null):a=null:(v("SegmentTemplate does not contain sufficient segment information:",
"the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",h),a=null))):g.c?g.A?a=new wf(a,b,c,d,e):g.a?"dynamic"!=a.type&&null==b.a?(v("SegmentTemplate does not contain sufficient segment information:","the Period's duration is not known.",c),a=null):a=new uf(a,b,c,d,e):(ca(),a=null):(v("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",c),a=null);a?(b=new We(f),d=new yf,d.S=a,d.N=b,f=
d):f=null}else f=null;g=c.m.u;h=c.m.D;c.m.A&&c.m.A.O[0]&&c.m.A.O[0].c&&(l=c.m.A.O[0].c)}else"text"==c.f.split("/")[0]?(f=new yf,f.S=new Qf(new K(e,c.B))):ca();if(!f)return null;f.id=c.id;l?(w("Applying timestamp offset from big integer workaround.",l),f.f=-1*l):h&&(f.f=-1*h/g);f.bandwidth=c.bandwidth;f.width=c.width;f.height=c.height;f.a=c.f||"";f.c=c.g||"";for(l=0;l<c.c.length;++l)a=c.c[l],a.b&&f.g.push(a.b);return f}
function eg(a,b,c){r(a.m);b=Ue(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=Oe(a.B,b);return c}function dg(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.ua,e=a.a.end);return new K(b,c,d,e)};function fg(){this.streamStats=null;this.droppedFrames=this.decodedFrames=NaN;this.bufferingTime=this.playTime=this.estimatedBandwidth=0;this.playbackLatency=NaN;this.bufferingHistory=[];this.bandwidthHistory=[];this.streamHistory=[]}function gg(a,b){var c=new hg(b);a.streamHistory.push(new ig(c));if(c.videoHeight||!a.streamStats)a.streamStats=c}function hg(a){this.videoWidth=a.width;this.videoHeight=a.height;this.videoMimeType=a.a;this.videoBandwidth=a.bandwidth}
function ig(a){this.timestamp=Ua()/1E3;this.value=a};function jg(a,b){Nb.call(this,"readwrite",b);this.j=a;this.b=0}q(jg,Nb);function kg(a,b){r(!isNaN(b));a.b=b}
function lg(a,b,c,d,e){for(var f=[],g=[],h=0,l=0,m=[],p=b.map(function(a){return a.S.create()}),p=Promise.all(p),t=b.map(function(a){return a.N.create()}),t=Promise.all(t),p=Promise.all([p,t]).then(function(a){f=a[0];g=a[1];h=f.reduce(function(a,b){return a+b.length()},0)}),t=0;t<b.length;++t)p=p.then(function(a){return mg(this,b[a],f[a],g[a],h,l)}.bind(a,t)),p=p.then(function(a,b){l+=f[a].length();m.push(b)}.bind(a,t));return p.then(I(a,function(){return ng(Ub(this))})).then(I(a,function(a){var b=
new H;c=Ta(c);var f={group_id:a,stream_ids:m,session_ids:c,duration:d,key_system:e.a,license_server:e.h,with_credentials:e.i,distinctive_identifier:e.g,audio_robustness:e.f,video_robustness:e.j},g=Ub(this).put(f);g.onsuccess=function(){b.resolve(a)};g.onerror=function(){b.reject(g.error)};return b}))}function og(a,b){return Vb(Ub(a),b).then(I(a,function(a){var d=[],e;for(e in a.stream_ids)d.push(pg(this,a.stream_ids[e]));a=Ub(this);d.push(a.delete(b));return Promise.all(d)}))}
function mg(a,b,c,d,e,f){var g=[ng(Tb(a)),ng(Rb(a).index("stream"))],g=Promise.all(g).then(I(a,function(a){return{Ia:Math.max(a[0],a[1]),ya:new ArrayBuffer(0),lb:0,o:[],$a:null,Fc:e,Ob:f}})),g=g.then(a.f.bind(a,c));return g=g.then(a.g.bind(a,b,d))}function ng(a){var b=new H,c=a.openCursor(null,"prev");c.onsuccess=function(a){a.target.result?b.resolve(a.target.result.key+1):b.resolve(0)};c.onerror=function(){b.reject(c.error)};return b}
jg.prototype.g=function(a,b,c){var d=new H;a={stream_id:c.Ia,mime_type:a.a,codecs:a.c,init_segment:b,references:c.o};var e=Tb(this).put(a);e.onsuccess=function(){d.resolve(c.Ia)};e.onerror=function(){d.reject(e.error)};return d};jg.prototype.f=function(a,b){for(var c=Promise.resolve(),d=0;d<a.length();++d)var e=a.get(d),f=d==a.length()-1,f=this.c.bind(this,e,b,f),c=c.then(this.i.bind(this,e)),c=c.then(f);return c.then(function(){return Promise.resolve(b)}).catch(I(this,function(a){pg(this,b.Ia);return Promise.reject(a)}))};
jg.prototype.c=function(a,b,c,d){var e=new H;0==b.ya.byteLength&&(b.$a=a);b.ya=qg(b.ya,d);b.Ob++;var f=A({type:"progress",detail:b.Ob/b.Fc*100,bubbles:!0});if(1048576<=b.ya.byteLength||c){c={stream_id:b.Ia,segment_id:b.lb,content:b.ya};var g=Rb(this).put(c);b.o.push({start_time:b.$a.startTime,start_byte:b.$a.url.g,end_time:a.a,url:"idb://"+b.Ia+"/"+b.lb});b.lb++;b.ya=new ArrayBuffer(0);g.onerror=function(){e.reject(g.error)};g.onsuccess=I(this,function(){this.dispatchEvent(f);e.resolve()})}else this.dispatchEvent(f),
e.resolve();return e};function qg(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);c.set(new Uint8Array(a),0);c.set(new Uint8Array(b),a.byteLength);return c.buffer}jg.prototype.i=function(a){var b=new gc;b.c=1E3*this.b;return hc(a.url,b,this.j)};
function pg(a,b){var c=new H,d=Tb(a).delete(b);d.onerror=function(){c.reject(d.error)};var e=Rb(a);e.index("stream").openKeyCursor(IDBKeyRange.only(b)).onsuccess=function(a){if(a=a.target.result)e.delete(a.primaryKey),a.continue()};e.transaction.oncomplete=function(){c.resolve()};return c};function rg(a,b,c,d,e,f){r("GET"==c||"POST"==c);this.b=new K(null,[new Q(a)]);this.a=new gc;this.a.body=b;this.a.method=c;this.a.a=3;this.a.j=d;this.a.c=1E3*(null!=f?f:0);a=e||{};for(var g in a)this.a.b[g]=a[g]}function sg(a){return hc(a.b,a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function tg(a,b,c){G.call(this,a);this.b=b;this.c=c;this.a=this.i=null;this.l=new Db;this.f=[];this.g=[];this.s=0;this.h=new H;this.j=null;this.w=0}q(tg,G);tg.prototype.destroy=function(){this.M=null;for(var a=0;a<this.g.length;++a)this.g[a].close().catch(function(){});this.g=[];this.f=this.a=this.i=null;this.h.destroy();this.h=null;this.l.destroy();this.l=null;this.j&&(window.clearTimeout(this.j),this.j=null);this.b=this.c=null};
tg.prototype.initialize=function(){r(null==this.i);r(null==this.b.mediaKeys);r(null==this.a);for(var a=new E,b=this.c.Hb(),c=0;c<b.length;++c){var d=b[c];r(null!=d.a);d.a.a||d.b&&!ug(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];r(null!=f.a);if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.g?"required":"optional",persistentState:h.l||this.c.wa()?
"required":"optional",sessionTypes:[this.c.wa()?"persistent-license":"temporary"]},c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",g in h)){d=!0;h[g]||(h[g]=[]);var l;"audio"==f.contentType?l=f.a.f:"video"==f.contentType&&(l=f.a.j);h[g].push({contentType:f.b,robustness:l});w("MKSC",h)}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return this.c.mb(a),this.h.resolve(),Promise.resolve();l=new H;c=vg(this,c,l);c=c.then(this.H.bind(this,
b,a));l.reject(null);return c};function wg(a,b){null==a.j&&(a.j=window.setTimeout(function(){var a=Error("Timeout waiting for sessions.");a.type="storage";this.h.reject(a)}.bind(a),b));return a.h}function xg(a){return Promise.all(a.g.map(function(a){x("Removing session",a);return a.remove()}))}
function vg(a,b,c){for(var d in b)c=c.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,d,b[d]));a.c.wa()&&(c=c.catch(function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.");}));return c}
tg.prototype.H=function(a,b,c){if(!this.b)return yg();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var l=e[h+"Capabilities"];if(l){for(var l=l[0],m=[],p={},t=0;t<a.length;++t){var C=a[t],D=l?C.b==l.contentType:C.contentType==h;C.a.a!=d||!D||C.id in p||(m.push(C),p[C.id]=!0,this.a=this.a?uc(this.a,C.a):C.a)}r(m.length);b.set(h,m)}}}this.c.mb(b);return c.createMediaKeys().then(function(a){this.i=a}.bind(this))};
function zg(a){if(!a.b)return yg();if(!a.i)return Promise.resolve();r(a.b.src,"Video src must be set!");return a.b.setMediaKeys(a.i).then(I(a,function(){return this.b?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():yg()})).then(I(a,function(){if(!this.b)return yg();r(this.b.mediaKeys);r(this.b.mediaKeys==this.i);if(0<this.c.Ra().length)Ag(this);else{r(this.a);for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.C({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==
this.a.b.length&&F(this.l,this.b,"encrypted",this.C.bind(this))}}))}function yg(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
tg.prototype.C=function(a){r(a.initData);var b=new Uint8Array(a.initData);w("onEncrypted_",b,a);for(var c=0;c<this.f.length;++c)if(ib(b,this.f[c].data)){x("License request already generated!");return}try{var d=Bg(this)}catch(e){b=B(e);this.dispatchEvent(b);this.h.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.f.push({data:b,nb:d});a.catch(I(this,function(a){if(this.b){for(var b=0;b<this.f.length;++b)if(this.f[b].nb==d){this.f.splice(b,1);break}b=B(a);this.dispatchEvent(b);this.h.reject(a)}}));
this.g.push(d)};function Ag(a){var b=a.c.Ra();r(0<b.length);for(var c=0;c<b.length;++c){var d=Bg(a),e=d.load(b[c]);a.g.push(d);e.then(I(a,function(){this.s++;this.s>=this.g.length&&this.h.resolve()})).catch(I(a,function(a){a=B(a);this.dispatchEvent(a)}))}}
function Bg(a){var b=null;if(a.c.wa())try{b=a.i.createSession("persistent-license")}catch(c){throw Error("Persistent licenses are not supported by this key system or platform.");}else b=a.i.createSession();F(a.l,b,"message",a.K.bind(a));F(a.l,b,"keystatuseschange",a.J.bind(a));return b}tg.prototype.K=function(a){w("onSessionMessage_",a);r(this.a);Cg(this,a.target,this.a,a.message)};
tg.prototype.J=function(a){x("onKeyStatusesChange_",a);a=a.target;var b={};a.keyStatuses.forEach(function(a,c){if("string"==typeof a){var f=a;a=c;c=f}if("com.microsoft.playready"==this.a.a&&16==a.byteLength){var f=new DataView(a),g=f.getUint32(0,!0),h=f.getUint16(4,!0),l=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,h,!1);f.setUint16(6,l,!1)}f=rc(new Uint8Array(a));b[f]=c}.bind(this));if(a.expiration<(new Date).getTime()){x("Session has expired",a);for(var c=0;c<this.f.length;++c)if(this.f[c].nb==
a){this.f.splice(c,1);break}a.close();a=this.g.indexOf(a);r(0<=a);this.g.splice(a,1)}this.c.Kb(b)};
function Cg(a,b,c,d){x("requestLicense_",b,c,d);d=Dg(c,d);sg(new rg(d.url,d.body,d.method,c.i,d.headers,a.w)).then(I(a,function(a){w("onLicenseSuccess_",b);c.s&&(a=c.s(a));return b.update(a)})).then(I(a,function(){w("onSessionReady_",b);var a=A({type:"sessionReady",detail:b});this.dispatchEvent(a);this.s++;this.s>=this.g.length&&this.h.resolve()})).catch(I(a,function(a){a.nb=b;a=B(a);this.dispatchEvent(a)}))}
function Dg(a,b){var c={url:a.h,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.w)return c;a.w(c);c.url=yb(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"==typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=yb(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=zb(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c}function Eg(a,b){r(!isNaN(b));a.w=b};function X(a){G.call(this,null);this.a=a;this.b=null;this.f=new Db;this.j=this.i=null;this.H=0;this.w=null;this.h=!1;this.g=new fg;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new ma};this.l=1;this.J=null}q(X,G);n("shaka.player.Player",X);X.version="v1.6.5-91-gd8d589a";
X.isBrowserSupported=function(){return!!window.MediaSource&&!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration&&!!window.Promise&&!!Element.prototype.requestFullscreen&&!!document.exitFullscreen&&"fullscreenElement"in document&&!!window.Uint8Array};
function ug(a){var b;b="text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a);w("+",a,b?"is":"is not","supported");return b}X.isTypeSupported=ug;X.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+sa(a)+" }",0)};
X.prototype.destroy=function(){return this.s().then(I(this,function(){this.f.destroy();this.a=this.f=null})).catch(function(){})};X.prototype.destroy=X.prototype.destroy;X.prototype.s=function(){if(!this.b)return Promise.resolve();this.h&&Fg(this);this.a.pause();Eb(this.f);Gg(this);Hg(this);this.i&&(this.i.destroy(),this.i=null);this.a.src="";var a=this.a.setMediaKeys(null);this.b&&(this.b.destroy(),this.b=null);this.h=!1;this.g=new fg;return a};X.prototype.unload=X.prototype.s;
X.prototype.W=function(a){var b=this.s();r(null==this.b);r(null==this.i);this.a.autoplay&&(ga("load"),F(this.f,this.a,"timeupdate",this.gc.bind(this)));a.la(this.c);a.Vb(this.J);this.J=null;b=b.then(I(this,function(){return a.da()}));b.catch(I(this,function(b){a.destroy();return Promise.reject(b)}));return b.then(I(this,function(){if(!this.a)return Ig();this.b=a;F(this.f,this.b,"seekrangechanged",this.pc.bind(this));this.i=new tg(this,this.a,this.b);return this.i.initialize()})).then(I(this,function(){if(!this.a)return Ig();
F(this.f,this.a,"error",this.Bc.bind(this));F(this.f,this.a,"playing",this.nc.bind(this));F(this.f,this.a,"pause",this.mc.bind(this));return this.b.Rb(this,this.a)})).then(I(this,function(){return this.a?zg(this.i):Ig()})).then(I(this,function(){if(!this.a)return Ig();Jg(this)})).catch(I(this,function(a){if(!this.a)return Ig();if("destroy"!=a.type){var b=B(a);this.dispatchEvent(b)}return this.s().then(function(){return Promise.reject(a)})}))};X.prototype.load=X.prototype.W;
function Ig(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}k=X.prototype;k.gc=function(){ja("load");this.g.playbackLatency=ka("load")/1E3;this.f.Ka(this.a,"timeupdate")};k.Bc=function(a){if(this.a.error){var b=this.a.error.code;b!=MediaError.MEDIA_ERR_ABORTED&&(x("onError_",a,b),a=Error(Kg[b]||"Unknown playback error."),a.type="playback",a=B(a),this.dispatchEvent(a))}else x("Uninterpretable error event!",a)};
k.nc=function(a){x("onPlaying_",a);ga("playing");!this.j&&0>this.l&&(this.a.playbackRate=0,this.C(this.a.currentTime,(new Date).getTime(),this.l));this.h&&Fg(this)};k.mc=function(a){x("onPause_",a);ja("playing");a=ka("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3}Hg(this)};k.pc=function(a){this.H=a.start};
k.Wb=function(){if(!this.a.paused){ja("playing");var a=ka("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3;ga("playing")}}a=this.g;b=this.a;b.getVideoPlaybackQuality&&(b=b.getVideoPlaybackQuality(),a.decodedFrames=b.totalVideoFrames,a.droppedFrames=b.droppedVideoFrames);return this.g};X.prototype.getStats=X.prototype.Wb;X.prototype.V=function(){return this.b?this.b.Ba():[]};X.prototype.getVideoTracks=X.prototype.V;X.prototype.ja=function(){return this.b?this.b.Ha():[]};
X.prototype.getAudioTracks=X.prototype.ja;X.prototype.la=function(){return this.b?this.b.qb():[]};X.prototype.getTextTracks=X.prototype.la;X.prototype.selectVideoTrack=function(a,b){return this.b?this.b.selectVideoTrack(a,void 0==b?!0:b):!1};X.prototype.selectVideoTrack=X.prototype.selectVideoTrack;X.prototype.oa=function(a,b,c){return this.b?this.b.Tb(a,void 0==b?!0:b,c):!1};X.prototype.selectAudioTrack=X.prototype.oa;X.prototype.Z=function(a){return this.b?this.b.Ub(a,!1):!1};
X.prototype.selectTextTrack=X.prototype.Z;X.prototype.ia=function(a){this.b&&this.b.pb(a)};X.prototype.enableTextTrack=X.prototype.ia;X.prototype.U=function(a){Hg(this);0<=a?this.a.playbackRate=a:this.a.paused||(this.a.playbackRate=0,this.C(this.a.currentTime,(new Date).getTime(),a));this.l=a};X.prototype.setPlaybackRate=X.prototype.U;X.prototype.P=function(){return this.l};X.prototype.getPlaybackRate=X.prototype.P;X.prototype.ta=function(a){this.J=a};X.prototype.setPlaybackStartTime=X.prototype.ta;
X.prototype.K=function(){return this.b?this.b.Sb():!1};X.prototype.isLive=X.prototype.K;
X.prototype.Y=function(a){if(a){var b=vb(a,"enableAdaptation");null!=b&&(this.c.enableAdaptation=b);b=xb(a,"streamBufferSize");null!=b&&(this.c.streamBufferSize=b);b=xb(a,"liveStreamEndTimeout");null!=b&&(this.c.liveStreamEndTimeout=b);b=xb(a,"licenseRequestTimeout");null!=b&&(this.c.licenseRequestTimeout=b);b=xb(a,"mpdRequestTimeout");null!=b&&(this.c.mpdRequestTimeout=b);b=xb(a,"segmentRequestTimeout");null!=b&&(this.c.segmentRequestTimeout=b);b=yb(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=
b);b=zb(a,"restrictions",ma);null!=b&&(this.c.restrictions=b.clone());a=vb(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=a&&(Ie=!a);this.b&&this.b.la(this.c)}};X.prototype.configure=X.prototype.Y;X.prototype.ka=function(){return this.c};X.prototype.getConfiguration=X.prototype.ka;function Hg(a){a.j&&(window.clearTimeout(a.j),a.j=null)}function Jg(a){Gg(a);a.w=window.setTimeout(a.T.bind(a),100)}function Gg(a){a.w&&(window.clearTimeout(a.w),a.w=null)}
X.prototype.C=function(a,b,c){r(0>c);r(!this.a.paused);this.j=null;var d=((new Date).getTime()-b)/1E3*c;this.a.currentTime<this.H+(this.K()?1:.05)?this.a.pause():(d=Math.max(this.H,a+d),this.a.currentTime=d,this.j=window.setTimeout(this.C.bind(this,a,b,c),250))};function Fg(a){r(a.h);x("Buffering complete.");ja("buffering");var b=a.g;b.bufferingTime+=ka("buffering")/1E3;a.h=!1;a.dispatchEvent(A({type:"bufferingEnd"}))}
X.prototype.T=function(){Jg(this);if(!this.a.ended&&!this.a.seeking){var a=this.a.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.a.currentTime,0),c=this.a.duration,c=isNaN(c)?0:Math.max(c-.05,0),b=b>=c||this.a.currentTime>=c;if(this.h){if(c=this.b.Gb(),b||a>c)Fg(this),this.a.play()}else!this.a.paused&&!b&&.5>a&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(Ua()/1E3),ga("buffering"),x("Buffering..."),this.dispatchEvent(A({type:"bufferingStart"})))}};
var Kg={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function Lg(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=0;g<f.v.length;++g){var h=f.v[g];ug(Bf(h))||(v("Stream uses an unsupported MIME type.",h),f.v.splice(g,1),--g)}0==e.v.length&&(c.a.splice(d,1),--d)}}function Ng(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d)c.a[d].v.sort(Og)}function Og(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function Pg(a){this.a=a}Pg.prototype.destroy=function(){var a=this.a.destroy();this.a=null;return a};Pg.prototype.update=function(a,b){var c=Qg(a,b),d=Qg(this.a,b);return Promise.all([c,d]).then(I(this,function(b){var c=b[0];b=b[1];var d=this.a.b;Lg(d);Ng(d);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;d=[];Rg(a,this.a,c,b,d);c=a.b;Lg(c);Ng(c);return Promise.resolve(d)}))};
function Qg(a,b){function c(a,b){return a.concat(b)}var d=a.b.map(function(a){return a.a}).reduce(c,[]).map(function(a){return a.v}).reduce(c,[]),e=d.map(function(a){return a.S.create(a.id&&b&&b[a.id])});return Promise.all(e).then(function(a){r(d.length==a.length);for(var b={},c=0;c<d.length;++c)b[d[c].G]=a[c];return Promise.resolve(b)})}
function Rg(a,b,c,d,e){var f=new E;a.b.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new E;b.b.forEach(function(a,b){g.push(a.id||""+b,a)});a=Cb(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);r(l&&0!=l.length);if(1<l.length)v("Cannot update Period "+h+" because more than one existing Period has the same ID.");else{var m=g.get(h);m&&0!=m.length&&(1==m.length?(Sg(l[0],m[0],c,d,e),l[0].b=m[0].b):v("Cannot update Period "+h+" because more than one new Period has the same ID."))}}}
function Sg(a,b,c,d,e){var f=new E;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new E;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=Cb(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);r(l&&0!=l.length);if(1<l.length)v("Cannot update StreamSet "+h+" because more than one existing StreamSet has the same ID.");else{var m=g.get(h);m&&0!=m.length&&(1==m.length?Tg(l[0],m[0],c,d,e):v("Cannot update StreamSet "+h+" because more than one new StreamSet has the same ID."))}}}
function Tg(a,b,c,d,e){var f=new E;a.v.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new E;b.v.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=Cb(f),l=0;l<h.length;++l){var m=h[l];b[m]=m;var p=f.get(m);r(p&&0!=p.length);if(1<p.length)v("Cannot update Stream "+m+" because more than one existing Stream has the same ID.");else{var t=g.get(m);t&&0!=t.length?1==t.length?(Ug(p[0],t[0],c,d),p[0].N=t[0].N,t[0].N=null,p[0].f=t[0].f):v("Cannot update Stream "+m+" because more than one new Stream has the same ID."):
(e.push(p[0]),a.v.splice(a.v.indexOf(p[0]),1))}}h=Cb(g);for(l=0;l<h.length;++l)m=h[l],b[m]||(b[m]=m,t=g.get(m),r(t&&0!=t.length),1<t.length&&v("Cannot add Stream "+m+" because more than one new Stream has the same ID."),a.v.push(t[0]),w("Added Stream "+m+"."))}function Ug(a,b,c,d){c=c[a.G];r(c);d=d[b.G];r(d);var e=c.length();c.fb(d)?w("Updated SegmentIndex",a.G+":",e,"->",c.length(),"SegmentReference(s)."):v("Failed to update SegmentIndex",b.G)};function Vg(){this.a=this.b=null;this.f=new Db;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}n("shaka.media.SimpleAbrManager",Vg);Vg.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};Vg.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
Vg.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=(new Date).getTime()+4E3,F(this.f,this.b,"bandwidth",this.l.bind(this)),F(this.f,this.a,"adaptation",this.j.bind(this)),F(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};Vg.prototype.enable=function(a){this.i=a};Vg.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=Wg(this);return a?a.id:null};Vg.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};
Vg.prototype.l=function(){(new Date).getTime()<this.c||this.h()};Vg.prototype.h=function(){if(this.i){var a=Wg(this);if(a){if(a.active){this.c=(new Date).getTime()+3E3;return}w("Video adaptation:",a);this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};Vg.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=(new Date).getTime()+3E4)};
function Wg(a){var b=a.a.Ba();if(0==b.length)return null;b.sort(wa);var c;a:{c=a.a.Ha();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth){var h=(f.bandwidth+c)/.95,g=(g.bandwidth+c)/.85;da("Bandwidth ranges:",((f.bandwidth+c)/1E6).toFixed(3),(h/1E6).toFixed(3),(g/1E6).toFixed(3));if(a>=h&&a<=g&&(d=f,d.active))break}}return d}
;function Xg(a,b,c){G.call(this,null);this.f=a;this.c=b;this.b=tc(c);this.a=null}q(Xg,G);n("shaka.player.HttpVideoSource",Xg);Xg.prototype.la=function(){};Xg.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null);this.M=this.b=null};k=Xg.prototype;k.Rb=function(a,b){this.M=a;var c=b.mediaKeys;b.src=this.f;c=b.setMediaKeys(c);this.c&&(this.a=document.createElement("track"),this.a.src=this.c,b.appendChild(this.a),this.a.track.mode="showing");return c};k.da=function(){return Promise.resolve()};
k.Ba=function(){return[]};k.Ha=function(){return[]};k.qb=function(){return[]};k.Gb=function(){return 5};k.Hb=function(){var a=new Ff;a.a=this.b;return[a]};k.mb=function(){};Xg.prototype.selectVideoTrack=function(){return!1};k=Xg.prototype;k.Tb=function(){return!1};k.Ub=function(){return!1};k.pb=function(a){this.a&&(this.a.track.mode=a?"showing":"disabled")};k.Vb=function(){};k.Ra=function(){return[]};k.wa=function(){return!1};k.Sb=function(){return!1};
k.Kb=function(a){for(var b in a){var c=a[b],d=lb(c);if(d){var e=Ib(b),d=Error("Key "+e+" is not usable. "+d);d.type="drm";d.code=c;c=B(d);this.dispatchEvent(c)}}};function Y(a,b,c){G.call(this,null);this.a=a;this.Xa=null;this.oa=b;this.i=new Db;this.g=new MediaSource;this.f=null;this.ja=0;this.b=new E;this.Y=c;this.Y.initialize(b,this);this.K=!1;this.ia="en";this.La=!1;this.s=null;this.T=new H;this.h=new ma;this.j=null;this.Bb=1;this.c={};this.ta=new H;this.yb=0;this.vb=15;this.J=null;this.wb=this.xb=!1;this.H={};this.P=this.ka=this.w=null;this.U={};this.Wa=null}q(Y,G);n("shaka.player.StreamVideoSource",Y);
Y.prototype.la=function(a){null!=a.streamBufferSize&&(this.U.streamBufferSize=a.streamBufferSize);null!=a.segmentRequestTimeout&&(this.U.segmentRequestTimeout=a.segmentRequestTimeout);Yg(this);null!=a.enableAdaptation&&this.Y.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.ja=Number(a.mpdRequestTimeout));null!=a.liveStreamEndTimeout&&(this.vb=Number(a.liveStreamEndTimeout));null!=a.preferredLanguage&&(this.ia=qb(String(a.preferredLanguage)));null!=a.restrictions&&(this.h=a.restrictions,
this.K&&Zg(this))};Y.prototype.destroy=function(){this.T.destroy();this.ta.destroy();this.ta=this.T=null;this.ka&&(window.clearTimeout(this.ka),this.ka=null);this.w&&(window.clearTimeout(this.w),this.w=null);this.H=null;this.i.destroy();this.i=null;ub(this.c).forEach(function(a){a.destroy()});this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.Y.destroy();this.M=this.Wa=this.h=this.s=this.f=this.g=this.oa=this.Y=null};k=Y.prototype;
k.Rb=function(a,b){if(!this.K){var c=Error("Cannot call attach() right now.");c.type="app";return Promise.reject(c)}this.M=a;this.f=b;this.s=a.Wb();F(this.i,this.g,"sourceopen",this.ic.bind(this));F(this.i,this.oa,"bandwidth",this.Cc.bind(this));this.a.a&&(F(this.i,a,"bufferingStart",this.fc.bind(this)),F(this.i,a,"bufferingEnd",this.ec.bind(this)));c=this.f.mediaKeys;this.f.src=window.URL.createObjectURL(this.g);c=this.f.setMediaKeys(c);return Promise.all([this.T,c])};
k.da=function(){if(this.K){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.b.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);a=this.a.b;Lg(a);Ng(a);if(0==this.a.b.length||0==this.a.b[0].a.length)return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.K=!0;this.U.initialStreamBufferSize=this.a.c;Yg(this);Zg(this);
return Promise.resolve()};
k.Mb=function(a){r(this.K);r(null!=this.a.f);r(null!=this.a.g);w("Updating manifest...");var b=(new Date).getTime(),c=this.w=null,d=this.a.g;(a?this.Lb():this.ib(d)).then(I(this,function(a){c=new Pg(a);this.Xa=a.a;return c.update(this.a,a.a&&this.Wa)})).then(I(this,function(a){w("Manifest updated!");this.Wa=c.destroy();c=null;for(var d=0;d<a.length;++d)$g(this,a[d]);this.U.initialStreamBufferSize=this.a.c;Yg(this);Zg(this);0==Object.keys(this.c).length?ah(this):bh(this,((new Date).getTime()-b)/1E3)})).catch(I(this,
function(a){c&&(c.destroy(),c=null);"aborted"!=a.type&&(a=B(a),this.dispatchEvent(a),this.a&&bh(this,0))}))};k.ib=function(){ba();return Promise.reject("Cannot update manifest with this VideoSource implementation.")};k.Lb=function(){ba();return Promise.reject("Cannot update manifest with this VideoSource implementation.")};function bh(a,b){if(null!=a.a.f){r(null==a.w);var c=Math.max(a.a.f,3),c=Math.max(c-b,0);x("updateInterval",c);a.w=window.setTimeout(a.Mb.bind(a,!1),1E3*c)}}
function $g(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.Ea()==b){var e=a.b.get(b.a.split("/")[0]).map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return Af(a)});if(0==e.length){u("The stream",b.id,"was removed but an alternate stream does not exist.");c=Error("All usable streams have been removed from the manifest.");c.type="app";c=B(c);a.dispatchEvent(c);return}a.H[c].sb==b&&delete a.H[c];d.Ja(e[0],!0);b.destroy()}w("Removed stream",b.id);b.destroy()}
k.Ba=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.Ea():null)?a.G:0,b=[],c=this.b.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.v.length;++f){var g=e.v[f];if(Af(g)){var h=g.G,g=new va(h,g.bandwidth,g.width,g.height);h==a&&(g.active=!0);b.push(g)}}return b};Y.prototype.getVideoTracks=Y.prototype.Ba;
Y.prototype.Ha=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.Ea():null)?a.G:0,b=[],c=this.b.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.v.length;++g){var h=e.v[g];if(Af(h)){var l=h.G,h=new la(l,h.bandwidth,f);l==a&&(h.active=!0);b.push(h)}}return b};Y.prototype.getAudioTracks=Y.prototype.Ha;
Y.prototype.qb=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.Ea():null,b=b?b.G:0,c=[],d=this.b.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.v.length;++h){var l=f.v[h].G,m=new ua(l,g);l==b&&(m.active=!0,r(null!=a),m.enabled=a.ab());c.push(m)}return c};Y.prototype.getTextTracks=Y.prototype.qb;Y.prototype.Gb=function(){return Number(this.U.initialStreamBufferSize)};
Y.prototype.Hb=function(){var a;if(this.K){a=this.a.b[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,Ef(a.a[c]));a=b}else a=[];return a};
Y.prototype.mb=function(a){if(this.K){for(var b={},c=this.a.b[0],d=0;d<c.a.length;++d){var e=c.a[d];b[e.G]=e}this.b.a={};c=Cb(a);r(c.length,"No configs were selected!");for(d=0;d<c.length;++d){var e=c[d],f=a.get(e);if("video"==e){var g=f[0].id;this.b.push(e,b[g])}else if("audio"==e)for(var g=f[0].b.split(";")[0],h=0;h<f.length;++h){var l=f[h];l.b.split(";")[0]==g&&this.b.push(e,b[l.id])}else for(h=0;h<f.length;++h)g=f[h].id,this.b.push(e,b[g])}this.La=!0;if(a=this.b.get("audio"))ch(this,a),this.b.set("audio",
a),a=a[0].lang||this.ia,pb(2,this.ia,a)&&(this.La=!1);if(a=this.b.get("text"))ch(this,a),this.b.set("text",a),a=a[0].lang||this.ia,pb(2,this.ia,a)||(this.La=!1)}else v("Cannot call selectConfigurations() right now.")};Y.prototype.selectVideoTrack=function(a,b,c){return dh(this,"video",a,b,c)};k=Y.prototype;k.Tb=function(a,b,c){return dh(this,"audio",a,b,c)};k.Ub=function(a,b){return dh(this,"text",a,b)};k.pb=function(a){var b=this.c.text;b&&b.Ta(a)};k.Vb=function(a){this.P=a};
function Zg(a){r(a.a);r(a.K);if(a.h){for(var b=!1,c=0;c<a.a.b.length;++c)for(var d=a.a.b[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.v.length;++g){var h=f.v[g],l=h.b;h.b=!0;a.h.maxWidth&&h.width>a.h.maxWidth&&(h.b=!1);a.h.maxHeight&&h.height>a.h.maxHeight&&(h.b=!1);a.h.minHeight&&h.height<a.h.minHeight&&(h.b=!1);a.h.maxBandwidth&&h.bandwidth>a.h.maxBandwidth&&(h.b=!1);a.h.minBandwidth&&h.bandwidth<a.h.minBandwidth&&(h.b=!1);l!=h.b&&(w(h.b?"Permitting":"Restricting",
"stream",h.id+".","The application has applied new video track restrictions."),b=!0)}}0!=Ab(a.b).length&&b&&(eh(a),r(a.b.a.hasOwnProperty("video")),0<a.Ba().length||(b=Error("The application has restricted all video tracks!"),b.type="app",b=B(b),a.dispatchEvent(b)))}}k.Ra=function(){return[]};k.wa=function(){return!1};k.Sb=function(){return null==this.Xa?this.a.a:this.Xa};
k.Kb=function(a){for(var b in a){var c=Ib(b);x("Key status:",c+": "+a[b])}for(var d=!1,e=new E,f=Ab(this.b),c=0;c<f.length;++c)for(var g=f[c],h=0;h<g.v.length;++h){var l=g.v[h];l.g.forEach(function(a){e.push(a,l)})}for(b in a)if(f=lb(a[b]),g=e.get(b))for(c=0;c<g.length;++c)l=g[c],h=l.fa,l.fa=!f,h!=l.fa&&(w(l.fa?"Permitting":"Restricting","stream",l.id+".",f||""),d=!0);else c=Ib(b),x("Key",c,"was not specified in the manifest."),f&&v("Key",c,"is not usable.",f);d&&(eh(this),b=this.Ha(),a=this.Ba(),
b=this.b.a.hasOwnProperty("audio")&&0==b.length,a=this.b.a.hasOwnProperty("video")&&0==a.length,b||a)&&(a=Error("The key system has restricted all "+(b&&a?"audio and video tracks.":b?"audio tracks.":"video tracks.")),a.type="drm",a=B(a),this.dispatchEvent(a))};function eh(a){var b=A({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}
function dh(a,b,c,d,e){if(!a.b.a.hasOwnProperty(b))return v("Cannot select",b,"track",c,"because there are no",b,"tracks."),!1;if(!a.c[b])return v("Cannot select",b,"track",c,"because there are no",b,"streams yet."),!1;for(var f=a.b.get(b),g=0;g<f.length;++g)for(var h=f[g],l=0;l<h.v.length;++l){var m=h.v[l];if(m.G==c){if(!m.fa)return v("Cannot select",b,"track",c,"because the track is not allowed by the key system."),!1;if(!m.b)return v("Cannot select",b,"track",c,"because the track is not allowed by the application."),
!1;if("text"!=b&&!a.wb)return c=a.H[b],a.H[b]={sb:m,Cb:null!=c&&c.Cb||d,Db:null!=c&&c.Db||e},!0;r(a.s);gg(a.s,m);a.c[b].Ja(m,d,e);return!0}}v("Cannot select",b,"track",c,"because it does not exist.");return!1}function ch(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(pb(c,a.ia,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.b){b.splice(d,1);b.splice(0,0,e);break}}
k.ic=function(){this.i.Ka(this.g,"sourceopen");ah(this).then(I(this,function(){this.T&&this.T.resolve()})).catch(I(this,function(a){this.T&&this.T.reject(a)}))};
function ah(a){for(var b=[],c=["audio","video","text"],d=0;d<c.length;++d){var e=c[d];a.b.a.hasOwnProperty(e)&&b.push(a.b.get(e)[0])}for(var f=fh(a,b),d=0;d<c.length;++d)if(e=c[d],a.b.a.hasOwnProperty(e)&&!f[e])return a=Error("Unable to select an initial "+e+" stream: all "+e+" streams have been restricted (by the application or by the key system)."),a.type="stream",Promise.reject(a);b=ub(f).map(function(a){return a.S.create()});return Promise.all(b).then(I(a,function(a){if(!a.every(function(a){return a.length()}))return x("At least one SegmentIndex is empty."),
a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=gh(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!hh(this,f))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.Y.start();ih(this,f,a);return Promise.resolve()})).catch(I(a,function(a){if("aborted"!=a.type)return r(0==Object.keys(this.c).length),this.a.a?(v(a.message),Ua()<this.a.h?(r(!this.w),r(this.a.a),r(this.a.h),a=Math.max(this.a.h-
(new Date).getTime()/1E3,3),x("updateLocalInterval",a),this.w=window.setTimeout(this.Mb.bind(this,!0),1E3*a)):bh(this,0),Promise.resolve()):Promise.reject(a)}))}
function fh(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.Y.getInitialVideoTrackId();if(null==g){x("No initial video streams to select.");continue}f=e.v.filter(function(a){return a.G==g});if(0==f.length){x("No initial video streams to select from the selected StreamSetInfo.");continue}r(1==f.length);r(Af(f[0]));f=f[0]}else if("audio"==e.contentType){f=e.v.filter(function(a){return Af(a)});if(0==f.length){x("No initial audio streams to select.");continue}f=
e.v[Math.floor(f.length/2)]}else 0<e.v.length&&(f=e.v[0]);r(f);c[e.contentType]=f}return c}function hh(a,b){var c={},d;for(d in b){var e=b[d],f="text"==d?jh(a):kh(a,e);if(!f)return u("Failed to create",Bf(e),"stream."),ub(c).forEach(function(a){a.destroy()}),!1;c[d]=f}a.c=c;return!0}function kh(a,b){r(a.f);var c=new If(a,a.f,a.g,Bf(b),a.oa);c.P(a.U);return c}function jh(a){r(a.f);return new Rf(a,a.f)}
function ih(a,b,c){a.Bb=a.f.playbackRate;a.f.playbackRate=0;lh(a,c);var d;a.P&&a.P<=c.end&&a.P>=c.start?d=a.P:a.P&&c.start>a.P?d=a.P+c.start:a.a.a?(r(c.end!=Number.POSITIVE_INFINITY),d=c.end,a.xb=!0):d=c.start;w("Starting each stream from",d);F(a.i,a.f,"seeking",a.qc.bind(a));a.f.currentTime!=d&&(a.f.currentTime=d,a.j=d,x("Ignoring pending seek to",a.j));mh(a,c.start,c.end);c=[];for(var e in a.c){d=a.c[e];c.push(d.Zb(a.ta));F(a.i,d,"ended",a.rc.bind(a));var f=b[e];gg(a.s,f);d.Ja(f,!1)}Promise.all(c).then(a.dc.bind(a)).catch(I(a,
function(a){r("aborted"!=a.type);"destroy"!=a.type&&(u("Stream startup failed!"),a=B(a),this.dispatchEvent(a))}));a.pb(a.La)}
k.dc=function(a){w("All Streams have completed startup!");r(a&&a.length==Object.keys(this.c).length,"There should be a timestamp correction for each Stream.");for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);w("Timestamp correction",c);0>b*c&&v("Some streams' media timestamps are ahead of their SegmentIndexes,","while other streams' timestamps are behind.","The content may have errors in it.");a=nh(this);for(d=0;d<a.length;++d)a[d].za(c);
oh(this,a,c);d=Ab(this.b).map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){var b=[a.S.create()];a.N&&b.push(a.N.create());return Promise.all(b)});Promise.all(d).then(I(this,function(a){for(var b=0;b<a.length;++b)a[b][0].za(c);x("Created/fetched all SegmentIndexes and initialization segments!");this.wb=!0;for(var d in this.H)a=this.H[d],b=this.c[d],r(b),r(this.s),gg(this.s,a.sb),b.Ja(a.sb,a.Cb,a.Db);this.H={}})).catch(I(this,function(a){"aborted"!=a.type&&(a=
B(a),this.dispatchEvent(a))}))};
function oh(a,b,c){x("beginPlayback_");b=gh(a,b);r(b,"Stream limits should not be null.");b&&(lh(a,b),mh(a,b.start,b.end));0!=c?(x("Adjusting video.currentTime by",c,"seconds."),c=a.f.currentTime+c,a.f.currentTime=c,a.j=c,x("Ignoring pending seek to",a.j)):c=a.f.currentTime;r(null!=c);b&&(a.a.a&&c<b.start-1E-5&&x("correctedCurrentTime ("+c+")","is outside of the stream limits before beginning playback!"),(!a.a.a&&c<b.start-1E-5||c>b.end+1E-5)&&u("correctedCurrentTime ("+c+")","should be within the stream limits",
[b.start,b.end]));a.xb&&b&&(x("Jumping to live across",b.end-a.f.currentTime,"seconds"),a.f.currentTime=b.end);a.f.playbackRate=a.Bb;a.a.a&&null!=a.a.f&&(r(null==a.w),bh(a,0));ph(a);a.ta.resolve()}
function lh(a,b){r("open"==a.g.readyState,"The MediaSource should be in the 'open' state.");if(a.a.a)isNaN(a.g.duration)&&(a.g.duration=b.end+2592E3);else if(isNaN(a.g.duration)||b.end>a.g.duration){x("Setting MediaSource duration to",b.end);a.g.duration=b.end;for(var c=0;c<a.g.sourceBuffers.length;++c)a.g.sourceBuffers[c].appendWindowEnd=b.end}}
k.tc=function(){this.ka=null;ph(this);var a=gh(this,nh(this));r(a,"Stream limits should not be null.");if(a&&(this.a.a&&this.yb!=a.F&&(this.yb=a.F,null!=this.J&&(x("Not the end of the live stream."),window.clearTimeout(this.J),this.J=null)),mh(this,a.start,a.end),!this.f.paused)){var b=this.f.currentTime,c=a.start,a=a.end;qh(this,b,c,a)&&v("Playhead is outside of the seekable range:","seekable",[c,a],"attempted",b,"Adjusting...")}};
function mh(a,b,c){var d=A({type:"seekrangechanged",bubbles:!0,start:b,end:c});y("Seek range",[b,c],c-b);a.dispatchEvent(d)}
k.qc=function(a){y("onSeeking_",a);a=this.f.currentTime;if(null!=this.j){if(a>=this.j-.01&&a<=this.j+.01){x("Ignored seek to",this.j);this.j=null;return}this.j=null}var b=gh(this,nh(this));r(b,"Stream limits should not be null.");if(b){var c=b.start,b=b.end,d;(d=qh(this,a,c,b))||(a<=b+.01?d=!1:(this.f.currentTime=b,d=!0));if(d)v("Playhead has been moved outside of the seekable range:","seekable",[c,b],"attempted",a,"Adjusting...");else for(var e in this.c)this.c[e].Pb()}};
function qh(a,b,c,d){if(b>=c-.01)return!1;b=0;if(a.a.a){b=.5;for(var e in a.c)if(!a.c[e].Qb(c+b)){b=a.a.c;break}}a.f.currentTime=Math.min(c+b,d);return!0}k.rc=function(){if(!this.a.a){for(var a in this.c)if(!this.c[a].eb())return;this.Fb()}};k.fc=function(){r(this.a.a);ub(this.c).every(function(a){return a.eb()})&&(w("Possible end of live stream."),this.J=window.setTimeout(this.Fb.bind(this),1E3*this.vb))};
k.ec=function(){r(this.a.a);null!=this.J&&(x("Not the end of the live stream."),window.clearTimeout(this.J),this.J=null)};k.Cc=function(){r(this.s);var a=this.s,b=this.oa.getBandwidth();a.estimatedBandwidth=b;a.bandwidthHistory.push(new ig(b))};
k.Fb=function(){r("open"==this.g.readyState,"The MediaSource should be in the 'open' state.");var a=this.g.duration,b;w("Signalling end-of-stream.");this.J=null;this.g.endOfStream();b=this.g.duration;b!=a&&v("endOfStream() should not modify the MediaSource's duration:","before",a,"after",b,"delta",b-a);a=!1;for(b=0;b<this.g.sourceBuffers.length;++b)a=this.g.sourceBuffers[b].updating;r(!a,"endOfStream() should not trigger the duration change algorithm.")};
function nh(a){return ub(a.c).map(function(a){return a.Ib()}).filter(function(a){return null!=a})}
function gh(a,b){r(a.a);for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].bb(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].F().a))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.b[0],d.b)d=(d.start||0)+d.b;else return x("Failed to compute a stream end time."),null;a.a.a&&(d=Math.max(d-a.a.c,c));return c>d?(x("The streams' media timelines do not intersect."),null):{start:c,end:d,F:e}}
function ph(a){a.a.a&&(r(null==a.ka),a.ka=window.setTimeout(a.tc.bind(a),1E3))}function Yg(a){for(var b in a.c)a.c[b].P(a.U)};function rh(a,b,c,d){c||(c=new Hb);d||(d=new Vg);Y.call(this,null,c,d);this.Na=a;this.W=null;this.C=b;this.V=[];this.Ca=[];this.Da=[];this.l=null}q(rh,Y);n("shaka.player.DashVideoSource",rh);rh.prototype.bc=function(a,b,c){this.V.push(a);this.Ca.push(b||"");this.Da.push(c||"")};rh.prototype.addExternalCaptions=rh.prototype.bc;rh.prototype.cc=function(a){this.l=a};rh.prototype.setNetworkCallback=rh.prototype.cc;rh.prototype.destroy=function(){this.W=this.l=this.C=null;Y.prototype.destroy.call(this)};
rh.prototype.da=function(){var a=new K(this.l,[new Q(this.Na)]);return(new Qe(a,this.ja)).c().then(I(this,function(a){this.W=a;for(var c=0;c<this.V.length;c++)ze(a,this.V[c],this.Ca[c],this.Da[c]);this.a=Vf(new Uf(this.C),a,this.l);return Y.prototype.da.call(this)}))};rh.prototype.ib=function(a){return(new Qe(a,this.ja)).c().then(I(this,function(a){this.W=a;a=Vf(new Uf(this.C),a,this.l);return Promise.resolve(a)}))};rh.prototype.Lb=function(){r(this.W);var a=Vf(new Uf(this.C),this.W,this.l);return Promise.resolve(a)};function Z(a,b,c){b||(b=new Hb);c||(c=new Vg);Y.call(this,null,b,c);this.V=a;this.W=[];this.timeoutMs=3E4;this.C={};this.l=this.Z=null}q(Z,Y);n("shaka.player.OfflineVideoSource",Z);Z.prototype.la=function(a){null!=a.licenseRequestTimeout&&(this.C.licenseRequestTimeout=a.licenseRequestTimeout);null!=a.segmentRequestTimeout&&(this.C.segmentRequestTimeout=a.segmentRequestTimeout);Y.prototype.la.call(this,a)};
n("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var a=new Wb,b=Ob(a).then(function(){return Xb(a)});b.then(function(){Qb(a)}).catch(function(){Qb(a)});return b});
Z.prototype.Na=function(a,b,c,d){var e,f=null,g={},h=[];a=new K(this.Z,[new Q(a)]);return(new Qe(a,this.ja)).c().then(I(this,function(a){this.a=Vf(new Uf(c),a,this.Z);if(this.a.a)return a=Error("Unable to store live streams offline."),a.type="app",Promise.reject(a);this.la({preferredLanguage:b});return Y.prototype.da.call(this)})).then(I(this,function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.g);e=new tg(null,a,this);null!=this.C.licenseRequestTimeout&&Eg(e,Number(this.C.licenseRequestTimeout));
F(this.i,e,"sessionReady",this.Ca.bind(this));F(this.i,e,"error",function(a){f=a});return e.initialize()})).then(I(this,function(){for(var a=Ab(this.b),b=0;b<a.length;++b)for(var c=a[b],e=0;e<c.v.length;++e){var f=c.v[e];g[f.G]=f}return d()})).then(I(this,function(a){for(var b=0;b<a.length;++b){var c=a[b],d=g[c];if(d)h.push(d);else return Promise.reject(Error("Invalid stream ID chosen: "+c))}var e=["audio","video"];h=h.filter(function(a){return 0>e.indexOf(a.a.split("/")[0])?(v("Ignoring track ID "+
a.G+" due to unsupported type: "+a.a.split("/")[0]),!1):!0});a=h.map(function(a){return a.N.create()});return Promise.all(a)})).then(I(this,function(a){var b=h;r(b.length==a.length);for(var c=[],d=0;d<b.length;++d)try{c[d]=this.g.addSourceBuffer(Bf(b[d]))}catch(e){u("addSourceBuffer() failed",e)}if(b.length!=c.length)a=Error("Error initializing streams."),a.type="storage",a=Promise.reject(a);else{for(d=0;d<a.length;++d)(b=a[d])&&c[d].appendBuffer(b);a=Promise.resolve()}return a})).then(I(this,function(){return wg(e,
this.timeoutMs)})).then(I(this,function(){if(f)return Promise.reject(f);var a=e.a,b=this.a.b[0].b;b||v("The duration of the stream being stored is null.");r(b!=Number.POSITIVE_INFINITY);return sh(this,h,a,b)})).then(I(this,function(a){this.V=a;return f?(th(this),Promise.reject(f)):Promise.resolve(a)}))};n("shaka.player.OfflineVideoSource.prototype.store",Z.prototype.Na);Z.prototype.Ma=function(a){this.Z=a};Z.prototype.setNetworkCallback=Z.prototype.Ma;Z.prototype.Ca=function(a){this.W.push(a.detail.sessionId)};
function sh(a,b,c,d){var e=new jg(a.oa,a);null!=a.C.segmentRequestTimeout&&kg(e,Number(a.C.segmentRequestTimeout));return Ob(e).then(I(a,function(){return lg(e,b,this.W,d,c)})).then(function(a){Qb(e);return Promise.resolve(a)}).catch(function(a){Qb(e);return Promise.reject(a)})}
Z.prototype.da=function(){r(0<=this.V);var a=new Wb,b,c;return Ob(a).then(I(this,function(){return Yb(a,this.V)})).then(I(this,function(d){var e=[];this.W=d.session_ids;b=d.duration;c={keySystem:d.key_system,distinctiveIdentifierRequired:d.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:d.audio_robustness,videoRobustness:d.video_robustness,withCredentials:d.with_credentials,licenseServerUrl:d.license_server};for(var f=0;f<d.stream_ids.length;++f)e.push(Zb(a,d.stream_ids[f]));return Promise.all(e)})).then(I(this,
function(a){var e=b,f=c,g=new Hf;g.c=5;for(var h=new Gf,l=0;l<a.length;++l){var m=a[l],p=new yf,t=new xf(m.references),C=new We(null,m.init_segment);p.S=t;p.N=C;p.a=m.mime_type;p.c=m.codecs;p.fa=!0;this.l&&(null!=this.l.licenseServerUrl&&(f.licenseServerUrl=this.l.licenseServerUrl),null!=this.l.withCredentials&&(f.withCredentials=this.l.withCredentials),f.licensePostProcessor=this.l.licensePostProcessor,f.licensePreProcessor=this.l.licensePreProcessor,f.serverCertificate=this.l.serverCertificate);
m=tc(f);t=new Cf;t.v.push(p);t.a.push(m);t.contentType=p.a.split("/")[0];h.a.push(t);h.b=e}g.b.push(h);this.a=g;return Y.prototype.da.call(this)})).then(function(){Qb(a);return Promise.resolve()}).catch(function(b){Qb(a);return Promise.reject(b)})};
Z.prototype.Da=function(a,b){r(0<=this.V);a&&(this.l={licenseServerUrl:a.licenseServerUrl,withCredentials:a.withCredentials,serverCertificate:a.serverCertificate,licensePreProcessor:a.licensePreProcessor,licensePostProcessor:a.licensePostProcessor});var c=null;return uh(this).catch(function(a){return b?(c=a,Promise.resolve()):Promise.reject(a)}).then(I(this,function(){return th(this)})).then(function(){return Promise.resolve(c)})};Z.prototype.deleteGroup=Z.prototype.Da;Z.prototype.Ra=function(){return this.W};
Z.prototype.wa=function(){return!0};function th(a){var b=new jg(null,null);return Ob(b).then(I(a,function(){return og(b,this.V)})).then(function(){Qb(b);return Promise.resolve()}).catch(function(a){Qb(b);return Promise.reject(a)})}
function uh(a){var b=document.createElement("video");b.src=window.URL.createObjectURL(a.g);var c=new tg(null,b,a);null!=a.C.licenseRequestTimeout&&Eg(c,Number(a.C.licenseRequestTimeout));return a.da().then(function(){return c.initialize()}).then(I(a,function(){return wg(c,this.timeoutMs)})).then(function(){return xg(c)}).then(I(a,function(){c.destroy();this.destroy();return Promise.resolve()})).catch(I(a,function(a){c.destroy();this.destroy();return Promise.reject(a)}))};function Ld(a,b){this.b=a;this.a=b}function vh(a,b,c,d){Qe.call(this,a,b);this.w=new Cd(c);this.a=c||null;this.f=null;this.a&&this.a.a&&(this.f="highest"==this.a.a?this.l:"lowest"==this.a.a?this.s:this.j);this.h=d;this.g=null}q(vh,Qe);
vh.prototype.c=function(){var a=this.i;return hc(a,this.b).then(function(b){b=Dd(this.w,b);this.a&&this.a.b?(w("Previous state",this.h),b=Kd(b,this.h)):b=new Ld(b);b.a&&w("Big int processed state.",b.a);this.g=b.a;if(b=Zd(b.b,a.a,[a.f]))return Promise.resolve(wh(this,b));b=Error("MPD parse failure.");b.type="dash";return Promise.reject(b)}.bind(this))};
function wh(a,b){"static"===b.type&&b.a&&a.f&&b.a.forEach(function(a){var b=this.f(a);try{0<b&&(w("Found missing presentationTimeOffset from segment start offset, based on the configured "+this.a.a+" policy.",b),a.L.forEach(function(a){a.m.D||(a.m.D=b*(a.m.u||1));a.I&&a.I.forEach(function(a){a.m&&!a.m.D&&(a.m.D=b*(a.m.u||1))})}))}catch(e){v("Attempt of fixing presentationTimeOffset in manifest failed. Trying to continue anyway.",e,a)}}.bind(a));w("MPD",b);return b}
vh.prototype.j=function(a){var b=0;try{a.L.forEach(function(a){var c=a.m;if(c&&!c.D){var f=c.A&&c.A.O&&c.A.O[0];f.startTime&&(c=f.startTime/(c.u||1),"video"===a.contentType&&(b=c))}})}catch(c){return v("Error when searching for start offset snapping to video segment start.",c),0}return b};
vh.prototype.s=function(a){var b=0;try{a.L.forEach(function(a){if((a=a.m)&&!a.D){var c=a.A&&a.A.O&&a.A.O[0];c.startTime&&(a=c.startTime/(a.u||1),b=0===b?a:Math.min(b,a))}})}catch(c){return v("Error when searching for lowest start offset.",c),0}return b};vh.prototype.l=function(a){var b=0;try{a.L.forEach(function(a){if((a=a.m)&&!a.D){var c=a.A&&a.A.O&&a.A.O[0];c.startTime&&(b=Math.max(b,c.startTime/(a.u||1)))}})}catch(c){return v("Error when searching for highest start offset.",c),0}return b};function xh(a,b,c,d,e,f){rh.call(this,a,b,c,d);this.Ab=f||null;this.Ma=e;this.Z=null}q(xh,rh);n("shaka.vimond.player.ModifyableDashVideoSource",xh);xh.prototype.da=function(){var a=new K(this.l,[new Q(this.Na)]),b=new vh(a,this.ja,this.Ab,this.Z);return b.c().then(I(this,function(a){this.Z=b.g;for(var d=0;d<this.V.length;d++)ze(a,this.V[d],this.Ca[d],this.Da[d]);this.a=Vf(new Uf(this.C),a,this.l);d=Y.prototype.da.call(this);try{this.Ma&&a.b&&this.Ma(a.b)}catch(e){v("mpdReady callback failed.",e)}return d}))};
xh.prototype.ib=function(a){var b=new vh(a,this.ja,this.Ab,this.Z);return b.c().then(I(this,function(a){this.Z=b.g;a=Vf(new Uf(this.C),a,this.l);return Promise.resolve(a)}))};}.bind(g,this))();
this.shaka=g.shaka;
})();

//# sourceMappingURL=shaka-player.compiled.debug.map

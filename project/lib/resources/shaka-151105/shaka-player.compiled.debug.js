(function(){var g={};
(function(window){var h,aa=this;function m(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function p(a,b){function c(){}c.prototype=b.prototype;a.oc=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.mc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}aa.COMPILED=!1;/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function q(){}function ba(){}function ca(){}(function(){var a=console.assert;a?a.bind||(console.assert=function(){a.apply(console,arguments)}):console.assert=function(){}})();q=console.assert.bind(console);ba=console.assert.bind(console,!1,"Not implemented.");ca=console.assert.bind(console,!1,"Unreachable reached.");function t(){}function v(){}function w(){}function x(){}function y(){}function da(){}function ea(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}ea("error");ea("warn");ea("info");ea("log");ea("debug");
m("shaka.log.setLevel",function(a){function b(){}t=1<=a?console.error.bind(console):b;v=2<=a?console.warn.bind(console):b;w=3<=a?console.info.bind(console):b;x=4<=a?console.log.bind(console):b;y=5<=a?console.debug.bind(console):b;da=6<=a?console.debug.bind(console):b});m("shaka.log.Level",{NONE:0,ERROR:1,lc:2,ic:3,hc:4,jc:5,kc:6});m("shaka.log.Level.NONE",0);m("shaka.log.Level.ERROR",1);m("shaka.log.Level.WARNING",2);m("shaka.log.Level.INFO",3);m("shaka.log.Level.DEBUG",4);
m("shaka.log.Level.V1",5);m("shaka.log.Level.V2",6);t=console.error.bind(console);v=console.warn.bind(console);w=console.info.bind(console);function fa(a){ga[a]={ma:ha(),end:NaN}}function ia(a){var b=ga[a];b&&(b.end=ha(),x(a+": "+(b.end-b.ma).toFixed(3)+"ms"))}function ja(a){return(a=ga[a])&&a.end?a.end-a.ma:NaN}var ha=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,ga={};function ka(a,b,c){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.active=!1}m("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function la(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.maxHeight=null}la.prototype.clone=function(){var a=new la;a.maxHeight=this.maxHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function ma(){this.fontSize="100%";this.fontColor=na;this.fontOpacity=oa;this.backgroundColor=pa;this.backgroundOpacity=oa;this.fontEdge=qa}m("shaka.player.TextStyle",ma);ma.prototype.a=function(){var a=window.localStorage.getItem("ShakaPlayerTextStyle");if(a){var b;try{b=JSON.parse(a)}catch(c){v("Loaded garbage from TextStyle storage!");return}if(b&&"object"==typeof b){var a=b,d;for(d in a)d in this&&(this[d]=a[d])}else v("Loaded non-object from TextStyle storage!")}};ma.prototype.load=ma.prototype.a;
ma.prototype.b=function(){window.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))};ma.prototype.store=ma.prototype.b;
function ra(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+sa(a.fontColor,a.fontOpacity));b.push("background-color: "+sa(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){q(6==a.fontEdge[d].length);var e=a.fontEdge[d].slice(3,6);c.push(sa(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function sa(a,b){q(3==a.length);return"rgba("+a.concat(b).join(",")+")"}
var na=[255,255,255],pa=[0,0,0];ma.StandardColors={WHITE:na,BLACK:pa,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var oa=1;ma.StandardOpacities={OPAQUE:oa,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var qa=[];
ma.EdgeStyles={NONE:qa,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function ta(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}m("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function ua(a,b,c,d){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.active=!1}function va(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}m("shaka.player.VideoTrack.compare",va);function wa(){var a="CustomEvent"in window;if(a)try{new CustomEvent("")}catch(b){a=!1}a||(window.CustomEvent=xa)}m("shaka.polyfill.CustomEvent.install",wa);function xa(a,b){var c=document.createEvent("CustomEvent"),d=b||{bubbles:!1,cancelable:!1,detail:null};c.initCustomEvent(a,!!d.bubbles,!!d.cancelable,d.detail);return c};function ya(){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen;a=Document.prototype;a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen;"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}});document.addEventListener("webkitfullscreenchange",
za);document.addEventListener("webkitfullscreenerror",za);document.addEventListener("mozfullscreenchange",za);document.addEventListener("mozfullscreenerror",za);document.addEventListener("MSFullscreenChange",za);document.addEventListener("MSFullscreenError",za)}m("shaka.polyfill.Fullscreen.install",ya);function za(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),b=new Event(b,a);a.target.dispatchEvent(b)};function Aa(){x("PatchedMediaKeys.nop.requestMediaKeySystemAccess");q(this instanceof Navigator);return Promise.reject(Error("The key system specified is not supported."))}function Ba(a){x("PatchedMediaKeys.nop.setMediaKeys");q(this instanceof HTMLMediaElement);return null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Ca(){throw new TypeError("Illegal constructor.");}Ca.prototype.createSession=function(){};Ca.prototype.setServerCertificate=function(){};
function Ea(){throw new TypeError("Illegal constructor.");}Ea.prototype.getConfiguration=function(){};Ea.prototype.createMediaKeys=function(){};function Fa(a){this.b=[];this.a=[];this.ja=Ga;a&&a(this.f.bind(this),this.c.bind(this))}var Ga=0;function Ha(){window.Promise?w("Using native Promises."):(w("Using Promises polyfill."),window.Promise=Fa,Ia=window.setImmediate?function(a){window.setImmediate(a)}:function(a){window.setTimeout(a,0)})}m("shaka.polyfill.Promise.install",Ha);
Fa.prototype.then=function(a,b){var c=new Fa;switch(this.ja){case 1:Ja(this,c,a);break;case 2:Ja(this,c,b);break;case Ga:this.b.push({Pa:c,Ha:a}),this.a.push({Pa:c,Ha:b})}return c};Fa.prototype.then=Fa.prototype.then;Fa.prototype.catch=function(a){return this.then(void 0,a)};Fa.prototype["catch"]=Fa.prototype.catch;Fa.prototype.f=function(a){if(this.ja==Ga){this.Fa=a;this.ja=1;for(a=0;a<this.b.length;++a)Ja(this,this.b[a].Pa,this.b[a].Ha);this.b=[];this.a=[]}};
Fa.prototype.c=function(a){if(this.ja==Ga){this.Fa=a;this.ja=2;for(a=0;a<this.a.length;++a)Ja(this,this.a[a].Pa,this.a[a].Ha);this.b=[];this.a=[]}};function Ja(a,b,c){q(a.ja!=Ga);Ia(function(){if(c&&"function"==typeof c){try{var a=c(this.Fa)}catch(e){b.c(e);return}a instanceof Fa?a==b?b.c(new TypeError("Chaining cycle detected")):a.then(b.f.bind(b),b.c.bind(b)):b.f(a)}else 1==this.ja?b.f(this.Fa):b.c(this.Fa)}.bind(a))}function Ia(){};function Ka(){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=La)}m("shaka.polyfill.VideoPlaybackQuality.install",Ka);function La(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}};function Ma(a,b){for(var c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};function Na(){return Date.now()+Oa}var Oa=0;function Pa(a){this.b=a;this.c=0==Qa;this.a=0}var Qa=1;function Ra(a){return a.a<a.b.byteLength}function Sa(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function A(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Ta(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Ua(a){q(!0);if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function Wa(a,b){q(0<=b);if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function Xa(a){this.b=a;this.a=new Pa(a);Ya||(Ya=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Ya;
function Za(a){var b;b=$a(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=$a(a);a:{for(d=0;d<Ya.length;d++)if(ab(c,Ya[d])){d=!0;break a}d=!1}if(d)throw new RangeError("EbmlParser: Element cannot contain dynamically sized data.");if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d;
c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,a.b.byteOffset+a.a.a,c);Wa(a.a,c);return new bb(b,d)}function $a(a){var b=Sa(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Sa(a.a);return d}function bb(a,b){this.id=a;this.a=b}
function cb(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};function db(a){var b=eb[a];q(b||"usable"===a||"output-downscaled"===a||"status-pending"===a,"Unexpected key status value: "+a);return b||null}var eb={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function fb(a){q(0<a);this.c=Math.exp(Math.log(.5)/a);this.a=this.b=0}fb.prototype.sample=function(a,b){var c=Math.pow(this.c,a);this.b=b*(1-c)+c*this.b;this.a+=a};function gb(a){return a.b/(1-Math.pow(a.c,a.a))};function C(a){var b=new CustomEvent(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b?q(b[c]==a[c],"key = "+c):b[c]=a[c];return b}function D(a){q(null!=a);return new CustomEvent("error",{detail:a,bubbles:!0})};function hb(a,b,c){q(b==ib(b));q(c==ib(c));return c==b||a>=jb&&c==b.split("-")[0]||a>=kb&&c.split("-")[0]==b.split("-")[0]?!0:!1}var jb=1,kb=2;function ib(a){a=a.toLowerCase().split("-");var b=lb[a[0]];b&&(a[0]=b);return a.join("-")}
var lb={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function mb(a){return Object.keys(a).map(function(b){return a[b]})}function nb(a,b){var c=ob(a,b,"number");if(null==c)return null;if(isNaN(c)||c==Number.NEGATIVE_INFINITY||c==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(0>c)throw new RangeError("'"+b+"' must be >= 0");return c}function pb(a,b){return ob(a,b,"string")}function ob(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}
function qb(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function E(){this.a={}}E.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};E.prototype.set=function(a,b){this.a[a]=b};E.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function rb(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function sb(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function tb(a){var b=[],c;for(c in a.a)b.push(c);return b};function ub(){this.a=new E}ub.prototype.destroy=function(){vb(this);this.a=null};function G(a,b,c,d){b=new wb(b,c,d);a.a.push(c,b)}ub.prototype.ya=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.ya(),sb(this.a,b,e))}};function vb(a){for(var b=rb(a.a),c=0;c<b.length;++c)b[c].ya();a.a.a={}}function wb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
wb.prototype.ya=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function H(a){this.Ga=new E;this.K=a}m("shaka.util.FakeEventTarget",H);H.prototype.addEventListener=function(a,b,c){q(!c);c||this.Ga.push(a,b)};H.prototype.removeEventListener=function(a,b,c){q(!c);c||sb(this.Ga,a,b)};
H.prototype.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return xb(this,
a)};function xb(a,b){b.currentTarget=a;for(var c=a.Ga.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){t("Uncaught exception in event handler",f)}}a.K&&b.bubbles&&xb(a.K,b);return b.defaultPrevented};function yb(){H.call(this,null);this.a=new fb(3);this.c=new fb(10);this.b=0}p(yb,H);m("shaka.util.EWMABandwidthEstimator",yb);yb.prototype.sample=function(a,b){if(!(65536>b)){a=Math.max(a,50);var c=8E3*b/a,d=a/1E3;this.a.sample(d,c);this.c.sample(d,c);this.dispatchEvent(C({type:"bandwidth"}));this.b=Date.now()}};yb.prototype.getBandwidth=function(){return.5>this.a.a?5E5:Math.min(gb(this.a),gb(this.c))};yb.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};
yb.prototype.supportsCaching=function(){return!1};function I(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=I.prototype.destroy;return c}I.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function zb(a){return a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function Ab(){this.g=new I;this.f=!1;this.a=null;this.b=[];this.c=null}function Bb(a,b){if(a.f)throw Error("Cannot append to a running task!");a.b.push(b)}Ab.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0;this.b.unshift(function(){});Cb(this,void 0)};Ab.prototype.end=function(){this.b.splice(1)};
function Cb(a,b){var c=a.b[0](b),d;c?(q(1==c.length||2==c.length),d=c[0],q(d),a.c=c[1]):(d=Promise.resolve(),a.c=null);d.then(J(a,function(a){this.a?(this.b=[],this.c=null,Db(this)):(this.b.shift(),this.b.length?Cb(this,a):(this.g.resolve(a),this.c=null))})).catch(J(a,function(a){this.b=[];this.c=null;this.a?Db(this):this.g.reject(a)}))}function Db(a){q(a.g);q(a.a);var b=Error("Task aborted.");b.type="aborted";a.g.reject(b);window.setTimeout(function(){this.a.resolve();this.a=null}.bind(a),5)};function J(a,b){return b.bind(a)};function Eb(a,b){q("readonly"==a||"readwrite"==a);H.call(this,b);this.a=null;this.h=a}p(Eb,H);
function Fb(a){if(!window.indexedDB)return a=Error("Persistant storage requires IndexedDB support."),a.type="storage",Promise.reject(a);if(a.a)return a=Error("A database connection is already open."),a.type="storage",Promise.reject(a);var b=new I,c=window.indexedDB.open("content_database",1);c.onupgradeneeded=J(a,function(a){this.a=a.target.result;Gb(this,"group_store",{keyPath:"group_id"});Gb(this,"stream_index_store",{keyPath:"stream_id"});a=Gb(this,"content_store",{autoIncrement:"true"});a.createIndex("segment",
["stream_id","segment_id"],{unique:!0});a.createIndex("stream","stream_id",{unique:!1})});c.onsuccess=J(a,function(a){this.a=a.target.result;b.resolve()});c.onerror=function(){b.reject(c.error)};return b}function Hb(a){a.a&&(a.a.close(),a.a=null)}function Gb(a,b,c){a.a.objectStoreNames.contains(b)&&a.a.deleteObjectStore(b);return a.a.createObjectStore(b,c)}function Ib(a){return Jb(a,"content_store")}function Kb(a){return Jb(a,"stream_index_store")}function Lb(a){return Jb(a,"group_store")}
function Jb(a,b){q(a.a,"A database connection should be open.");return a.a.transaction([b],a.h).objectStore(b)}function Mb(a,b){var c=new I,d=a.get(b);d.onerror=function(){c.reject(d.error)};d.onsuccess=function(){if(d.result)c.resolve(d.result);else{var a=Error("Item not found.");a.type="storage";c.reject(a)}};return c};function Nb(){Eb.call(this,"readonly",null)}p(Nb,Eb);function Ob(a){var b=new I,c=[],d=Lb(a).openCursor();d.onerror=function(){b.reject(d.error)};d.onsuccess=function(a){(a=a.target.result)?(c.push(a.key),a.continue()):b.resolve(c)};return b}
function Pb(a,b){return Mb(Lb(a),b).then(J(a,function(a){a.session_ids=Ma(a.session_ids);return a.hasOwnProperty("duration")||a.hasOwnProperty("key_system")?Promise.resolve(a):Qb(this,a.stream_ids[0]).then(function(b){a.duration=b.duration;a.key_system=b.key_system;a.license_server=b.license_server;a.with_credentials=b.with_credentials;a.distinctive_identifier=b.distinctive_identifier;a.audio_robustness=b.audio_robustness;a.video_robustness=b.video_robustness;return Promise.resolve(a)})}))}
function Qb(a,b){return Mb(Kb(a),b)}function Rb(a,b,c){return Mb(Ib(a).index("segment"),[b,c]).then(function(a){return Promise.resolve(a.content)})};function Sb(a,b,c){q("open"==a.readyState,"The MediaSource should be in the 'open' state.");q(0<b.length);q(MediaSource.isTypeSupported(b));var d=a.addSourceBuffer(b);q(d,"SourceBuffer should not be null.");this.j=a;this.f=d;this.s=c;this.l=new ub;this.g=null;this.b=[];this.K=0;this.c=this.a=null;this.w=0;this.h=b.split(";")[0];q(0<this.h.length);G(this.l,this.f,"updateend",this.C.bind(this))}var Tb=1/60;
Sb.prototype.destroy=function(){Ub(this).catch(function(){});this.c&&this.c.destroy();this.a=this.c=null;this.g&&(Hb(this.g),this.g=null);this.b=null;this.l.destroy();this.j=this.f=this.l=null};function Vb(a,b){for(var c=a.f.buffered,d=0;d<c.length;++d){var e=c.start(d)-Tb,f=c.end(d)+Tb;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function Wb(a,b,c,d){y(K(a),"fetch");q(!a.a);if(a.a)return a=Error("Cannot fetch ("+a.h+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Ab;c!=a.f.timestampOffset&&(x(K(a),"setting timestampOffset to",c),a.f.timestampOffset=c);"idb"!=b.url.a[0].Y||a.g||(a.g=new Nb,Bb(a.a,function(){return[Fb(this.g)]}.bind(a)));d&&Bb(a.a,function(){return[Xb(this,d),this.i.bind(this)]}.bind(a));Bb(a.a,function(){var a=b.a?b.a-b.startTime:1,c=new Yb;c.a=3;c.i=1E3*a;c.c=1E3*this.w;c.g=
this.g;return[Zb(b.url,c,this.s),L.prototype.g.bind(b.url)]}.bind(a));var e;Bb(a.a,J(a,function(a){e=this.j.duration;x("Estimated bandwidth:",(this.s.getBandwidth()/1E6).toFixed(2),"Mbps");return[Xb(this,a),this.i.bind(this)]}));var f=0==a.f.buffered.length&&0==a.b.length,g=null;Bb(a.a,function(){var a=this.j.duration;a!=e&&v(K(this),"appendBuffer() should not modify the MediaSource's duration:","before",e,"after",a,"delta",a-e);if(0==this.f.buffered.length)return a=Error("Failed to buffer segment ("+
this.h+")."),a.type="stream",[Promise.reject(a)];f&&(q(0==this.b.length),a=b.startTime,g=this.f.buffered.start(0)-a);a=$b(this.b,b.startTime);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return ac(a).then(function(){return Promise.resolve(g)}.bind(a))}
function bc(a){y(K(a),"clear");q(!a.a);if(a.a)return a=Error("Cannot clear ("+a.h+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Ab;Bb(a.a,function(){var a;a:if(q(!this.c),0==this.f.buffered.length)y(K(this),"nothing to clear."),q(0==this.b.length),a=Promise.resolve();else{try{this.f.remove(0,Number.POSITIVE_INFINITY)}catch(c){a=Promise.reject(c);break a}this.b=[];a=this.c=new I}return[a,this.i.bind(this)]}.bind(a));return ac(a)}
function cc(a,b){y(K(a),"clearAfter");q(!a.a);if(a.a){var c=Error("Cannot clearAfter ("+a.h+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.a=new Ab;Bb(a.a,function(){return[dc(this,b),this.i.bind(this)]}.bind(a));return ac(a)}function Ub(a){y(K(a),"abort");a.a?(a=a.a,a.a?a=a.a:a.f?(a.c&&a.c(),a.a=new I,a=a.a):(a.f=!0,a=Promise.resolve())):a=Promise.resolve();return a}
function fc(a){return 1<a.f.buffered.length?(t(K(a),"multiple buffered ranges detected:","Either the content has gaps in it,","the content's segments are not aligned across bitrates,","or the browser has evicted the middle of the buffer."),!0):!1}function ac(a){q(a.a);a.a.start();return a.a.g.then(J(a,function(){this.a=null})).catch(J(a,function(a){y(K(this),"task failed!");this.a=null;return Promise.reject(a)}))}
function Xb(a,b){q(!a.c);q(a.a);try{a.f.appendBuffer(b)}catch(c){return Promise.reject(c)}a.c=new I;return a.c}function dc(a,b){q(!a.c);if(0==a.f.buffered.length)return y(K(a),"nothing to clear."),q(0==a.b.length),Promise.resolve();var c=$b(a.b,b);if(-1==c||c==a.b.length-1)return y(K(a),"nothing to clear: no segments on or after timestamp."),Promise.resolve();try{a.f.remove(a.b[c+1].startTime,Number.POSITIVE_INFINITY)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.c=new I;return a.c}
Sb.prototype.i=function(){y(K(this),"abort_");q(this.c);"open"==this.j.readyState&&this.f.abort()};Sb.prototype.C=function(){y(K(this),"onSourceBufferUpdateEnd_");q(!this.f.updating);q(this.c);this.c.resolve();this.c=null};function K(a){return"SBM "+a.h+":"};function gc(a){return String.fromCharCode.apply(null,a)}m("shaka.util.Uint8ArrayUtils.toString",gc);function hc(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}m("shaka.util.Uint8ArrayUtils.fromString",hc);m("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(gc(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function ic(a){return hc(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
m("shaka.util.Uint8ArrayUtils.fromBase64",ic);m("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function jc(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}m("shaka.util.Uint8ArrayUtils.toHex",jc);function ab(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function kc(){this.j=this.a="";this.l=!1;this.i=this.h=null;this.w=this.g=!1;this.s=this.f="";this.c=null;this.b=[]}
function lc(a){var b=new kc;if(!a)return b;var c=pb(a,"keySystem");if(null!=c)b.a=c;else throw Error("'keySystem' cannot be null.");var d=pb(a,"licenseServerUrl");if(null!=d)b.j=d;else if(c)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");c=ob(a,"withCredentials","boolean");null!=c&&(b.l=c);c=qb(a,"licensePostProcessor",Function);null!=c&&(b.h=c);c=qb(a,"licensePreProcessor",Function);null!=c&&(b.i=c);c=ob(a,"distinctiveIdentifierRequired","boolean");null!=
c&&(b.g=c);c=ob(a,"persistentStateRequired","boolean");null!=c&&(b.w=c);c=pb(a,"audioRobustness");null!=c&&(b.f=c);c=pb(a,"videoRobustness");null!=c&&(b.s=c);c=qb(a,"serverCertificate",Uint8Array);null!=c&&(b.c=c);if(c=qb(a,"initData",Object)){a=qb(c,"initData",Uint8Array);if(null==a)throw Error("'initData.initData' cannot be null.");c=pb(c,"initDataType");if(null==c)throw Error("'initData.initDataType' cannot be null.");b.b.push({initData:new Uint8Array(a.buffer),initDataType:c})}return b}
function mc(a,b){return a.a==b.a&&a.j==b.j&&a.l==b.l&&a.h==b.h&&a.i==b.i&&a.g==b.g&&a.w==b.w&&a.f==b.f&&a.s==b.s&&ab(a.c,b.c)}function nc(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=Ma(c,oc)}function oc(a,b){return a.initDataType==b.initDataType&&ab(a.initData,b.initData)};function pc(a,b){x("v01b.requestMediaKeySystemAccess");q(this instanceof Navigator);try{var c=new qc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}function rc(a){x("v01b.setMediaKeys");q(this instanceof HTMLMediaElement);var b=this.mediaKeys;b&&b!=a&&(q(b instanceof sc),tc(b,null));delete this.mediaKeys;if(this.mediaKeys=a)q(a instanceof sc),tc(a,this);return Promise.resolve()}
function qc(a,b){x("v01b.MediaKeySystemAccess");this.a=this.keySystem=a;var c=!0;"org.w3.clearkey"==a&&(this.a="webkit-org.w3.clearkey",c=!1);var d=!1,e;e=document.getElementsByTagName("video");e=e.length?e[0]:document.createElement("video");for(var f=0;f<b.length;++f){var g=b[f],k={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"]},l=!1;if(g.audioCapabilities)for(var n=0;n<g.audioCapabilities.length;++n){var r=
g.audioCapabilities[n];r.contentType&&(l=!0,e.canPlayType(r.contentType.split(";")[0],this.a)&&(k.audioCapabilities.push(r),d=!0))}if(g.videoCapabilities)for(n=0;n<g.videoCapabilities.length;++n)r=g.videoCapabilities[n],r.contentType&&(l=!0,e.canPlayType(r.contentType,this.a)&&(k.videoCapabilities.push(r),d=!0));l||(d=e.canPlayType("video/mp4",this.a)||e.canPlayType("video/webm",this.a));"required"==g.persistentState&&(c?(k.persistentState="required",k.sessionTypes=["persistent-license"]):d=!1);if(d){this.b=
k;return}}c="Unsupported keySystem";if("org.w3.clearkey"==a||"com.widevine.alpha"==a)c="None of the requested configurations were supported.";c=Error(c);c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}qc.prototype.createMediaKeys=function(){x("v01b.MediaKeySystemAccess.createMediaKeys");var a=new sc(this.a);return Promise.resolve(a)};qc.prototype.getConfiguration=function(){x("v01b.MediaKeySystemAccess.getConfiguration");return this.b};
function sc(a){x("v01b.MediaKeys");this.g=a;this.b=null;this.a=new ub;this.c=[];this.f={}}function tc(a,b){a.b=b;vb(a.a);b&&(G(a.a,b,"webkitneedkey",a.Xb.bind(a)),G(a.a,b,"webkitkeymessage",a.Wb.bind(a)),G(a.a,b,"webkitkeyadded",a.Ub.bind(a)),G(a.a,b,"webkitkeyerror",a.Vb.bind(a)))}h=sc.prototype;
h.createSession=function(a){x("v01b.MediaKeys.createSession");var b=a||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+a+" is unsupported on this platform.");a=this.b||document.createElement("video");a.src||(a.src="about:blank");b=new uc(a,this.g,b);this.c.push(b);return b};h.setServerCertificate=function(){x("v01b.MediaKeys.setServerCertificate");return Promise.reject(Error("setServerCertificate not supported on this platform."))};
h.Xb=function(a){x("v01b.onWebkitNeedKey_",a);q(this.b);a=C({type:"encrypted",initDataType:"webm",initData:a.initData});this.b.dispatchEvent(a)};h.Wb=function(a){x("v01b.onWebkitKeyMessage_",a);var b=vc(this,a.sessionId);b?(a=C({type:"message",messageType:void 0==b.keyStatuses.La()?"licenserequest":"licenserenewal",message:a.message}),x("v01b.MediaKeySession.generated"),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a)):t("Session not found",a.sessionId)};
h.Ub=function(a){x("v01b.onWebkitKeyAdded_",a);a=vc(this,a.sessionId);q(a);a&&(x("v01b.MediaKeySession.ready"),wc(a,"usable"),a.a&&a.a.resolve(),a.a=null)};
h.Vb=function(a){x("v01b.onWebkitKeyError_",a);var b=vc(this,a.sessionId);q(b);if(b){x("v01b.MediaKeySession.handleError",a);var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45==a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?wc(b,"output-restricted"):
1==c?wc(b,"expired"):wc(b,"internal-error"))}};function vc(a,b){var c=a.f[b];return c?(x("v01b.MediaKeys.findSession_",c),c):(c=a.c.shift())?(c.sessionId=b,a.f[b]=c,x("v01b.MediaKeys.findSession_",c),c):null}function uc(a,b,c){x("v01b.MediaKeySession");H.call(this,null);this.g=a;this.h=!1;this.a=this.b=null;this.c=b;this.f=c;this.sessionId="";this.expiration=NaN;this.closed=new I;this.keyStatuses=new xc}p(uc,H);
function yc(a,b,c){if(a.h)return Promise.reject(Error("The session is already initialized."));a.h=!0;var d;try{if("persistent-license"==a.f)if(c)d=hc("LOAD_SESSION|"+c);else{var e=new Uint8Array(b);d=hc("PERSISTENT|"+gc(e))}else q("temporary"==a.f),q(!c),d=new Uint8Array(b);q(d)}catch(f){return Promise.reject(f)}q(null==a.b);a.b=new I;try{a.g.webkitGenerateKeyRequest(a.c,d)}catch(g){if("InvalidStateError"!=g.name)return a.b=null,Promise.reject(g);setTimeout(function(){try{this.g.webkitGenerateKeyRequest(this.c,
d)}catch(a){this.b.reject(a),this.b=null}}.bind(a),10)}return a.b}h=uc.prototype;
h.Wa=function(a,b){if(this.a)this.a.then(this.Wa.bind(this,a,b)).catch(this.Wa.bind(this,a,b));else{this.a=a;var c,d;"webkit-org.w3.clearkey"==this.c?(c=gc(new Uint8Array(b)),d=JSON.parse(c),"oct"!=d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),c=ic(d.keys[0].k),d=ic(d.keys[0].kid)):(c=new Uint8Array(b),d=null);try{this.g.webkitAddKey(this.c,c,d,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}};
function wc(a,b){a.keyStatuses.Sa(b);var c=C({type:"keystatuseschange"});a.dispatchEvent(c)}h.generateRequest=function(a,b){x("v01b.MediaKeySession.generateRequest");return yc(this,b,null)};h.load=function(a){x("v01b.MediaKeySession.load");return"persistent-license"==this.f?yc(this,null,a):Promise.reject(Error("Not a persistent session."))};h.update=function(a){x("v01b.MediaKeySession.update",a);q(this.sessionId);var b=new I;this.Wa(b,a);return b};
h.close=function(){x("v01b.MediaKeySession.close");if("persistent-license"!=this.f){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.g.webkitCancelKeyRequest(this.c,this.sessionId)}this.closed.resolve();return this.closed};h.remove=function(){x("v01b.MediaKeySession.remove");return"persistent-license"!=this.f?Promise.reject(Error("Not a persistent session.")):this.close()};function zc(a){this.b=a;this.a=0}
zc.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};function xc(){this.size=0;this.a=void 0}var Ac;h=xc.prototype;h.Sa=function(a){this.size=void 0==a?0:1;this.a=a};h.La=function(){return this.a};h.entries=function(){var a=Ac,b=[];this.a&&b.push([a,this.a]);return new zc(b)};h.forEach=function(a){this.a&&a(this.a)};h.get=function(a){if(this.has(a))return this.a};h.has=function(a){var b=Ac;return this.a&&ab(new Uint8Array(a),b)?!0:!1};
h.keys=function(){var a=Ac,b=[];this.a&&b.push(a);return new zc(b)};h.values=function(){var a=[];this.a&&a.push(this.a);return new zc(a)};function Bc(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Pa(new DataView(a.buffer));try{for(;Ra(a);){var b=a.a,c=A(a),d=A(a);1==c?c=Ta(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)v("Non-PSSH box found!"),Wa(a,c-(a.a-b));else{var e=Sa(a);if(1<e)v("Unrecognized PSSH version found!"),Wa(a,c-(a.a-b));else{Wa(a,3);var f=jc(Ua(a)),g=[];if(0<e)for(var k=A(a),l=0;l<k;++l){var n=jc(Ua(a));g.push(n)}var r=A(a);Wa(a,r);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,
end:a.a-1});a.a!=b+c&&(v("Mismatch between box size and data size!"),Wa(a,c-(a.a-b)))}}}}catch(u){v("PSSH parse failure!  Some data may be missing or incorrect.")}};function Cc(a,b){x("PatchedMediaKeys.v20140218.requestMediaKeySystemAccess");q(this instanceof Navigator);try{var c=new Dc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}
function Dc(a,b){x("v20140218.MediaKeySystemAccess");this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"]},g=!1;if(e.audioCapabilities)for(var k=0;k<e.audioCapabilities.length;++k){var l=e.audioCapabilities[k];if(l.contentType){var g=!0,n=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,n)&&(f.audioCapabilities.push(l),
c=!0)}}if(e.videoCapabilities)for(k=0;k<e.videoCapabilities.length;++k)l=e.videoCapabilities[k],l.contentType&&(g=!0,n=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,n)&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==e.persistentState&&(f.persistentState="required",f.sessionTypes=["persistent-license"]);if(c){this.a=f;return}}c=Error("Unsupported keySystem");c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;
throw c;}Dc.prototype.createMediaKeys=function(){x("v20140218.MediaKeySystemAccess.createMediaKeys");var a=new Ec(this.keySystem);return Promise.resolve(a)};Dc.prototype.getConfiguration=function(){x("v20140218.MediaKeySystemAccess.getConfiguration");return this.a};function Fc(a){x("v20140218.setMediaKeys");var b=this.mediaKeys;b&&b!=a&&(q(b instanceof Ec),Gc(b,null));delete this.mediaKeys;return(this.mediaKeys=a)?(q(a instanceof Ec),Gc(a,this)):Promise.resolve()}
function Ec(a){x("v20140218.MediaKeys");this.a=new MSMediaKeys(a);this.b=new ub}Ec.prototype.createSession=function(a){x("v20140218.MediaKeys.createSession");if("temporary"!=(a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new Hc(this.a)};Ec.prototype.setServerCertificate=function(){x("v20140218.MediaKeys.setServerCertificate");return Promise.reject(Error("setServerCertificate not supported on this platform."))};
function Gc(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener("loadedmetadata",c)}vb(a.b);if(!b)return Promise.resolve();G(a.b,b,"msneedkey",Ic);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener("loadedmetadata",c),Promise.resolve()}catch(e){return Promise.reject(e)}}
function Hc(a){x("v20140218.MediaKeySession");H.call(this,null);this.c=null;this.g=a;this.b=this.a=null;this.f=new ub;this.sessionId="";this.expiration=NaN;this.closed=new I;this.keyStatuses=new Jc}p(Hc,H);h=Hc.prototype;
h.generateRequest=function(a,b){x("v20140218.MediaKeySession.generateRequest");this.a=new I;try{this.c=this.g.createSession("video/mp4",b),G(this.f,this.c,"mskeymessage",this.Jb.bind(this)),G(this.f,this.c,"mskeyadded",this.Hb.bind(this)),G(this.f,this.c,"mskeyerror",this.Ib.bind(this)),Kc(this,"status-pending")}catch(c){this.a.reject(c)}return this.a};h.load=function(){x("v20140218.MediaKeySession.load");return Promise.reject(Error("MediaKeySession.load not yet supported"))};
h.update=function(a){x("v20140218.MediaKeySession.update");this.b=new I;try{this.c.update(a)}catch(b){this.b.reject(b)}return this.b};h.close=function(){x("v20140218.MediaKeySession.close");try{this.c.close(),this.closed.resolve(),vb(this.f)}catch(a){this.closed.reject(a)}return this.closed};h.remove=function(){x("v20140218.MediaKeySession.remove");return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function Ic(a){x("v20140218.onMsNeedKey_",a);var b=a.initData;if(b){var c=new Bc(b);if(1>=c.a.length)a=b;else{var d=[];for(a=0;a<c.a.length;a++)d.push(b.subarray(c.a[a].start,c.a[a].end+1));b=Ma(d,Lc);for(a=c=0;a<b.length;a++)c+=b[a].length;c=new Uint8Array(c);for(a=d=0;a<b.length;a++)c.set(b[a],d),d+=b[a].length;a=c}}else a=b;a=C({type:"encrypted",initDataType:"cenc",initData:a});this.dispatchEvent(a)}function Lc(a,b){return ab(a,b)}
h.Jb=function(a){x("v20140218.onMsKeyMessage_",a);this.a&&(this.a.resolve(),this.a=null);a=C({type:"message",messageType:void 0==this.keyStatuses.La()?"licenserequest":"licenserenewal",message:a.message.buffer});this.dispatchEvent(a)};h.Hb=function(a){x("v20140218.onMsKeyAdded_",a);this.b&&(Kc(this,"usable"),this.b.resolve(),this.b=null)};
h.Ib=function(a){x("v20140218.onMsKeyError_",a);a=Error("EME v20140218 key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Kc(this,"output-not-allowed");default:Kc(this,"internal-error")}};function Kc(a,b){a.keyStatuses.Sa(b);var c=C({type:"keystatuseschange"});a.dispatchEvent(c)}
function Mc(a){this.b=a;this.a=0}Mc.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};function Jc(){this.size=0;this.a=void 0}var Nc;h=Jc.prototype;h.Sa=function(a){this.size=void 0==a?0:1;this.a=a};h.La=function(){return this.a};h.entries=function(){var a=Nc,b=[];this.a&&b.push([a,this.a]);return new Mc(b)};h.forEach=function(a){this.a&&a(this.a)};h.get=function(a){if(this.has(a))return this.a};
h.has=function(a){var b=Nc;return this.a&&ab(new Uint8Array(a),b)?!0:!1};h.keys=function(){var a=Nc,b=[];this.a&&b.push(a);return new Mc(b)};h.values=function(){var a=[];this.a&&a.push(this.a);return new Mc(a)};function Oc(){x("MediaKeys.install");Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?w("Using native EME as-is."):HTMLMediaElement.prototype.webkitGenerateKeyRequest?(w("Using prefixed EME v0.1b."),x("v01b.install"),q(HTMLMediaElement.prototype.webkitGenerateKeyRequest),Ac=new Uint8Array([0]),Navigator.prototype.requestMediaKeySystemAccess=pc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=
rc,window.MediaKeys=sc,window.MediaKeySystemAccess=qc):window.MSMediaKeys?(w("Using EME v20140218"),x("PatchedMediaKeys.v20140218.install"),Nc=new Uint8Array([0]),delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Fc,window.MediaKeys=Ec,window.MediaKeySystemAccess=Dc,Navigator.prototype.requestMediaKeySystemAccess=Cc):(w("EME not available."),x("PatchedMediaKeys.nop.install"),Navigator.prototype.requestMediaKeySystemAccess=
Aa,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ba,window.MediaKeys=Ca,window.MediaKeySystemAccess=Ea)}m("shaka.polyfill.MediaKeys.install",Oc);m("shaka.polyfill.installAll",function(){wa();ya();Ka();Ha();Oc()});m("shaka.vimond.dash.ManifestModificationSetup",function(a,b){this.b=a||null;this.a=b||null});function Pc(a){this.a=a||null}function Qc(a,b){if("string"===typeof b&&a.a){var c=a.a.b;c&&(b=c.reduce(function(a,b){var c=b.b instanceof RegExp?b.b:new RegExp(b.b.toString(),b.c),g=a.replace(c,b.a);g!==a?w("Manifest modifier in action: Replaced matches for %s with %s.",c,b.a):w("Manifest modifier found nothing for pattern %s to be replaced with %s.",c,b.a);return g},b))}return b};m("shaka.vimond.dash.ReplacementRule",function(a,b,c){this.b=a;this.c=c||null;this.a=b});var Rc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function M(a){var b;a instanceof M?(Sc(this,a.Y),this.ka=a.ka,this.aa=a.aa,Tc(this,a.oa),this.X=a.X,Uc(this,a.a.clone()),this.ia=a.ia):a&&(b=String(a).match(Rc))?(Sc(this,b[1]||"",!0),this.ka=Vc(b[2]||""),this.aa=Vc(b[3]||"",!0),Tc(this,b[4]),this.X=Vc(b[5]||"",!0),Uc(this,b[6]||"",!0),this.ia=Vc(b[7]||"")):this.a=new Wc(null)}h=M.prototype;h.Y="";h.ka="";h.aa="";h.oa=null;h.X="";h.ia="";
h.toString=function(){var a=[],b=this.Y;b&&a.push(Xc(b,Yc,!0),":");if(b=this.aa){a.push("//");var c=this.ka;c&&a.push(Xc(c,Yc,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.oa;null!=b&&a.push(":",String(b))}if(b=this.X)this.aa&&"/"!=b.charAt(0)&&a.push("/"),a.push(Xc(b,"/"==b.charAt(0)?Zc:$c,!0));(b=this.a.toString())&&a.push("?",b);(b=this.ia)&&a.push("#",Xc(b,ad));return a.join("")};
h.resolve=function(a){var b=this.clone();"data"===b.Y&&(b=new M);var c=!!a.Y;c?Sc(b,a.Y):c=!!a.ka;c?b.ka=a.ka:c=!!a.aa;c?b.aa=a.aa:c=null!=a.oa;var d=a.X;if(c)Tc(b,a.oa);else if(c=!!a.X){if("/"!=d.charAt(0))if(this.aa&&!this.X)d="/"+d;else{var e=b.X.lastIndexOf("/");-1!=e&&(d=b.X.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var k=d[g++];"."==k?e&&g==d.length&&f.push(""):".."==k?((1<
f.length||1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(k),e=!0)}d=f.join("/")}}c?b.X=d:c=""!==a.a.toString();c?Uc(b,a.a.clone()):c=!!a.ia;c&&(b.ia=a.ia);return b};h.clone=function(){return new M(this)};function Sc(a,b,c){a.Y=c?Vc(b,!0):b;a.Y&&(a.Y=a.Y.replace(/:$/,""))}function Tc(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.oa=b}else a.oa=null}function Uc(a,b,c){b instanceof Wc?a.a=b:(c||(b=Xc(b,bd)),a.a=new Wc(b))}
function Vc(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function Xc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,cd),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function cd(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Yc=/[#\/\?@]/g,$c=/[\#\?:]/g,Zc=/[\#\?]/g,bd=/[\#\?@]/g,ad=/#/g;function Wc(a){this.b=a||null}Wc.prototype.a=null;Wc.prototype.c=null;
function dd(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,k=null;0<=f?(g=d[e].substring(0,f),k=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));k=k||"";dd(a,g,decodeURIComponent(k.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
Wc.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};Wc.prototype.clone=function(){var a=new Wc;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function ed(a,b){var c=(new DOMParser).parseFromString(a,"text/xml");return c?N({A:b},c,gd):(t("Failed to parse MPD XML."),null)}function gd(){this.id=this.url=null;this.type="static";this.c=this.j=this.A=null;this.h=5;this.f=this.b=this.g=null;this.i=1;this.a=[]}function hd(){this.m=this.c=this.b=this.A=this.a=this.start=this.id=null;this.J=[]}
function id(){this.g=this.a=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.b=!1;this.m=this.f=this.c=this.A=null;this.h=[];this.H=[]}function jd(){this.value=null}function kd(){this.contentType=this.lang=this.id=null}function ld(){this.m=this.a=this.b=this.A=this.g=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function md(){this.b=this.a=this.c=this.f=null}function nd(){this.parsedPssh=this.psshBox=null}function od(){this.url=null}
function pd(){this.url=null}function qd(){this.A=null;this.u=1;this.c=this.b=this.a=this.D=null}qd.prototype.clone=function(){var a=new qd;a.A=rd(this.A);a.u=this.u;a.D=this.D;a.a=sd(this.a);a.b=sd(this.b);a.c=sd(this.c);return a};function td(){this.a=this.url=null}td.prototype.clone=function(){var a=new td;a.url=rd(this.url);a.a=sd(this.a);return a};function ud(){this.a=this.url=null}ud.prototype.clone=function(){var a=new ud;a.url=rd(this.url);a.a=sd(this.a);return a};
function vd(){this.A=null;this.u=1;this.b=this.D=null;this.f=1;this.c=null;this.a=[];this.B=null}vd.prototype.clone=function(){var a=new vd;a.A=rd(this.A);a.u=this.u;a.D=this.D;a.b=this.b;a.f=this.f;a.c=sd(this.c);a.a=rd(this.a)||[];a.B=sd(this.B);return a};function wd(){this.a=this.b=null}wd.prototype.clone=function(){var a=new wd;a.b=rd(this.b);a.a=sd(this.a);return a};function xd(){this.u=1;this.a=this.D=null;this.g=1;this.B=this.f=this.b=this.c=null}
xd.prototype.clone=function(){var a=new xd;a.u=this.u;a.D=this.D;a.a=this.a;a.g=this.g;a.c=this.c;a.b=this.b;a.f=this.f;a.B=sd(this.B);return a};function yd(){this.V=[]}yd.prototype.clone=function(){var a=new yd;a.V=rd(this.V)||[];return a};function zd(){this.b=this.a=this.startTime=null}zd.prototype.clone=function(){var a=new zd;a.startTime=this.startTime;a.a=this.a;a.b=this.b;return a};function Ad(a,b){this.ma=a;this.end=b}Ad.prototype.clone=function(){return new Ad(this.ma,this.end)};
gd.TAG_NAME="MPD";hd.TAG_NAME="Period";id.TAG_NAME="AdaptationSet";jd.TAG_NAME="Role";kd.TAG_NAME="ContentComponent";ld.TAG_NAME="Representation";md.TAG_NAME="ContentProtection";nd.TAG_NAME="cenc:pssh";od.TAG_NAME="BaseURL";pd.TAG_NAME="Location";qd.TAG_NAME="SegmentBase";td.TAG_NAME="RepresentationIndex";ud.TAG_NAME="Initialization";vd.TAG_NAME="SegmentList";wd.TAG_NAME="SegmentURL";xd.TAG_NAME="SegmentTemplate";yd.TAG_NAME="SegmentTimeline";zd.TAG_NAME="S";
gd.prototype.parse=function(a,b){this.url=a.A;this.id=O(b,"id",P);this.type=O(b,"type",P)||"static";this.c=O(b,"mediaPresentationDuration",Bd);this.h=O(b,"minBufferTime",Bd,this.h);this.g=O(b,"minimumUpdatePeriod",Bd,this.g);this.b=O(b,"availabilityStartTime",Cd,this.b);this.f=O(b,"timeShiftBufferDepth",Bd,this.f);this.i=O(b,"suggestedPresentationDelay",Bd,this.i);var c=a.A,d=Dd(this,b,od);this.A=Ed(c,d);if(d=N(this,b,pd))this.j=Fd(c,d.url);this.a=Dd(this,b,hd)};
function Gd(a,b,c,d){if(0!==a.a.length){var e=new id;e.contentType="text";e.lang=c||"en";e.b=!0;c=new ld;c.bandwidth=0;c.f=d||"text/vtt";c.A=[new M(b)];e.H.push(c);a.a[0].J.push(e);Hd(a.a[0])}}hd.prototype.parse=function(a,b){this.id=O(b,"id",P);this.start=O(b,"start",Bd);this.a=O(b,"duration",Bd);var c=Dd(this,b,od);this.A=Ed(a.A,c);this.b=N(this,b,qd);this.c=N(this,b,vd);this.m=N(this,b,xd);this.J=Dd(this,b,id);Hd(this)};
function Hd(a){for(var b=[],c=0;c<a.J.length;++c){var d=a.J[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.J.length;++c)if(d=a.J[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
id.prototype.parse=function(a,b){var c=N(this,b,kd)||{},d=N(this,b,jd);this.id=O(b,"id",P);this.group=O(b,"group",Q);this.lang=O(b,"lang",P,c.lang);this.contentType=O(b,"contentType",P,c.contentType);this.width=O(b,"width",Id);this.height=O(b,"height",Id);this.a=O(b,"mimeType",P);this.g=O(b,"codecs",P);this.b=d&&"main"==d.value;this.lang&&(this.lang=ib(this.lang));c=Dd(this,b,od);this.A=Ed(a.A,c);this.h=Dd(this,b,md);!this.contentType&&this.a&&(this.contentType=this.a.split("/")[0]);this.c=a.b?Jd(this,
b,a.b):N(this,b,qd);this.f=a.c?Jd(this,b,a.c):N(this,b,vd);this.m=a.m?Jd(this,b,a.m):N(this,b,xd);this.H=Dd(this,b,ld);!this.a&&this.H.length&&(this.a=this.H[0].f,!this.contentType&&this.a&&(this.contentType=this.a.split("/")[0]))};jd.prototype.parse=function(a,b){this.value=O(b,"value",P)};kd.prototype.parse=function(a,b){this.id=O(b,"id",P);this.lang=O(b,"lang",P);this.contentType=O(b,"contentType",P);this.lang&&(this.lang=ib(this.lang))};
ld.prototype.parse=function(a,b){this.id=O(b,"id",P);this.bandwidth=O(b,"bandwidth",Id);this.width=O(b,"width",Id,a.width);this.height=O(b,"height",Id,a.height);this.f=O(b,"mimeType",P,a.a);this.g=O(b,"codecs",P,a.g);this.lang=a.lang;var c=Dd(this,b,od);this.A=Ed(a.A,c);this.c=Dd(this,b,md);this.b=a.c?Jd(this,b,a.c):N(this,b,qd);this.a=a.f?Jd(this,b,a.f):N(this,b,vd);this.m=a.m?Jd(this,b,a.m):N(this,b,xd);0==this.c.length&&(this.c=a.h)};
md.prototype.parse=function(a,b){this.f=b;this.c=O(b,"schemeIdUri",P);var c=O(b,"cenc:default_KID",P);c&&(this.b=c.replace(/[-]/g,""));this.a=N(this,b,nd)};nd.prototype.parse=function(a,b){var c=Kd(b);if(c){this.psshBox=ic(c);try{this.parsedPssh=new Bc(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};od.prototype.parse=function(a,b){this.url=Kd(b)};pd.prototype.parse=function(a,b){this.url=Kd(b)};
qd.prototype.parse=function(a,b){this.A=a.A||this.A;this.u=O(b,"timescale",Id,this.u);this.D=O(b,"presentationTimeOffset",Q,this.D);this.a=O(b,"indexRange",Ld,this.a);this.b=N(this,b,td)||this.b;this.c=N(this,b,ud)||this.c};td.prototype.parse=function(a,b){var c=O(b,"sourceURL",P);this.url=Fd(a.A,c);this.a=O(b,"range",Ld,sd(a.a))};ud.prototype.parse=function(a,b){var c=O(b,"sourceURL",P);this.url=Fd(a.A,c);this.a=O(b,"range",Ld)};
vd.prototype.parse=function(a,b){this.A=a.A||this.A;this.u=O(b,"timescale",Id,this.u);this.D=O(b,"presentationTimeOffset",Q,this.D);this.b=O(b,"duration",Id,this.b);this.f=O(b,"startNumber",Q,this.f);this.c=N(this,b,ud)||this.c;var c=Dd(this,b,wd);this.a=c&&0<c.length?c:this.a;this.B=N(this,b,yd)||this.B};wd.prototype.parse=function(a,b){var c=O(b,"media",P);this.b=Fd(a.A,c);this.a=O(b,"mediaRange",Ld)};
xd.prototype.parse=function(a,b){this.u=O(b,"timescale",Id,this.u);this.D=O(b,"presentationTimeOffset",Q,this.D);this.a=O(b,"duration",Id,this.a);this.g=O(b,"startNumber",Q,this.g);this.c=O(b,"media",P,this.c);this.b=O(b,"index",P,this.b);this.f=O(b,"initialization",P,this.f);this.B=N(this,b,yd)||this.B};yd.prototype.parse=function(a,b){this.V=Dd(this,b,zd)};zd.prototype.parse=function(a,b){this.startTime=O(b,"t",Q);this.a=O(b,"d",Q);this.b=O(b,"r",Md)};
function Ed(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new M(e)):(e=Fd(a.slice(0,1),e),c.push(e[0]))}return c}function Fd(a,b){if(!b)return a;var c=new M(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Jd(a,b,c){var d=sd(c);q(d);(b=Nd(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function N(a,b,c){var d=null;if(b=Nd(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}
function Nd(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function Dd(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Kd(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function rd(a){return a?a.map(function(a){return a.clone()}):null}function sd(a){return a?a.clone():null}
function O(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function Cd(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Bd(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return v("Invalid duration string:",a),null;a=0;var c=Q(b[1]);c&&(a+=31536E3*c);(c=Q(b[2]))&&(a+=2592E3*c);(c=Q(b[3]))&&(a+=86400*c);(c=Q(b[4]))&&(a+=3600*c);(c=Q(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Ld(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=Q(b[1]);if(null==a)return null;b=Q(b[2]);return null==b?null:new Ad(a,b)}function Md(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function Id(a){a=window.parseInt(a,10);return 0<a?a:null}function Q(a){a=window.parseInt(a,10);return 0<=a?a:null}function P(a){return a};function Od(a,b){this.url=a;this.b=b||new Yb;this.g=this.i=this.h=0;this.a=null;this.c=new I;this.f=null}function Yb(){this.body=null;this.a=1;this.i=1E3;this.c=0;this.method="GET";this.h="arraybuffer";this.b={};this.f=this.j=!1;this.g=null}function Pd(a){Qd(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}function Qd(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}h=Od.prototype;
h.vb=function(){q(null==this.a);if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.h&&(b=hc(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);Pd(this);return b}if(0==this.url.lastIndexOf("idb:",0))return q(!0),Rd(this);this.h++;
this.i=Date.now();this.g||(this.g=this.b.i);this.a=new XMLHttpRequest;a=this.url;if(this.f&&!this.f.supportsCaching()||this.b.f)a=new M(a),dd(a.a,"_",Date.now()),a=a.toString();this.a.open(this.b.method,a,!0);this.a.responseType=this.b.h;this.a.timeout=this.b.c;this.a.withCredentials=this.b.j;this.a.onload=this.Fb.bind(this);this.b.f&&(this.a.onreadystatechange=this.Mb.bind(this));this.a.onerror=this.cc.bind(this);this.a.ontimeout=this.Rb.bind(this);for(b in this.b.b)this.a.setRequestHeader(b,this.b.b[b]);
this.a.send(this.b.body);return this.c};function Rd(a){var b=a.url.split("/");q(4==b.length);var c=parseInt(b[2],10),b=parseInt(b[3],10);q(!isNaN(c));q(!isNaN(b));q(a.b.g);return Rb(a.b.g,c,b).then(J(a,function(a){var b=JSON.parse(JSON.stringify(new XMLHttpRequest));b.response=a;a=this.c;a.resolve(b);Pd(this);return a})).catch(J(a,function(a){Pd(this);return Promise.reject(a)}))}
function Sd(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.gc=a.a;return b}h.Fb=function(a){q(a.target==this.a);this.f&&this.f.sample(Date.now()-this.i,a.loaded);200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Pd(this)):this.h<this.b.a?Td(this):(a=Sd(this,"HTTP error.","net"),this.c.reject(a),Pd(this))};
h.Mb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){q(this.b.f);var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Oa=a-Date.now())}};h.cc=function(a){q(a.target==this.a);a=Sd(this,"Network failure.","net");this.c.reject(a);Pd(this)};h.Rb=function(){if(this.h<this.b.a)Td(this);else{var a=Sd(this,"Request timed out.","net");this.c.reject(a);Pd(this)}};function Td(a){Qd(a);window.setTimeout(a.vb.bind(a),a.g*(1+.5*(2*Math.random()-1)));a.g*=2};function L(a,b,c,d){q(b);q(0<b.length);this.a=b;this.f=c||0;this.h=null!=d?d:null;this.c=this.b=null;this.i=a}function Ud(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}function Zb(a,b,c){if(a.b)return a.b;b=b||new Yb;if(a.f||a.h)b.b.Range="bytes="+(a.f+"-"+(null!=a.h?a.h:""));q(!a.c);a.b=Vd(a,0,b,c);return a.b}
L.prototype.g=function(){if(this.c){this.b=null;var a=this.c;if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){q(0!=a.a.readyState);a.a.abort();var b=Sd(a,"Request aborted.","aborted");a.c.reject(b);Pd(a)}this.c=null}};
function Vd(a,b,c,d){q(b<a.a.length);var e=a.a[b].toString();a.i&&(e=a.i(e,c.b)||e);a.c=new Od(e,c);d&&(a.c.f=d);e=a.c.vb().then(J(a,function(a){this.c=this.b=null;return Promise.resolve(a.response)}));return e=e.catch(J(a,function(a){if(this.b&&b+1<this.a.length)return w("Trying fallback URL..."),this.b=Vd(this,b+1,c,d);this.b=this.c=null;return Promise.reject(a)}))}L.prototype.clone=function(){return new L(this.i,this.a.map(function(a){return a.clone()}),this.f,this.h)};L.prototype.toString=function(){return this.a[0].toString()};function Wd(a,b){this.a=new Yb;this.a.h="text";this.a.a=3;this.a.c=1E3*(null!=b?b:0);this.a.f=!0;this.g=a}Wd.prototype.b=function(){var a=this.g;return Zb(a,this.a).then(function(b){if(b=ed(b,a.a))return Promise.resolve(b);b=Error("MPD parse failure.");b.type="dash";return Promise.reject(b)})};function Xd(a,b,c,d){q(b.m);q(0<b.m.u);q(b.m.a);q(0<c);for(var e=b.m,f=[],g=0;g<d;++g){var k=g+c,l=(k-1)*e.a,n=l/e.u,l=(l+e.a)/e.u,k=Yd(a,b,k-1+e.g,(k-1)*e.a);if(!k)return null;f.push(new Zd(n,l,k))}return f}function Yd(a,b,c,d){q(b.m);if(!b.m)return null;var e=b.m.c;if(!e)return v("The SegmentTemplate's media URL template is missing:","using the Representation's BaseURL instead.",b),b.A?new L(a,b.A,0,null):null;c=$d(e,b.id,c,b.bandwidth,d);if(!c)return null;b=Ud(b.A,c);return new L(a,b,0,null)}
function $d(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};b=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(b,c,d){if("$$"==b)return"$";var e=f[c];q(void 0!==e);if(null==e)return v("URL template does not have an available substitution for identifier",'"'+c+'":',a),b;"RepresentationID"==c&&d&&(v("URL template should not contain a width specifier for identifier",'"RepresentationID":',a),d=void 0);b=e.toString();d=window.parseInt(d,10)||1;d=Math.max(0,
d-b.length);return Array(d+1).join("0")+b});try{return new M(b)}catch(g){if(g instanceof URIError)return v("URL template contains an illegal character:",a),null;throw g;}}
function ae(a,b,c){q(a);var d=0;c*=b;a=a.V;for(var e=[],f=0;f<a.length;++f){if(!a[f].a){v('SegmentTimeline "S" element does not have a duration:','ignoring the remaining "S" elements.',a[f]);break}var g=a[f].startTime,g=null!=g?g:d,k=a[f].b||0;if(0>k)if(k=a[f].a,f+1===a.length)var l=a[0].startTime+c-g,k=Math.ceil(l/k)-1;else k=Math.ceil((a[f+1].startTime-g)/k)-1;0<e.length&&g!=d&&(l=g-d,.03125<=Math.abs(l/b)&&v("SegmentTimeline contains a large gap/overlap.","The content may have errors in it.",a[f]),
e[e.length-1].end=g);for(l=0;l<=k;++l)d=g+a[f].a,e.push({start:g,end:d}),g=d}return e};function be(a,b){q(!a||!b);this.a=a;this.b=b||null}be.prototype.destroy=function(){this.a&&(this.a.g(),this.a=null);this.b=null};be.prototype.create=function(){return this.a?Zb(this.a):Promise.resolve(this.b)};function Zd(a,b,c){q(null==b||a<=b,"startTime should be <= endTime");this.startTime=a;this.a=b;this.url=c}function ce(a,b,c){return new Zd(b,c,a.url)}function $b(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.a||b<d.a))return c}return-1}function de(a,b){return a.map(function(a){return ce(a,a.startTime+b,null!=a.a?a.a+b:null)})}
function ee(a){for(var b=a[0],c=1;c<a.length;++c){var d=a[c],e=d.startTime>b.startTime&&d.startTime<=b.a&&(d.a&&d.a>=b.a||c==a.length-1);q(e,"SegmentReferences are not correct.");e||x("SegmentReferences should be sorted without gaps:","previous",b,"current",d);b=d}};function fe(){}
fe.prototype.parse=function(a,b,c,d){var e=null;try{a:{var f=[],g=new Pa(a),k=A(g);if(1936286840!=A(g))t('Invalid box type, expected "sidx".'),e=null;else{1==k&&(k=Ta(g));var l=Sa(g);Wa(g,3);Wa(g,4);var n=A(g);q(0!=n);if(0==n)t("Invalid timescale."),e=null;else{var r,u;0==l?(r=A(g),u=A(g)):(r=Ta(g),u=Ta(g));Wa(g,2);var F=g.b.getUint16(g.a,g.c);g.a+=2;a=r;b=b+k+u;for(k=0;k<F;k++){var z=A(g);u=(z&2147483648)>>>31;var l=z&2147483647,B=A(g);A(g);if(1==u){t("Heirarchical SIDXs are not supported.");e=null;
break a}var Da=new L(d,c,b,b+l-1);f.push(new Zd(a/n,(a+B)/n,Da));a+=B;b+=l}e=f}}}}catch(ec){if(!(ec instanceof RangeError))throw ec;}return e};function R(a){this.o=a;this.l=0}R.prototype.destroy=function(){this.o=null};h=R.prototype;h.length=function(){return this.o.length};function S(a){if(0==a.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.o[0]}h.F=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]};
h.get=function(a){if(0>a||a>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[a]};h.ra=function(a){a=$b(this.o,a);return 0<=a?this.o[a]:null};h.Na=function(a){ge(this,a);return!0};
function ge(a,b){if(a.l!=b.l){var c=a.l-b.l;da("Shifting new SegmentReferences by",c,"seconds before merging.");b=new R(de(b.o,c))}if(0==a.length())a.o=b.o.slice(0),ee(a.o);else if(0==b.length())x("Nothing to merge: new SegmentIndex is empty.");else if(null==a.F().a)x("Nothing to merge:","existing SegmentIndex ends at the end of the stream.");else if(null!=b.F().a&&b.F().a<a.F().a)x("Nothing to merge:","new SegmentIndex ends before the existing one ends.");else{if(a.F().a<=S(b).startTime)c=ce(a.F(),
a.F().startTime,S(b).startTime),c=a.o.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.o.length&&!(a.o[d].a>=S(b).startTime);++d);q(d<a.o.length);a.o[d].startTime<S(b).startTime?(c=ce(a.o[d],a.o[d].startTime,S(b).startTime),c=a.o.slice(0,d).concat([c])):(q(S(a).startTime>S(b).startTime||a.o[d].startTime==S(b).startTime),c=a.o.slice(0,d))}a.o=c.concat(b.o);ee(a.o)}}
h.qa=function(a){var b=a-this.l;if(0==b)return da("Already applied timestamp correction of",a,"seconds to",this),0;this.o=de(this.o,b);ee(this.o);this.l=a;x("Applied timestamp correction of",a,"seconds to SegmentIndex",this);return b};h.Ka=function(){return 0<this.length()?{start:S(this).startTime,end:this.F().a}:{start:0,end:0}};function T(a,b,c,d){q(null!=b.b);q(null!=c.start);R.call(this,a);this.h=b;this.w=c;this.g=d;this.i=this.h.c||this.h.a.reduce(function(a,b){return null==b.a?NaN:a+b.a},0)||0;this.a=this.f=this.b=null;he(this)}p(T,R);T.prototype.destroy=function(){this.w=this.h=null;R.prototype.destroy.call(this)};T.prototype.ra=function(a){ie(this,Na()/1E3);return R.prototype.ra.call(this,a)};
T.prototype.Na=function(a){if(!(a instanceof T))return v("Cannot integrate SegmentIndex:","Only a LiveSegmentIndex can be integrated into","another LiveSegmentIndex.",this),!1;ge(this,a);this.i=Math.max(this.i,a.i);null==this.b?(this.g=a.g,he(this)):je(this);return!0};
function he(a){q(null==a.b);q(null==a.f);q(null==a.a);je(a);if(0!=a.length()){q(0<a.length());var b=null!=a.F().a?a.F().a:a.F().startTime;if(a.h.b>a.g)v("The stream might not be available yet!",a.w),a.b=b;else{var c=a.g-(a.h.b+a.w.start);0>c?(v("The Period might not be available yet!",a.w),a.b=b):c<Math.max(a.F().startTime,a.F().a||0)?(v("@availabilityStartTime seems to be inaccurate;","some segments may not be available yet:","currentPresentationTime",c,"latestAvailableSegmentEndTime",a.F().a),a.b=
b):a.b=c}a.f=a.F().startTime;a.a=S(a).startTime;y("originalPresentationTime_",a.b);y("originalLiveEdge_",a.f);y("seekStartTime_",a.a);b=a.b+(Na()/1E3-a.g);a.f>b&&t("The live-edge ("+a.f+")","should not be greater than","the current presentation time ("+b+")")}}
T.prototype.qa=function(a){var b=R.prototype.qa.call(this,a),c=Math.min.apply(null,this.o.filter(function(a){return null!=a.a}).map(function(a){return a.a-a.startTime}));Math.abs(b)>c&&v("Timestamp correction ("+a+")","is unreasonably large for live content.","The content may have errors in it.");null!=this.b&&(q(null!=this.f),q(null!=this.a),this.f+=b,this.a+=b,this.b+=b,q(this.f<=this.b));return b};T.prototype.Ka=function(){return ke(this,Na()/1E3)};
function ke(a,b){ie(a,b);if(null==a.b||null==a.f||null==a.a)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.i&&(c=a.i);var d=b-a.g,e=a.b+d;null!=a.h.f&&(e-=a.a,q(0<=e),e-=a.h.f,0<e&&(a.a+=e));a.a=Math.min(a.a,c);0<a.length()&&q(a.a>=S(a).startTime,"The seek start time ("+a.a+")should not be less thanthe first segment's start time ("+S(a).startTime+")");d=a.f+d;if(d<a.a)return{start:a.a,end:a.a};d=0<a.length()?null!=a.F().a?Math.min(d,a.F().a):d:a.a;a.a>d&&x("The seek start time ("+a.a+")",
"has surpassed the target seek end time ("+d+")");d=Math.max(d,a.a);d=Math.min(d,c);return{start:a.a,end:d}}function ie(a,b){je(a);if(null!=a.h.f)if(null==a.b)q(0==a.length());else{for(var c=a.b+(b-a.g),d=0,e=0;e<a.o.length;++e){var f=null;e<a.o.length-1?f=a.o[e+1].a:(f=a.o[e],f=null!=f.a?f.a+(f.a-f.startTime):null);if(null!=f&&f<c-a.h.f)++d;else break}0<d&&(a.o.splice(0,d),x("Evicted",d,"SegmentReference(s),",a.o.length,"SegmentReference(s) remain."))}}
function je(a){if(a.i){for(var b=0,c=a.o.length-1;0<=c;--c)if(a.o[c].startTime>a.i)++b;else break;0<b&&(a.o.splice(-b),v("Segments found after stream end, evicted",b,"SegmentReference(s),",a.o.length,"SegmentReference(s) remain."))}};function le(a,b,c,d,e){q(null!=a.b);q(null!=b.start);q(c.m);q(c.m.a);q(0<c.m.u);var f=1,g=0,k;q(null!=b.start);q(c.m);q(c.m.a);q(0<c.m.u);if(a.b>d)v("The stream is not available yet!",b),k=null;else{var l=a.i||0,n=a.f||0;k=c.m;k=k.a/k.u;var r=d-(a.b+b.start);0>r?(v("The Period is not available yet!",b),k=null):(n=r-2*k-n,0>n&&(n=0),n=Math.ceil(n/k)*k,r-=k,0>r?(v("The first segment is not available yet!",b),k=null):(l=Math.floor(r/k)*k-l,0>l&&(v("The first segment may not be available yet."),l=0),
l=Math.floor(l/k)*k,l>=n?y("The best available segment is still available!"):(l=n,y("The best available segment is no longer available.")),n=n/k+1,q(n==Math.round(n),"earliestSegmentNumber should be an integer."),k=l/k+1,q(k==Math.round(k),"currentSegmentNumber should be an integer."),y("earliestSegmentNumber",n),y("currentSegmentNumber",k),k={eb:n,current:k}))}k&&(f=k.eb,g=k.current-k.eb+1);f=Xd(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;q(0==f.length||
null!=f[f.length-1].a);T.call(this,f,a,b,d);this.K=c;this.c=0<this.length()?a.b+b.start+this.F().a:null;q(this.c<=d);this.j=this.c;this.s=k?k.current+1:null;this.C=e}p(le,T);le.prototype.destroy=function(){this.C=this.K=null;T.prototype.destroy.call(this)};le.prototype.ra=function(a){var b=Na()/1E3;me(this,b);ie(this,b);return R.prototype.ra.call(this,a)};
le.prototype.Na=function(a){if(null!=this.c)return x("Ignoring SegmentIndex integration.",this),!1;if(!(a instanceof le))return v("Cannot integrate SegmentIndex:","Only a DynamicLiveSegmentIndex can be integrated into","another DynamicLiveSegmentIndex.",this),!1;if(null==a.c)return!1;this.c=a.c;this.j=a.j;this.s=a.s;this.g=a.g;this.i=a.i;ge(this,a);me(this,Na()/1E3);he(this);return!0};le.prototype.qa=function(a){a=T.prototype.qa.call(this,a);null!=this.c&&(q(null!=this.j),this.c+=a,this.j+=a);return a};
le.prototype.Ka=function(){var a=Na()/1E3;me(this,a);return ke(this,a)};function me(a,b){if(null!=a.c&&null!=a.j&&null!=a.s){var c=a.j+(b-a.g)-a.c;q(0<=c);var d=a.K.m,d=d.a/d.u,c=Math.floor(c/d);if(0!=c){var e=Xd(a.C,a.K,a.s,c);q(e);Array.prototype.push.apply(a.o,de(e,a.l));ee(a.o);a.c+=c*d;a.s+=c;x("Generated",c,"SegmentReference(s).")}}};function ne(a,b,c,d,e){q(null!=b.start);q("dynamic"==a.type||null!=b.a);q(c.m);q(0<c.m.u);q(c.m.a);this.c=a;this.b=b;this.f=c;this.h=d;this.a=null;this.g=e}ne.prototype.destroy=function(){this.g=this.f=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
ne.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.c.type)try{this.a=new le(this.c,this.b,this.f,this.h,this.g)}catch(a){return Promise.reject(a)}else{q("static"==this.c.type);var b;b=this.f.m;if(b=Xd(this.g,this.f,1,Math.ceil(this.b.a/(b.a/b.u)))){if(0<b.length){var c=b[b.length-1];q(c.startTime<=this.b.a);q(c.a>=this.b.a);b[b.length-1]=ce(c,c.startTime,this.b.a)}b=new R(b)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),
b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function oe(a,b,c,d,e){q(c.a);var f=c.a.B;q(c.a.b||1==c.a.a.length||null!=f&&0<f.V.length);q(0<c.a.u);this.c=a;this.b=b;this.g=c;this.a=null;this.h=d;this.f=e}oe.prototype.destroy=function(){this.f=this.g=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
oe.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.g.a,b=[];a.B&&(b=ae(a.B,a.u||1,this.b.a||0));var c=0;a.b&&a.f?c=a.b*a.f:0<b.length&&(c=b[0].start-(a.D||0));var d=a.a.length;0<b.length&&b.length!=a.a.length&&(d=Math.min(b.length,a.a.length),v("The length of the segment timeline and segment","urls does not match, truncating",a.a.length,"to",d));for(var e=[],f=0;f<d;++f){var g=a.a[f];q(0<=c);var k=c/a.u,l=null,n=null;a.b?(l=c+a.b,n=l/a.u):0<b.length?(l=b[f].end-(a.D||
0),n=l/a.u):(q(1==a.a.length),q(this.b.a),n=k+this.b.a,l=n*a.u);var c=l,l=0,r=null;g.a&&(l=g.a.ma,r=g.a.end);e.push(new Zd(k,n,new L(this.f,g.b,l,r)))}"dynamic"==this.c.type?this.a=new T(e,this.c,this.b,this.h):(q("static"==this.c.type),this.a=new R(e));return Promise.resolve(this.a)};function pe(a,b,c,d,e){q(null!=b.start);q(c.m);q(c.m.c);q(0<c.m.u);q(c.m.B);this.b=a;this.c=b;this.f=c;this.h=d;this.a=null;this.g=e}pe.prototype.destroy=function(){this.g=this.f=this.c=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
pe.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=this.f.m,b=ae(a.B,a.u||1,this.c.a||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=e/a.u,g=b[d].end/a.u,e=Yd(this.g,this.f,d+a.g,e);if(!e)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var k=(a.D||0)/a.u;c.push(new Zd(f-k,g-k,e))}"dynamic"==this.b.type?this.a=new T(c,this.b,this.c,this.h):(q("static"==this.b.type),this.a=new R(c));return Promise.resolve(this.a)};function qe(a){this.b=a;this.a=null}qe.prototype.destroy=function(){this.b=null;this.a&&(this.a.destroy(),this.a=null)};qe.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=[],b=0;b<this.b.length;++b){var c=this.b[b];a.push(new Zd(c.start_time,c.end_time,new L(null,[new M(c.url)],c.start_byte,null)))}this.b=null;this.a=new R(a);return Promise.resolve(this.a)};function re(){this.G=Ce++;this.id=this.N=this.O=null;this.f=0;this.height=this.width=this.bandwidth=null;this.c=this.a="";this.g=[];this.$=!1;this.b=!0}var Ce=0;re.prototype.destroy=function(){this.O&&(this.O.destroy(),this.O=null);this.N&&(this.N.destroy(),this.N=null)};function De(a){return a.$&&a.b}function Ee(a){var b=a.a||"";a.c&&(b+='; codecs="'+a.c+'"');return b}function Fe(){this.G=Ge++;this.id=null;this.contentType=this.lang="";this.b=!1;this.v=[];this.a=[]}var Ge=0;
Fe.prototype.destroy=function(){for(var a=0;a<this.v.length;++a)this.v[a].destroy();this.a=this.v=null};function He(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Ie;d.id=a.G;d.a=a.a[c];d.contentType=a.contentType;d.b=a.v.length?Ee(a.v[0]):"";b.push(d)}return b}function Je(){this.id=null;this.start=0;this.b=null;this.a=[]}Je.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Ke(){this.b=!1;this.h=this.g=this.f=null;this.c=0;this.a=[]}
Ke.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Ie(){this.id=0;this.a=null;this.b=this.contentType=""};function Le(a,b,c,d,e){H.call(this,a);this.l=b;this.a=new Sb(c,d,e);this.C=this.I=this.i=null;this.S=!1;this.b=null;this.f=!1;this.w=null;this.h=!1;this.s=new I;this.j=this.c=!1;this.L=0;this.W=15;this.g=this.M=!1;this.R=d.split(";")[0];q(0<this.R.length)}p(Le,H);
Le.prototype.P=function(a){null!=a.initialStreamBufferSize&&(this.L=Number(a.initialStreamBufferSize));null!=a.streamBufferSize&&(this.W=Number(a.streamBufferSize));if(null!=a.segmentRequestTimeout){var b=this.a;a=Number(a.segmentRequestTimeout);q(!isNaN(a));b.w=a}};Le.prototype.destroy=function(){Me(this);this.s.destroy();this.i=this.s=null;this.a.destroy();this.K=this.l=this.a=null};h=Le.prototype;h.ua=function(){return this.i};h.ib=function(){return this.I};
h.wb=function(a){this.c||a.then(function(){q(this.h);q(!this.c);q(!this.j);x(U(this),"proceeding...");this.c=!0;this.b||Ne(this,0)}.bind(this)).catch(function(a){q("destroy"==a.type)});return this.s};h.Ma=function(){return this.j};
h.xa=function(a,b,c){q(a.a==this.R,"The stream's type must match the Stream's SourceBuffer's type.");if(a==this.i)x(U(this),"already using stream",a);else{var d=[a.O.create(),a.N.create()];Promise.all(d).then(J(this,function(d){if(this.l){var f=this.i;this.i=a;this.I=d[0];this.C=d[1];this.S=!0;this.f||(f?b?Oe(this,!0,c):q(null!=this.b||this.g):Ne(this,0))}})).catch(J(this,function(a){"aborted"!=a.type&&(this.c?(a=D(a),this.dispatchEvent(a)):this.s.reject(a))}))}};
h.ob=function(){x(U(this),"resync");return Oe(this,!1)};
function Oe(a,b,c){a.i&&!a.f&&(q(null!=a.b||a.g||a.h&&!a.c,"Unexpected call to resync_()."),q(!c||0<c),a.f=!0,Me(a),Ub(a.a).then(J(a,function(){y(U(this),"abort done.");q(null==this.b&&this.f);q(!this.g);var a=this.l.currentTime;if(!b&&0<Vb(this.a,a)&&0<=$b(this.a.b,a))return x(U(this),"no clear required."),Promise.resolve();x(U(this),"clear required.");if(c)return cc(this.a,this.l.currentTime+c);x(U(this),"nudge needed!");this.M=!0;return bc(this.a)})).then(J(a,function(){q(null==this.b&&this.f);
q(!this.g);this.f=!1;Ne(this,0)})).catch(J(a,function(a){q("aborted"!=a.type);this.f=!1;this.c?(a=D(a),this.dispatchEvent(a)):this.s.reject(a)})))}h.pb=function(a){return 0<Vb(this.a,a)&&0<=$b(this.a.b,a)};h.Ea=function(){};h.Ja=function(){return!0};
h.Tb=function(){da(U(this),"onUpdate_");q(this.i);q(this.I);q(null!=this.b&&!this.f);q(!this.g);if(this.h&&!this.c)y(U(this),"waiting to proceed..."),this.b=null;else if(this.c&&!this.j&&fc(this.a))Oe(this,!0);else{this.b=null;var a=this.i,b=this.I,c=this.l.currentTime;Vb(this.a,this.h?c:c+(this.w||0))>=(this.h?Math.max(this.L,this.W):this.L)?(y(U(this),"buffering goal reached."),Pe(this),Ne(this,1E3/(Math.abs(this.l.playbackRate)||1))):(b=Qe(this,c,b))?(this.g=!0,this.C&&y(U(this),"appending initialization data..."),
y(U(this),"fetching segment",b),b=Wb(this.a,b,a.f,this.C),this.C=null,this.S&&(this.S=!1,Re(this,a)),this.j=!1,b.then(J(this,function(a){y(U(this),"fetch done.");q(null==this.b&&!this.f);q(this.g);this.g=!1;null==this.w&&(q(!this.h),q(null!=a),this.w=a);this.M&&0<Vb(this.a,c)&&(x(U(this),"applying nudge..."),this.M=!1,this.l.currentTime+=.001);Ne(this,0)})).catch(J(this,function(a){this.g=!1;if("aborted"==a.type)y(U(this),"fetch aborted."),q(!this.a||this.f);else{var b=[0,404,410];"net"==a.type&&
-1!=b.indexOf(a.gc.status)&&this.i&&(w(U(this),"retrying segment request in 5 seconds..."),Ne(this,5E3));a=D(a);this.dispatchEvent(a)}}))):(y(U(this),"new segment is not needed or is not available."),Pe(this),this.c&&!this.j&&(q(this.h),x(U(this),"stream has ended."),this.j=!0,Se(this)),Ne(this,1E3))}};function Qe(a,b,c){a=a.a;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.a?c.ra(a.a):null:c.ra(b)||(c.length()?c.F():null)}
function Pe(a){if(!a.h&&null!=a.w){q(!a.c);q(!a.j);w(U(a),"stream has started.");a.h=!0;var b=a.a,c=a.w,d=c-b.K;0!=d&&(b.b=de(b.b,d),b.K=c,x(K(b),"applied timestamp correction of",c,"seconds to SourceBufferManager",b));a.s.resolve(a.w)}}function Re(a,b){var c;c=b.a.split("/")[0];c=C({type:"adaptation",bubbles:!0,contentType:c,size:"video"!=c?null:{width:b.width,height:b.height},bandwidth:b.bandwidth});a.dispatchEvent(c)}function Se(a){q(a.j);var b=C({type:"ended"});a.dispatchEvent(b)}
function Ne(a,b){q(null==a.b);a.b=window.setTimeout(a.Tb.bind(a),b)}function Me(a){null!=a.b&&(window.clearTimeout(a.b),a.b=null)}function U(a){return"Stream "+a.R+":"};function Te(a){this.b=a;this.a=null}Te.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};Te.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new Zd(0,null,this.b);this.a=new R([a]);return Promise.resolve(this.a)};function Ue(a,b){H.call(this,a);this.b=b;this.g=!0;this.h=this.f=null;this.c=new I;this.a=null}p(Ue,H);Ue.prototype.P=function(){};Ue.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.c.destroy();this.K=this.b=this.f=this.h=this.a=this.c=null};h=Ue.prototype;h.ua=function(){return this.f};h.ib=function(){return this.h};h.wb=function(){return this.c};h.Ma=function(){return!0};
h.xa=function(a){w("Switching stream to",a);a.O.create().then(J(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.f;this.f=a;this.h=b;b=S(b).url.a[0].toString();var d=this.Ja();this.a&&(this.Ea(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.Ea(d);b=C({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.c.resolve(0)}}))};
h.ob=function(){};h.pb=function(){return!0};h.Ea=function(a){this.g=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};h.Ja=function(){this.a&&(this.g="showing"==this.a.track.mode);return this.g};function Ve(){}
Ve.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new Xa(b);if(440786851!=Za(g).id)t("EBML element does not exist."),f=null;else{var k=Za(g);if(408125543!=k.id)t("Segment element does not exist."),f=null;else{var l=k.a.byteOffset,n;var r=new Xa(k.a);for(b=null;Ra(r.a);){var u=Za(r);if(357149030==u.id){b=u;break}}if(b){for(var F=new Xa(b.a),r=1E6;Ra(F.a);){var z=Za(F);if(2807729==z.id){r=cb(z);break}}n=r/1E9}else t("Info element does not exist."),n=null;f=n?{Zb:l,dc:n}:null}}if(f){var B=
Za(new Xa(a));if(475249515!=B.id)t("CuesElement does not exist."),e=null;else{var Da=f.Zb,ec=f.dc;a=[];var se=new Xa(B.a);for(f=B=-1;Ra(se.a);){var te=Za(se);if(187==te.id){var Va;var ue=new Xa(te.a),ve=Za(ue);if(179!=ve.id)v("CueTime element does not exist."),Va=null;else{var Of=cb(ve),we=Za(ue);if(183!=we.id)v("CueTrackPositions element does not exist."),Va=null;else{for(var xe=new Xa(we.a),l=0;Ra(xe.a);){var ye=Za(xe);if(241==ye.id){l=cb(ye);break}}Va={fc:Of,Yb:l}}}if(Va){var ze=ec*Va.fc,Ae=Da+
Va.Yb;if(0<=B){q(0<=f);var fd=new L(d,c,f,Ae-1);a.push(new Zd(B,ze,fd))}B=ze;f=Ae}}}0<=B&&(q(0<=f),fd=new L(d,c,f,null),a.push(new Zd(B,null,fd)));e=a}}else e=null}catch(Be){if(!(Be instanceof RangeError))throw Be;}return e};function We(a,b,c,d,e,f,g){q("webm"!=c||e);this.f=a;this.i=b;this.g=c;this.a=d;this.c=e;this.j=f;this.b=null;this.h=g}We.prototype.destroy=function(){this.h=this.i=this.f=null;this.a.g();this.a=null;this.c&&(this.c.g(),this.c=null);this.b=null};
We.prototype.create=function(){if(this.b)return this.b;var a=[Zb(this.a)];"webm"==this.g&&a.push(Zb(this.c));return this.b=Promise.all(a).then(J(this,function(a){var c=a[0];a=a[1]||null;var d=null;"mp4"==this.g?(d=new fe,d=d.parse(new DataView(c),this.a.f,this.a.a,this.h)):"webm"==this.g?(q(a),d=new Ve,d=d.parse(new DataView(c),new DataView(a),this.a.a,this.h)):ca();if(!d)return c=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);
"dynamic"==this.f.type?c=new T(d,this.f,this.i,this.j):(q("static"==this.f.type),c=new R(d));return Promise.resolve(c)}))};function Xe(a){this.a=a}
function Ye(a,b,c){for(var d=Na()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.J.length;++g){var k=f.J[g];if("text"!=k.contentType)for(var l=0;l<k.H.length;++l){var n=k.H[l],r=0,r=r+(n.b?1:0),r=r+(n.a?1:0),r=r+(n.m?1:0);0==r?(v("Representation does not contain any segment information:","the Representation must contain one of SegmentBase,","SegmentList, or SegmentTemplate.",n),k.H.splice(l,1),--l):1!=r&&(v("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,",
"SegmentList, or SegmentTemplate.",n),n.b?(w("Using SegmentBase by default."),n.a=null,n.m=null):n.a?(w("Using SegmentList by default."),n.m=null):ca())}}Ze(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.J.length;++g){l=k=f.J[g];n=null;for(r=0;r<l.H.length;++r){var u=l.H[r].f||"";n?u!=n&&(v("Representation does not have the same MIME type as other","Representations within its AdaptationSet.",l.H[r]),l.H.splice(r,1),--r):n=u}0==k.H.length&&(f.J.splice(g,1),--g)}"dynamic"==b.type&&null==b.b&&(v("The MPD is 'dynamic' but @availabilityStartTime is not specified:",
"treating @availabilityStartTime as if it were the current time."),b.b=d);e=new Ke;"dynamic"==b.type&&(e.b=!0,e.f=b.g,e.g=new L(c,b.j||b.url),e.h=b.b);e.c=b.h||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start){v("Skipping Period",f+1,"and any subsequent Periods:","Period",f+1,"does not have a valid start time.",g);break}g=$e(a,b,g,d,c);e.a.push(g)}return e}
function Ze(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.c=null);b(a.c)&&1==a.a.length&&!b(a.a[0].a)&&(a.a[0].a=a.c);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],k=a.a[e+1]||{start:a.c};!b(g.start)&&f&&b(f.start)&&b(f.a)&&(g.start=f.start+f.a);!b(g.a)&&b(k.start)&&(g.a=k.start-g.start);null!=g.start&&null!=g.a?c+=g.a:d=!1}b(a.c)?a.c!=c&&v("@mediaPresentationDuration does not match the total duration of all","Periods."):
(e=a.a[a.a.length-1],d?(q(b(e.start)&&b(e.a)),q(c==e.start+e.a),a.c=c):b(e.start)&&b(e.a)?(v("Some Periods may not have valid start times or durations."),a.c=e.start+e.a):"dynamic"!=a.type&&(v("Some Periods may not have valid start times or durations;","@mediaPresentationDuration may not include the duration of all","periods."),a.c=c))}}
function $e(a,b,c,d,e){q(null!=c.start);var f=new Je;f.id=c.id;f.start=c.start;f.b=c.a;var g=new E;c.J.forEach(function(a){g.push(a.contentType||"",a)});for(var k=tb(g),l=0;l<k.length;++l){var n=new E;g.get(k[l]).forEach(function(a){n.push(a.group,a)});for(var r=tb(n),u=0;u<r.length;++u){var F=r[u];q(null!=F);var z=new E;n.get(F).forEach(function(a){z.push(a.lang,a)});for(var F=tb(z),B=0;B<F.length;++B){var Da=z.get(F[B]),Da=af(a,b,c,Da,d,e);f.a.push(Da)}}}return f}
function af(a,b,c,d,e,f){q(0<d.length);q(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new Fe,k=d.filter(function(a){return null!=a.id});k.length==d.length&&(g.id=k.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.b=d.some(function(a){return a.b});for(var k={},l=0;l<d.length;++l)for(var n=d[l],r=0;r<n.H.length;++r){var u=n.H[r],
F=bf(a,u),z=g.a.slice(0);cf(F,z);if(0==z.length&&0<g.a.length)v("Representation does not contain any ContentProtection elements","that are compatible with other Representations within its","AdaptationSet or AdaptationSet group.",u);else if(u=df(b,c,u,e,f))g.v.push(u),g.a=z,k[u.G]=n}if(g.a.some(function(a){return""==a.a}))return g.v.forEach(function(a){a.$=!0}),g;a=ef(d);for(l=0;l<g.v.length;++l)u=g.v[l],n=k[u.G],n==a&&(y("Assuming the key system can decrypt stream",u.id+"."),u.$=!0);return g}
function ef(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.H.length;++f){var g=e.H[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}function cf(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e)if(mc(b[c],a[e])){d=!0;break}d||(b.splice(c,1),--c)}}
function bf(a,b){var c=[];if(0==b.c.length)c.push(new kc);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,ff(a,b.c[d]));return c}
function ff(a,b){var c=[];if(2!=a.a.length)return t("You must use the new-style ContentProtection interpretation API.","See shaka.player.DashVideoSource.ContentProtectionCallback."),[];var d=a.a(b.c||"",b.f);if(!d)return[];if(!(d instanceof Array))return t("ContentProtection interpretation callback must return","an array of shaka.player.DrmInfo.Config objects."),[];for(var e=0;e<d.length;++e){var f=lc(d[e]);0==f.b.length&&b.a&&b.a.psshBox&&nc(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function df(a,b,c,d,e){if(!c.A||0===c.A.length)return v("Representation does not contain sufficient segment information:","the Representation must contain a BaseURL.",c),null;var f=null,g=1,k=0;if(c.b)q(c.b),q(0<c.b.u),f=c.f.split("/")[1],"mp4"!=f&&"webm"!=f?(v("SegmentBase specifies an unsupported container type.",c),f=null):(g=c.b,"webm"!=f||g.c?g.a||g.b&&g.b.a?(k=g.b,k||(k=new td,k.url=c.A,k.a=g.a?g.a.clone():null),k=gf(k,e),g=g.c?gf(g.c,e):null,a=new We(a,b,f,k,g,d,e),b=new be(g),d=new re,d.O=
a,d.N=b,f=d):(v("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",g),f=null):(v("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",g),f=null)),g=c.b.u,k=c.b.D;else if(c.a)q(c.a),f=c.a,!f.b&&!f.B&&1<f.a.length?(v("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,",
"but does not specify a segment duration or timeline.",f),f=null):f.b||b.a||f.B||1!=f.a.length?f.B&&0===f.B.V.length?(v("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",f),f=null):(f=f.c?gf(f.c,e):null,a=new oe(a,b,c,d,e),b=new be(f),d=new re,d.O=a,d.N=b,f=d):(v("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",f),f=
null),g=c.a.u,k=c.a.D;else if(c.m){a:if(q(c.m),f=c.m,g=0+(f.b?1:0),g+=f.B?1:0,g+=f.a?1:0,0==g?(v("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",f),g=!1):(1!=g&&(v("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",f),f.b?(w("Using the index URL template by default."),
f.B=null,f.a=null):f.B?(w("Using the SegmentTimeline by default."),f.a=null):ca()),g=!0),g){g=null;if(f.f&&(q(c.m),g=(f=c.m.f)?hf(c,f,ud):null,!g)){f=null;break a}f=g?gf(g,e):null;q(c.m);g=c.m;g.b?(q(c.m),q(c.m.b),g=c.f.split("/")[1],"mp4"!=g&&"webm"!=g?(v("SegmentTemplate specifies an unsupported container type.",c),a=null):(k=c.m,"webm"!=g||f?Yd(e,c,1,0)?(q(c.m),(k=(k=c.m.b)?hf(c,k,td):null)?(k=gf(k,e),a=new We(a,b,g,k,f,d,e)):a=null):a=null:(v("SegmentTemplate does not contain sufficient segment information:",
"the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",k),a=null))):g.c?g.B?a=new pe(a,b,c,d,e):g.a?"dynamic"!=a.type&&null==b.a?(v("SegmentTemplate does not contain sufficient segment information:","the Period's duration is not known.",c),a=null):a=new ne(a,b,c,d,e):(ca(),a=null):(v("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",c),a=null);a?(b=new be(f),d=new re,d.O=a,d.N=b,f=
d):f=null}else f=null;g=c.m.u;k=c.m.D}else"text"==c.f.split("/")[0]?(f=new re,f.O=new Te(new L(e,c.A))):ca();if(!f)return null;f.id=c.id;k&&(f.f=-1*k/g);f.bandwidth=c.bandwidth;f.width=c.width;f.height=c.height;f.a=c.f||"";f.c=c.g||"";for(a=0;a<c.c.length;++a)b=c.c[a],b.b&&f.g.push(b.b);return f}function hf(a,b,c){q(a.m);b=$d(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=Ud(a.A,b);return c}function gf(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.ma,e=a.a.end);return new L(b,c,d,e)};function jf(){this.streamStats=null;this.droppedFrames=this.decodedFrames=NaN;this.bufferingTime=this.playTime=this.estimatedBandwidth=0;this.playbackLatency=NaN;this.bufferingHistory=[];this.bandwidthHistory=[];this.streamHistory=[]}function kf(a,b){var c=new lf(b);a.streamHistory.push(new mf(c));if(c.videoHeight||!a.streamStats)a.streamStats=c}function lf(a){this.videoWidth=a.width;this.videoHeight=a.height;this.videoMimeType=a.a;this.videoBandwidth=a.bandwidth}
function mf(a){this.timestamp=Na()/1E3;this.value=a};function nf(a,b){Eb.call(this,"readwrite",b);this.j=a;this.b=0}p(nf,Eb);function of(a,b){q(!isNaN(b));a.b=b}
function pf(a,b,c,d,e){for(var f=[],g=[],k=0,l=0,n=[],r=b.map(function(a){return a.O.create()}),r=Promise.all(r),u=b.map(function(a){return a.N.create()}),u=Promise.all(u),r=Promise.all([r,u]).then(function(a){f=a[0];g=a[1];k=f.reduce(function(a,b){return a+b.length()},0)}),u=0;u<b.length;++u)r=r.then(function(a){return qf(this,b[a],f[a],g[a],k,l)}.bind(a,u)),r=r.then(function(a,b){l+=f[a].length();n.push(b)}.bind(a,u));return r.then(J(a,function(){return rf(Lb(this))})).then(J(a,function(a){var b=
new I;c=Ma(c);var f={group_id:a,stream_ids:n,session_ids:c,duration:d,key_system:e.a,license_server:e.j,with_credentials:e.l,distinctive_identifier:e.g,audio_robustness:e.f,video_robustness:e.s},g=Lb(this).put(f);g.onsuccess=function(){b.resolve(a)};g.onerror=function(){b.reject(g.error)};return b}))}function sf(a,b){return Mb(Lb(a),b).then(J(a,function(a){var d=[],e;for(e in a.stream_ids)d.push(tf(this,a.stream_ids[e]));a=Lb(this);d.push(a.delete(b));return Promise.all(d)}))}
function qf(a,b,c,d,e,f){var g=[rf(Kb(a)),rf(Ib(a).index("stream"))],g=Promise.all(g).then(J(a,function(a){return{wa:Math.max(a[0],a[1]),pa:new ArrayBuffer(0),Qa:0,o:[],Ia:null,ec:e,nb:f}})),g=g.then(a.f.bind(a,c));return g=g.then(a.g.bind(a,b,d))}function rf(a){var b=new I,c=a.openCursor(null,"prev");c.onsuccess=function(a){a.target.result?b.resolve(a.target.result.key+1):b.resolve(0)};c.onerror=function(){b.reject(c.error)};return b}
nf.prototype.g=function(a,b,c){var d=new I;a={stream_id:c.wa,mime_type:a.a,codecs:a.c,init_segment:b,references:c.o};var e=Kb(this).put(a);e.onsuccess=function(){d.resolve(c.wa)};e.onerror=function(){d.reject(e.error)};return d};nf.prototype.f=function(a,b){for(var c=Promise.resolve(),d=0;d<a.length();++d)var e=a.get(d),f=d==a.length()-1,f=this.c.bind(this,e,b,f),c=c.then(this.i.bind(this,e)),c=c.then(f);return c.then(function(){return Promise.resolve(b)}).catch(J(this,function(a){tf(this,b.wa);return Promise.reject(a)}))};
nf.prototype.c=function(a,b,c,d){var e=new I;0==b.pa.byteLength&&(b.Ia=a);b.pa=uf(b.pa,d);b.nb++;var f=C({type:"progress",detail:b.nb/b.ec*100,bubbles:!0});if(1048576<=b.pa.byteLength||c){c={stream_id:b.wa,segment_id:b.Qa,content:b.pa};var g=Ib(this).put(c);b.o.push({start_time:b.Ia.startTime,start_byte:b.Ia.url.f,end_time:a.a,url:"idb://"+b.wa+"/"+b.Qa});b.Qa++;b.pa=new ArrayBuffer(0);g.onerror=function(){e.reject(g.error)};g.onsuccess=J(this,function(){this.dispatchEvent(f);e.resolve()})}else this.dispatchEvent(f),
e.resolve();return e};function uf(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);c.set(new Uint8Array(a),0);c.set(new Uint8Array(b),a.byteLength);return c.buffer}nf.prototype.i=function(a){var b=new Yb;b.c=1E3*this.b;return Zb(a.url,b,this.j)};
function tf(a,b){var c=new I,d=Kb(a).delete(b);d.onerror=function(){c.reject(d.error)};var e=Ib(a);e.index("stream").openKeyCursor(IDBKeyRange.only(b)).onsuccess=function(a){if(a=a.target.result)e.delete(a.primaryKey),a.continue()};e.transaction.oncomplete=function(){c.resolve()};return c};function vf(a,b,c,d,e,f){q("GET"==c||"POST"==c);this.b=new L(null,[new M(a)]);this.a=new Yb;this.a.body=b;this.a.method=c;this.a.a=3;this.a.j=d;this.a.c=1E3*(null!=f?f:0);a=e||{};for(var g in a)this.a.b[g]=a[g]}function wf(a){return Zb(a.b,a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function xf(a,b,c){H.call(this,a);this.c=b;this.b=c;this.a=this.g=null;this.l=new ub;this.i=[];this.h=[];this.s=0;this.f=new I;this.j=null;this.w=0}p(xf,H);xf.prototype.destroy=function(){this.K=null;for(var a=0;a<this.h.length;++a)this.h[a].close().catch(function(){});this.h=[];this.i=this.a=this.g=null;this.f.destroy();this.f=null;this.l.destroy();this.l=null;this.j&&(window.clearTimeout(this.j),this.j=null);this.c=this.b=null};
xf.prototype.initialize=function(){q(null==this.g);q(null==this.c.mediaKeys);q(null==this.a);for(var a=new E,b=this.b.hb(),c=0;c<b.length;++c){var d=b[c];q(null!=d.a);d.a.a||d.b&&!yf(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];q(null!=f.a);if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,k=c[g];k||(k=f.a,k={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:k.g?"required":"optional",persistentState:k.w||this.b.na()?
"required":"optional",sessionTypes:[this.b.na()?"persistent-license":"temporary"]},c[g]=k);if(f.b&&(g=f.contentType+"Capabilities",g in k)){d=!0;k[g]||(k[g]=[]);var l;"audio"==f.contentType?l=f.a.f:"video"==f.contentType&&(l=f.a.s);k[g].push({contentType:f.b,robustness:l});w("MKSC",k)}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return this.b.Ra(a),this.f.resolve(),Promise.resolve();l=new I;c=zf(this,c,l);c=c.then(this.zb.bind(this,
b,a));c=c.then(this.$b.bind(this));l.reject(null);return c};function Af(a,b){null==a.j&&(a.j=window.setTimeout(function(){var a=Error("Timeout waiting for sessions.");a.type="storage";this.f.reject(a)}.bind(a),b));return a.f}function Bf(a){return Promise.all(a.h.map(function(a){x("Removing session",a);return a.remove()}))}
function zf(a,b,c){for(var d in b)c=c.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,d,b[d]));a.b.na()&&(c=c.catch(function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.");}));return c}h=xf.prototype;
h.zb=function(a,b,c){if(!this.c)return Cf();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var k=f[g];if(!b.a.hasOwnProperty(k)){var l=e[k+"Capabilities"];if(l&&l.length){for(var l=l[0],n=[],r={},u=0;u<a.length;++u){var F=a[u];if(F.a.a==d&&F.b==l.contentType&&!(F.id in r)){n.push(F);r[F.id]=!0;var z;if(this.a){z=this.a;F=F.a;mc(z,F)||v("combine() should only be called with a compatible DrmInfo object:","this",z,"other",F);var B=new kc;B.a=z.a;B.j=z.j;B.l=z.l;
B.h=z.h;B.i=z.i;B.g=z.g;B.w=z.w;B.f=z.f;B.s=z.s;B.c=z.c?new Uint8Array(z.c.buffer):null;nc(B,z.b);nc(B,F.b);z=B}else z=F.a;this.a=z}}q(n.length);b.set(k,n)}}}this.b.Ra(b);return c.createMediaKeys()};
h.$b=function(a){if(!this.c)return Cf();this.g=a;return this.c.setMediaKeys(this.g).then(J(this,function(){return this.c?this.a.c?this.g.setServerCertificate(this.a.c):Promise.resolve():Cf()})).then(J(this,function(){if(!this.c)return Cf();q(this.c.mediaKeys);q(this.c.mediaKeys==this.g);if(0<this.b.Da().length)Df(this);else{q(this.a);for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.jb({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&G(this.l,this.c,
"encrypted",this.jb.bind(this))}}))};function Cf(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
h.jb=function(a){q(a.initData);var b=new Uint8Array(a.initData);w("onEncrypted_",b,a);for(var c=0;c<this.i.length;++c)if(ab(b,this.i[c])){x("License request already generated!");return}try{var d=Ef(this)}catch(e){d=D(e);this.dispatchEvent(d);this.f.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.i.push(b);a.catch(J(this,function(a){if(this.c){for(var c=0;c<this.i.length;++c)if(ab(b,this.i[c])){this.i.splice(c,1);break}c=D(a);this.dispatchEvent(c);this.f.reject(a)}}));this.h.push(d)};
function Df(a){var b=a.b.Da();q(0<b.length);for(var c=0;c<b.length;++c){var d=Ef(a),e=d.load(b[c]);a.h.push(d);e.then(J(a,function(){this.s++;this.s>=this.h.length&&this.f.resolve()})).catch(J(a,function(a){a=D(a);this.dispatchEvent(a)}))}}
function Ef(a){var b=null;if(a.b.na())try{b=a.g.createSession("persistent-license")}catch(c){throw Error("Persistent licenses are not supported by this key system or platform.");}else b=a.g.createSession();G(a.l,b,"message",a.Pb.bind(a));G(a.l,b,"keystatuseschange",a.Eb.bind(a));return b}h.Pb=function(a){w("onSessionMessage_",a);q(this.a);Ff(this,a.target,this.a,a.message)};
h.Eb=function(a){x("onKeyStatusesChange_",a);a=a.target.keyStatuses;for(var b={},c=a.keys(),d=c.next();!d.done;d=c.next()){var e=jc(new Uint8Array(d.value)),d=a.get(d.value);q(null!=d);b[e]=d}this.b.kb(b)};
function Ff(a,b,c,d){x("requestLicense_",b,c,d);d=Gf(c,d);wf(new vf(d.url,d.body,d.method,c.l,d.headers,a.w)).then(J(a,function(a){w("onLicenseSuccess_",b);c.h&&(a=c.h(a));return b.update(a)})).then(J(a,function(){w("onSessionReady_",b);var a=C({type:"sessionReady",detail:b});this.dispatchEvent(a);this.s++;this.s>=this.h.length&&this.f.resolve()})).catch(J(a,function(a){a.nc=b;a=D(a);this.dispatchEvent(a)}))}
function Gf(a,b){var c={url:a.j,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.i)return c;a.i(c);c.url=pb(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"==typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=pb(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=qb(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c}function Hf(a,b){q(!isNaN(b));a.w=b};function V(a){H.call(this,null);this.a=a;this.b=null;this.f=new ub;this.j=this.i=null;this.I=0;this.w=null;this.h=!1;this.g=new jf;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new la};this.l=1;this.L=null}p(V,H);m("shaka.player.Player",V);V.version="v1.3.0-324-ga6337cb";
V.isBrowserSupported=function(){return!!window.MediaSource&&!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration&&!!window.Promise&&!!Element.prototype.requestFullscreen&&!!document.exitFullscreen&&"fullscreenElement"in document&&!!window.Uint8Array};
function yf(a){var b;b="text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a);w("+",a,b?"is":"is not","supported");return b}V.isTypeSupported=yf;V.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+ra(a)+" }",0)};
V.prototype.destroy=function(){return this.s().then(J(this,function(){this.f.destroy();this.a=this.f=null})).catch(function(){})};V.prototype.destroy=V.prototype.destroy;V.prototype.s=function(){if(!this.b)return Promise.resolve();this.h&&If(this);this.a.pause();vb(this.f);Jf(this);Kf(this);this.i&&(this.i.destroy(),this.i=null);this.a.src="";var a=this.a.setMediaKeys(null);this.b&&(this.b.destroy(),this.b=null);this.h=!1;this.g=new jf;return a};V.prototype.unload=V.prototype.s;
V.prototype.U=function(a){var b=this.s();q(null==this.b);q(null==this.i);this.a.autoplay&&(fa("load"),G(this.f,this.a,"timeupdate",this.Db.bind(this)));a.ea(this.c);a.tb(this.L);this.L=null;b=b.then(J(this,function(){return a.Z()}));b.catch(J(this,function(b){a.destroy();return Promise.reject(b)}));return b.then(J(this,function(){if(!this.a)return Lf();this.b=a;G(this.f,this.b,"seekrangechanged",this.Nb.bind(this));this.i=new xf(this,this.a,this.b);return this.i.initialize()})).then(J(this,function(){if(!this.a)return Lf();
G(this.f,this.a,"error",this.ac.bind(this));G(this.f,this.a,"playing",this.Lb.bind(this));G(this.f,this.a,"pause",this.Kb.bind(this));return this.b.ab(this,this.a)})).then(J(this,function(){if(!this.a)return Lf();Mf(this)})).catch(J(this,function(a){if(!this.a)return Lf();if("destroy"!=a.type){var b=D(a);this.dispatchEvent(b)}return this.s().then(function(){return Promise.reject(a)})}))};V.prototype.load=V.prototype.U;
function Lf(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}h=V.prototype;h.Db=function(){ia("load");this.g.playbackLatency=ja("load")/1E3;this.f.ya(this.a,"timeupdate")};h.ac=function(a){if(this.a.error){var b=this.a.error.code;b!=MediaError.MEDIA_ERR_ABORTED&&(x("onError_",a,b),a=Error(Nf[b]||"Unknown playback error."),a.type="playback",a=D(a),this.dispatchEvent(a))}else x("Uninterpretable error event!",a)};
h.Lb=function(a){x("onPlaying_",a);fa("playing");!this.j&&0>this.l&&(this.a.playbackRate=0,this.C(this.a.currentTime,Date.now(),this.l));this.h&&If(this)};h.Kb=function(a){x("onPause_",a);ia("playing");a=ja("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3}Kf(this)};h.Nb=function(a){this.I=a.start};
h.ub=function(){if(!this.a.paused){ia("playing");var a=ja("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3;fa("playing")}}a=this.g;b=this.a;b.getVideoPlaybackQuality&&(b=b.getVideoPlaybackQuality(),a.decodedFrames=b.totalVideoFrames,a.droppedFrames=b.droppedVideoFrames);return this.g};V.prototype.getStats=V.prototype.ub;V.prototype.T=function(){return this.b?this.b.sa():[]};V.prototype.getVideoTracks=V.prototype.T;V.prototype.ca=function(){return this.b?this.b.va():[]};
V.prototype.getAudioTracks=V.prototype.ca;V.prototype.ea=function(){return this.b?this.b.Ua():[]};V.prototype.getTextTracks=V.prototype.ea;V.prototype.selectVideoTrack=function(a,b){return this.b?this.b.selectVideoTrack(a,void 0==b?!0:b):!1};V.prototype.selectVideoTrack=V.prototype.selectVideoTrack;V.prototype.fa=function(a,b){return this.b?this.b.rb(a,void 0==b?!0:b):!1};V.prototype.selectAudioTrack=V.prototype.fa;V.prototype.ga=function(a){return this.b?this.b.sb(a,!1):!1};
V.prototype.selectTextTrack=V.prototype.ga;V.prototype.ba=function(a){this.b&&this.b.Ta(a)};V.prototype.enableTextTrack=V.prototype.ba;V.prototype.S=function(a){Kf(this);0<=a?this.a.playbackRate=a:this.a.paused||(this.a.playbackRate=0,this.C(this.a.currentTime,Date.now(),a));this.l=a};V.prototype.setPlaybackRate=V.prototype.S;V.prototype.P=function(){return this.l};V.prototype.getPlaybackRate=V.prototype.P;V.prototype.la=function(a){this.L=a};V.prototype.setPlaybackStartTime=V.prototype.la;
V.prototype.M=function(){return this.b?this.b.qb():!1};V.prototype.isLive=V.prototype.M;
V.prototype.W=function(a){if(a){var b=ob(a,"enableAdaptation","boolean");null!=b&&(this.c.enableAdaptation=b);b=nb(a,"streamBufferSize");null!=b&&(this.c.streamBufferSize=b);b=nb(a,"liveStreamEndTimeout");null!=b&&(this.c.liveStreamEndTimeout=b);b=nb(a,"licenseRequestTimeout");null!=b&&(this.c.licenseRequestTimeout=b);b=nb(a,"mpdRequestTimeout");null!=b&&(this.c.mpdRequestTimeout=b);b=nb(a,"segmentRequestTimeout");null!=b&&(this.c.segmentRequestTimeout=b);b=pb(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=
b);a=qb(a,"restrictions",la);null!=a&&(this.c.restrictions=a.clone());this.b&&this.b.ea(this.c)}};V.prototype.configure=V.prototype.W;V.prototype.da=function(){return this.c};V.prototype.getConfiguration=V.prototype.da;function Kf(a){a.j&&(window.clearTimeout(a.j),a.j=null)}function Mf(a){Jf(a);a.w=window.setTimeout(a.R.bind(a),100)}function Jf(a){a.w&&(window.clearTimeout(a.w),a.w=null)}
V.prototype.C=function(a,b,c){q(0>c);q(!this.a.paused);this.j=null;var d=(Date.now()-b)/1E3*c;this.a.currentTime<this.I+(this.M()?1:.05)?this.a.pause():(d=Math.max(this.I,a+d),this.a.currentTime=d,this.j=window.setTimeout(this.C.bind(this,a,b,c),250))};function If(a){q(a.h);x("Buffering complete.");ia("buffering");var b=a.g;b.bufferingTime+=ja("buffering")/1E3;a.h=!1;a.dispatchEvent(C({type:"bufferingEnd"}))}
V.prototype.R=function(){Mf(this);if(!this.a.ended&&!this.a.seeking){var a=this.a.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.a.currentTime,0),c=this.a.duration,c=isNaN(c)?0:Math.max(c-.05,0),b=b>=c||this.a.currentTime>=c;if(this.h){if(c=this.b.gb(),b||a>c)If(this),this.a.play()}else!this.a.paused&&!b&&.5>a&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(Na()/1E3),fa("buffering"),x("Buffering..."),this.dispatchEvent(C({type:"bufferingStart"})))}};
var Nf={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function Pf(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=0;g<f.v.length;++g){var k=f.v[g];yf(Ee(k))||(v("Stream uses an unsupported MIME type.",k),f.v.splice(g,1),--g)}0==e.v.length&&(c.a.splice(d,1),--d)}}function Qf(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d)c.a[d].v.sort(Rf)}function Rf(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function Sf(a){this.a=a}Sf.prototype.destroy=function(){this.a.destroy();this.a=null};Sf.prototype.update=function(a){var b=Tf(a),c=Tf(this.a);return Promise.all([b,c]).then(J(this,function(b){var c=b[0];b=b[1];var f=this.a.a;Pf(f);Qf(f);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;f=[];Uf(a,this.a,c,b,f);c=a.a;Pf(c);Qf(c);return Promise.resolve(f)}))};
function Tf(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.v}).reduce(b,[]);a=c.map(function(a){return a.O.create()});return Promise.all(a).then(function(a){q(c.length==a.length);for(var b={},f=0;f<c.length;++f)b[c[f].G]=a[f];return Promise.resolve(b)})}
function Uf(a,b,c,d,e){var f=new E;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new E;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=tb(f);for(b=0;b<a.length;++b){var k=a[b],l=f.get(k);q(l&&0!=l.length);if(1<l.length)v("Cannot update Period "+k+" because more than one existing Period has the same ID.");else{var n=g.get(k);n&&0!=n.length&&(1==n.length?(Vf(l[0],n[0],c,d,e),l[0].b=n[0].b):v("Cannot update Period "+k+" because more than one new Period has the same ID."))}}}
function Vf(a,b,c,d,e){var f=new E;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new E;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=tb(f);for(b=0;b<a.length;++b){var k=a[b],l=f.get(k);q(l&&0!=l.length);if(1<l.length)v("Cannot update StreamSet "+k+" because more than one existing StreamSet has the same ID.");else{var n=g.get(k);n&&0!=n.length&&(1==n.length?Wf(l[0],n[0],c,d,e):v("Cannot update StreamSet "+k+" because more than one new StreamSet has the same ID."))}}}
function Wf(a,b,c,d,e){var f=new E;a.v.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new E;b.v.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var k=tb(f),l=0;l<k.length;++l){var n=k[l];b[n]=n;var r=f.get(n);q(r&&0!=r.length);if(1<r.length)v("Cannot update Stream "+n+" because more than one existing Stream has the same ID.");else{var u=g.get(n);u&&0!=u.length?1==u.length?(Xf(r[0],u[0],c,d),r[0].N=u[0].N,u[0].N=null,r[0].f=u[0].f):v("Cannot update Stream "+n+" because more than one new Stream has the same ID."):
(e.push(r[0]),a.v.splice(a.v.indexOf(r[0]),1))}}k=tb(g);for(l=0;l<k.length;++l)n=k[l],b[n]||(b[n]=n,u=g.get(n),q(u&&0!=u.length),1<u.length&&v("Cannot add Stream "+n+" because more than one new Stream has the same ID."),a.v.push(u[0]),w("Added Stream "+n+"."))}function Xf(a,b,c,d){c=c[a.G];q(c);d=d[b.G];q(d);var e=c.length();c.Na(d)?w("Updated SegmentIndex",a.G+":",e,"->",c.length(),"SegmentReference(s)."):v("Failed to update SegmentIndex",b.G)};function W(){this.a=this.b=null;this.f=new ub;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}m("shaka.media.SimpleAbrManager",W);W.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};W.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
W.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,G(this.f,this.b,"bandwidth",this.l.bind(this)),G(this.f,this.a,"adaptation",this.j.bind(this)),G(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};W.prototype.enable=function(a){this.i=a};W.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=Yf(this);return a?a.id:null};W.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};
W.prototype.l=function(){Date.now()<this.c||this.h()};W.prototype.h=function(){if(this.i){var a=Yf(this);if(a){if(a.active){this.c=Date.now()+3E3;return}w("Video adaptation:",a);this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};W.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function Yf(a){var b=a.a.sa();if(0==b.length)return null;b.sort(va);var c;a:{c=a.a.va();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth){var k=(f.bandwidth+c)/.95,g=(g.bandwidth+c)/.85;da("Bandwidth ranges:",((f.bandwidth+c)/1E6).toFixed(3),(k/1E6).toFixed(3),(g/1E6).toFixed(3));if(a>=k&&a<=g&&(d=f,d.active))break}}return d}
;function Zf(a,b,c){H.call(this,null);this.f=a;this.c=b;this.b=lc(c);this.a=null}p(Zf,H);m("shaka.player.HttpVideoSource",Zf);Zf.prototype.ea=function(){};Zf.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null);this.K=this.b=null};h=Zf.prototype;h.ab=function(a,b){this.K=a;var c=b.mediaKeys;b.src=this.f;c=b.setMediaKeys(c);this.c&&(this.a=document.createElement("track"),this.a.src=this.c,b.appendChild(this.a),this.a.track.mode="showing");return c};h.Z=function(){return Promise.resolve()};
h.sa=function(){return[]};h.va=function(){return[]};h.Ua=function(){return[]};h.gb=function(){return 5};h.hb=function(){var a=new Ie;a.a=this.b;return[a]};h.Ra=function(){};Zf.prototype.selectVideoTrack=function(){return!1};h=Zf.prototype;h.rb=function(){return!1};h.sb=function(){return!1};h.Ta=function(a){this.a&&(this.a.track.mode=a?"showing":"disabled")};h.tb=function(){};h.Da=function(){return[]};h.na=function(){return!1};h.qb=function(){return!1};
h.kb=function(a){for(var b in a){var c=a[b],d=db(c);if(d){var e=zb(b),d=Error("Key "+e+" is not usable. "+d);d.type="drm";d.code=c;c=D(d);this.dispatchEvent(c)}}};function X(a,b,c){H.call(this,null);this.a=a;this.fa=b;this.h=new ub;this.g=new MediaSource;this.f=null;this.ca=0;this.b=new E;this.W=c;this.W.initialize(b,this);this.M=!1;this.ba="en";this.za=!1;this.s=null;this.P=new I;this.i=new la;this.j=null;this.Xa=1;this.c={};this.la=new I;this.Za=this.R=0;this.$a=15;this.L=null;this.Ya=!1;this.I={};this.ga=this.da=this.w=null;this.S={}}p(X,H);m("shaka.player.StreamVideoSource",X);
X.prototype.ea=function(a){null!=a.streamBufferSize&&(this.S.streamBufferSize=a.streamBufferSize);null!=a.segmentRequestTimeout&&(this.S.segmentRequestTimeout=a.segmentRequestTimeout);$f(this);null!=a.enableAdaptation&&this.W.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.ca=Number(a.mpdRequestTimeout));null!=a.liveStreamEndTimeout&&(this.$a=Number(a.liveStreamEndTimeout));null!=a.preferredLanguage&&(this.ba=ib(String(a.preferredLanguage)));null!=a.restrictions&&(this.i=a.restrictions,
this.M&&ag(this))};X.prototype.destroy=function(){this.P.destroy();this.la.destroy();this.la=this.P=null;this.da&&(window.clearTimeout(this.da),this.da=null);this.w&&(window.clearTimeout(this.w),this.w=null);this.I=null;this.h.destroy();this.h=null;mb(this.c).forEach(function(a){a.destroy()});this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.W.destroy();this.K=this.i=this.s=this.f=this.g=this.fa=this.W=null};h=X.prototype;
h.ab=function(a,b){if(!this.M){var c=Error("Cannot call attach() right now.");c.type="app";return Promise.reject(c)}this.K=a;this.f=b;this.s=a.ub();G(this.h,this.g,"sourceopen",this.Gb.bind(this));G(this.h,this.fa,"bandwidth",this.bc.bind(this));this.a.b&&(G(this.h,a,"bufferingStart",this.Cb.bind(this)),G(this.h,a,"bufferingEnd",this.Bb.bind(this)));c=this.f.mediaKeys;this.f.src=window.URL.createObjectURL(this.g);c=this.f.setMediaKeys(c);return Promise.all([this.P,c])};
h.Z=function(){if(this.M){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);a=this.a.a;Pf(a);Qf(a);if(0==this.a.a.length||0==this.a.a[0].a.length)return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.M=!0;this.S.initialStreamBufferSize=this.a.c;$f(this);ag(this);
return Promise.resolve()};
h.mb=function(a){q(this.M);q(null!=this.a.f);q(null!=this.a.g);w("Updating manifest...");var b=Date.now(),c=this.w=null,d=this.a.g;(a?this.lb():this.Oa(d)).then(J(this,function(a){c=new Sf(a);return c.update(this.a)})).then(J(this,function(a){w("Manifest updated!");c.destroy();c=null;for(var d=0;d<a.length;++d)bg(this,a[d]);this.S.initialStreamBufferSize=this.a.c;$f(this);ag(this);0==Object.keys(this.c).length?cg(this):dg(this,(Date.now()-b)/1E3)})).catch(J(this,function(a){c&&(c.destroy(),c=null);
"aborted"!=a.type&&(a=D(a),this.dispatchEvent(a),this.a&&dg(this,0))}))};h.Oa=function(){ba();return Promise.reject("Cannot update manifest with this VideoSource implementation.")};h.lb=function(){ba();return Promise.reject("Cannot update manifest with this VideoSource implementation.")};function dg(a,b){if(null!=a.a.f){q(null==a.w);var c=Math.max(a.a.f,3),c=Math.max(c-b,0);x("updateInterval",c);a.w=window.setTimeout(a.mb.bind(a,!1),1E3*c)}}
function bg(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.ua()==b){var e=a.b.get(b.a.split("/")[0]),f=e.map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return De(a)});if(0==f.length){v("The stream",b.id,"was removed but an alternate stream does not exist.");e.push(b);return}a.I[c].Va==b&&delete a.I[c];d.xa(f[0],!0);b.destroy()}w("Removed stream",b.id);b.destroy()}
h.sa=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.ua():null)?a.G:0,b=[],c=this.b.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.v.length;++f){var g=e.v[f];if(De(g)){var k=g.G,g=new ua(k,g.bandwidth,g.width,g.height);k==a&&(g.active=!0);b.push(g)}}return b};X.prototype.getVideoTracks=X.prototype.sa;
X.prototype.va=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.ua():null)?a.G:0,b=[],c=this.b.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.v.length;++g){var k=e.v[g];if(De(k)){var l=k.G,k=new ka(l,k.bandwidth,f);l==a&&(k.active=!0);b.push(k)}}return b};X.prototype.getAudioTracks=X.prototype.va;
X.prototype.Ua=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.ua():null,b=b?b.G:0,c=[],d=this.b.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,k=0;k<f.v.length;++k){var l=f.v[k].G,n=new ta(l,g);l==b&&(n.active=!0,q(null!=a),n.enabled=a.Ja());c.push(n)}return c};X.prototype.getTextTracks=X.prototype.Ua;X.prototype.gb=function(){return Number(this.S.initialStreamBufferSize)};
X.prototype.hb=function(){var a;if(this.M){a=this.a.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,He(a.a[c]));a=b}else a=[];return a};
X.prototype.Ra=function(a){if(this.M){for(var b={},c=this.a.a[0],d=0;d<c.a.length;++d){var e=c.a[d];b[e.G]=e}this.b.a={};c=tb(a);for(d=0;d<c.length;++d){var e=c[d],f=a.get(e);if("video"==e){var g=f[0].id;this.b.push(e,b[g])}else if("audio"==e)for(var g=f[0].b.split(";")[0],k=0;k<f.length;++k){var l=f[k];l.b.split(";")[0]==g&&this.b.push(e,b[l.id])}else for(k=0;k<f.length;++k)g=f[k].id,this.b.push(e,b[g])}this.za=!0;if(a=this.b.get("audio"))eg(this,a),this.b.set("audio",a),a=a[0].lang||this.ba,hb(2,
this.ba,a)&&(this.za=!1);if(a=this.b.get("text"))eg(this,a),this.b.set("text",a),a=a[0].lang||this.ba,hb(2,this.ba,a)||(this.za=!1)}else v("Cannot call selectConfigurations() right now.")};X.prototype.selectVideoTrack=function(a,b,c){return fg(this,"video",a,b,c)};h=X.prototype;h.rb=function(a,b){return fg(this,"audio",a,b)};h.sb=function(a,b){return fg(this,"text",a,b)};h.Ta=function(a){var b=this.c.text;b&&b.Ea(a)};h.tb=function(a){this.ga=a};
function ag(a){q(a.a);q(a.M);if(a.i){for(var b=!1,c=0;c<a.a.a.length;++c)for(var d=a.a.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.v.length;++g){var k=f.v[g],l=k.b;k.b=!0;a.i.maxWidth&&k.width>a.i.maxWidth&&(k.b=!1);a.i.maxHeight&&k.height>a.i.maxHeight&&(k.b=!1);a.i.maxBandwidth&&k.bandwidth>a.i.maxBandwidth&&(k.b=!1);a.i.minBandwidth&&k.bandwidth<a.i.minBandwidth&&(k.b=!1);l!=k.b&&(w(k.b?"Permitting":"Restricting","stream",k.id+".","The application has applied new video track restrictions."),
b=!0)}}0!=rb(a.b).length&&b&&(gg(a),q(a.b.a.hasOwnProperty("video")),0<a.sa().length||(b=Error("The application has restricted all video tracks!"),b.type="app",b=D(b),a.dispatchEvent(b)))}}h.Da=function(){return[]};h.na=function(){return!1};h.qb=function(){return this.a?this.a.b:!1};
h.kb=function(a){for(var b in a){var c=zb(b);x("Key status:",c+": "+a[b])}for(var d=!1,e=new E,f=rb(this.b),c=0;c<f.length;++c)for(var g=f[c],k=0;k<g.v.length;++k){var l=g.v[k];l.g.forEach(function(a){e.push(a,l)})}for(b in a)if(f=db(a[b]),g=e.get(b))for(c=0;c<g.length;++c)l=g[c],k=l.$,l.$=!f,k!=l.$&&(w(l.$?"Permitting":"Restricting","stream",l.id+".",f||""),d=!0);else c=zb(b),x("Key",c,"was not specified in the manifest."),f&&v("Key",c,"is not usable.",f);d&&(gg(this),b=this.va(),a=this.sa(),b=this.b.a.hasOwnProperty("audio")&&
0==b.length,a=this.b.a.hasOwnProperty("video")&&0==a.length,b||a)&&(a=Error("The key system has restricted all "+(b&&a?"audio and video tracks.":b?"audio tracks.":"video tracks.")),a.type="drm",a=D(a),this.dispatchEvent(a))};function gg(a){var b=C({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}
function fg(a,b,c,d,e){if(!a.b.a.hasOwnProperty(b))return v("Cannot select",b,"track",c,"because there are no",b,"tracks."),!1;if(!a.c[b])return v("Cannot select",b,"track",c,"because there are no",b,"streams yet."),!1;for(var f=a.b.get(b),g=0;g<f.length;++g)for(var k=f[g],l=0;l<k.v.length;++l){var n=k.v[l];if(n.G==c){if(!n.$)return v("Cannot select",b,"track",c,"because the track is not allowed by the key system."),!1;if(!n.b)return v("Cannot select",b,"track",c,"because the track is not allowed by the application."),
!1;if("text"!=b&&!a.Ya)return c=a.I[b],a.I[b]={Va:n,bb:null!=c&&c.bb||d,cb:null!=c&&c.cb||e},!0;q(a.s);kf(a.s,n);a.c[b].xa(n,d,e);return!0}}v("Cannot select",b,"track",c,"because it does not exist.");return!1}function eg(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(hb(c,a.ba,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.b){b.splice(d,1);b.splice(0,0,e);break}}
h.Gb=function(){this.h.ya(this.g,"sourceopen");cg(this).then(J(this,function(){this.P&&this.P.resolve()})).catch(J(this,function(a){this.P&&this.P.reject(a)}))};
function cg(a){for(var b=[],c=["audio","video","text"],d=0;d<c.length;++d){var e=c[d];a.b.a.hasOwnProperty(e)&&b.push(a.b.get(e)[0])}for(var f=hg(a,b),d=0;d<c.length;++d)if(e=c[d],a.b.a.hasOwnProperty(e)&&!f[e])return a=Error("Unable to select an initial "+e+" stream: all "+e+" streams have been restricted (by the application or by the key system)."),a.type="stream",Promise.reject(a);b=mb(f).map(function(a){return a.O.create()});return Promise.all(b).then(J(a,function(a){if(!a.every(function(a){return a.length()}))return x("At least one SegmentIndex is empty."),
a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=ig(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!jg(this,f))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.W.start();kg(this,f,a);return Promise.resolve()})).catch(J(a,function(a){if("aborted"!=a.type)return q(0==Object.keys(this.c).length),this.a.b?(v(a.message),Na()<this.a.h?(q(!this.w),q(this.a.b),q(this.a.h),a=Math.max(this.a.h-
Date.now()/1E3,3),x("updateLocalInterval",a),this.w=window.setTimeout(this.mb.bind(this,!0),1E3*a)):dg(this,0),Promise.resolve()):Promise.reject(a)}))}
function hg(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.W.getInitialVideoTrackId();if(null==g){x("No initial video streams to select.");continue}f=e.v.filter(function(a){return a.G==g});if(0==f.length){x("No initial video streams to select from the selected StreamSetInfo.");continue}q(1==f.length);q(De(f[0]));f=f[0]}else if("audio"==e.contentType){f=e.v.filter(function(a){return De(a)});if(0==f.length){x("No initial audio streams to select.");continue}f=
e.v[Math.floor(f.length/2)]}else 0<e.v.length&&(f=e.v[0]);q(f);c[e.contentType]=f}return c}function jg(a,b){var c={},d;for(d in b){var e=b[d],f="text"==d?lg(a):mg(a,e);if(!f)return t("Failed to create",Ee(e),"stream."),mb(c).forEach(function(a){a.destroy()}),!1;c[d]=f}a.c=c;return!0}function mg(a,b){q(a.f);var c=new Le(a,a.f,a.g,Ee(b),a.fa);c.P(a.S);return c}function lg(a){q(a.f);return new Ue(a,a.f)}
function kg(a,b,c){a.Xa=a.f.playbackRate;a.f.playbackRate=0;ng(a,c);var d;a.a.b?(q(c.end!=Number.POSITIVE_INFINITY),d=c.end):d=a.ga&&a.ga<=c.end&&a.ga>=c.start?a.ga:c.start;w("Starting each stream from",d);G(a.h,a.f,"seeking",a.Ob.bind(a));a.f.currentTime!=d&&(a.f.currentTime=d,a.j=d,x("Ignoring pending seek to",a.j));og(a,c.start,c.end);c=[];for(var e in a.c){d=a.c[e];c.push(d.wb(a.la));G(a.h,d,"ended",a.Qb.bind(a));var f=b[e];kf(a.s,f);d.xa(f,!1)}Promise.all(c).then(a.Ab.bind(a)).catch(J(a,function(a){q("aborted"!=
a.type);"destroy"!=a.type&&(t("Stream startup failed!"),a=D(a),this.dispatchEvent(a))}));a.Ta(a.za)}
h.Ab=function(a){w("All Streams have completed startup!");q(a&&a.length==Object.keys(this.c).length,"There should be a timestamp correction for each Stream.");for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);w("Timestamp correction",c);0>b*c&&v("Some streams' media timestamps are ahead of their SegmentIndexes,","while other streams' timestamps are behind.","The content may have errors in it.");a=pg(this);for(d=0;d<a.length;++d)a[d].qa(c);
qg(this,a,c);d=rb(this.b).map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){var b=[a.O.create()];a.N&&b.push(a.N.create());return Promise.all(b)});Promise.all(d).then(J(this,function(a){for(var b=0;b<a.length;++b)a[b][0].qa(c);x("Created/fetched all SegmentIndexes and initialization segments!");this.Ya=!0;for(var d in this.I)a=this.I[d],b=this.c[d],q(b),q(this.s),kf(this.s,a.Va),b.xa(a.Va,a.bb,a.cb);this.I={}})).catch(J(this,function(a){"aborted"!=a.type&&(a=
D(a),this.dispatchEvent(a))}))};
function qg(a,b,c){x("beginPlayback_");b=ig(a,b);q(b,"Stream limits should not be null.");b&&(ng(a,b),og(a,b.start,b.end));0!=c?(x("Adjusting video.currentTime by",c,"seconds."),c=a.f.currentTime+c,a.f.currentTime=c,a.j=c,x("Ignoring pending seek to",a.j)):c=a.f.currentTime;q(null!=c);if(b){var d=1E-5;a.a.b&&c<b.start-d&&x("correctedCurrentTime ("+c+")","is outside of the stream limits before beginning playback!");(!a.a.b&&c<b.start-d||c>b.end+d)&&t("correctedCurrentTime ("+c+")","should be within the stream limits",
[b.start,b.end])}a.a.b&&b&&(a.R=b.end-c,q(-1E-5<=a.R,"liveEdgeOffset_ should not be less than zero."),a.R=Math.max(a.R,0),x("Live-edge offset",a.R));a.f.playbackRate=a.Xa;a.a.b&&null!=a.a.f&&(q(null==a.w),dg(a,a.R));rg(a);a.la.resolve()}
function ng(a,b){q("open"==a.g.readyState,"The MediaSource should be in the 'open' state.");if(a.a.b)isNaN(a.g.duration)&&(a.g.duration=b.end+2592E3);else if(isNaN(a.g.duration)||b.end>a.g.duration){x("Setting MediaSource duration to",b.end);a.g.duration=b.end;for(var c=0;c<a.g.sourceBuffers.length;++c)a.g.sourceBuffers[c].appendWindowEnd=b.end}}
h.Sb=function(){this.da=null;rg(this);var a=ig(this,pg(this));q(a,"Stream limits should not be null.");if(a&&(this.a.b&&this.Za!=a.F&&(this.Za=a.F,null!=this.L&&(x("Not the end of the live stream."),window.clearTimeout(this.L),this.L=null)),og(this,a.start,a.end),!this.f.paused)){var b=this.f.currentTime,c=a.start,a=a.end;sg(this,b,c,a)&&v("Playhead is outside of the seekable range:","seekable",[c,a],"attempted",b,"Adjusting...")}};
function og(a,b,c){var d=C({type:"seekrangechanged",bubbles:!0,start:b,end:c});y("Seek range",[b,c],c-b);a.dispatchEvent(d)}
h.Ob=function(a){y("onSeeking_",a);a=this.f.currentTime;if(null!=this.j){if(a>=this.j-.01&&a<=this.j+.01){x("Ignored seek to",this.j);this.j=null;return}this.j=null}var b=ig(this,pg(this));q(b,"Stream limits should not be null.");if(b){var c=b.start,b=b.end,d;(d=sg(this,a,c,b))||(a<=b+.01?d=!1:(this.f.currentTime=b,d=!0));if(d)v("Playhead has been moved outside of the seekable range:","seekable",[c,b],"attempted",a,"Adjusting...");else for(var e in this.c)this.c[e].ob()}};
function sg(a,b,c,d){if(b>=c-.01)return!1;b=0;if(a.a.b){b=.5;for(var e in a.c)if(!a.c[e].pb(c+b)){b=a.a.c;break}}a.f.currentTime=Math.min(c+b,d);return!0}h.Qb=function(){if(!this.a.b){for(var a in this.c)if(!this.c[a].Ma())return;this.fb()}};h.Cb=function(){q(this.a.b);mb(this.c).every(function(a){return a.Ma()})&&(w("Possible end of live stream."),this.L=window.setTimeout(this.fb.bind(this),1E3*this.$a))};
h.Bb=function(){q(this.a.b);null!=this.L&&(x("Not the end of the live stream."),window.clearTimeout(this.L),this.L=null)};h.bc=function(){q(this.s);var a=this.s,b=this.fa.getBandwidth();a.estimatedBandwidth=b;a.bandwidthHistory.push(new mf(b))};
h.fb=function(){q("open"==this.g.readyState,"The MediaSource should be in the 'open' state.");var a=this.g.duration,b;w("Signalling end-of-stream.");this.L=null;this.g.endOfStream();b=this.g.duration;b!=a&&v("endOfStream() should not modify the MediaSource's duration:","before",a,"after",b,"delta",b-a);a=!1;for(b=0;b<this.g.sourceBuffers.length;++b)a=this.g.sourceBuffers[b].updating;q(!a,"endOfStream() should not trigger the duration change algorithm.")};
function pg(a){return mb(a.c).map(function(a){return a.ib()}).filter(function(a){return null!=a})}
function ig(a,b){q(a.a);for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].Ka(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].F().a))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.a[0],d.b)d=(d.start||0)+d.b;else return x("Failed to compute a stream end time."),null;a.a.b&&(d=Math.max(d-(a.a.c+a.R),c));return c>d?(x("The streams' media timelines do not intersect."),null):{start:c,end:d,F:e}}
function rg(a){a.a.b&&(q(null==a.da),a.da=window.setTimeout(a.Sb.bind(a),1E3))}function $f(a){for(var b in a.c)a.c[b].P(a.S)};function Y(a,b,c,d){c||(c=new yb);d||(d=new W);X.call(this,null,c,d);this.Ba=a;this.U=null;this.C=b;this.T=[];this.ha=[];this.ta=[];this.l=null}p(Y,X);m("shaka.player.DashVideoSource",Y);Y.prototype.xb=function(a,b,c){this.T.push(a);this.ha.push(b||"");this.ta.push(c||"")};Y.prototype.addExternalCaptions=Y.prototype.xb;Y.prototype.yb=function(a){this.l=a};Y.prototype.setNetworkCallback=Y.prototype.yb;Y.prototype.destroy=function(){this.U=this.l=this.C=null;X.prototype.destroy.call(this)};
Y.prototype.Z=function(){var a=new L(this.l,[new M(this.Ba)]);return(new Wd(a,this.ca)).b().then(J(this,function(a){this.U=a;for(var c=0;c<this.T.length;c++)Gd(a,this.T[c],this.ha[c],this.ta[c]);this.a=Ye(new Xe(this.C),a,this.l);return X.prototype.Z.call(this)}))};Y.prototype.Oa=function(a){return(new Wd(a,this.ca)).b().then(J(this,function(a){this.U=a;a=Ye(new Xe(this.C),a,this.l);return Promise.resolve(a)}))};Y.prototype.lb=function(){q(this.U);var a=Ye(new Xe(this.C),this.U,this.l);return Promise.resolve(a)};function Z(a,b,c){b||(b=new yb);c||(c=new W);X.call(this,null,b,c);this.T=a;this.U=[];this.timeoutMs=3E4;this.C={};this.l=this.ha=null}p(Z,X);m("shaka.player.OfflineVideoSource",Z);Z.prototype.ea=function(a){null!=a.licenseRequestTimeout&&(this.C.licenseRequestTimeout=a.licenseRequestTimeout);null!=a.segmentRequestTimeout&&(this.C.segmentRequestTimeout=a.segmentRequestTimeout);X.prototype.ea.call(this,a)};
m("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var a=new Nb,b=Fb(a).then(function(){return Ob(a)});b.then(function(){Hb(a)}).catch(function(){Hb(a)});return b});
Z.prototype.Ca=function(a,b,c,d){var e,f=null,g={},k=[];a=new L(this.ha,[new M(a)]);return(new Wd(a,this.ca)).b().then(J(this,function(a){this.a=Ye(new Xe(c),a,this.ha);if(this.a.b)return a=Error("Unable to store live streams offline."),a.type="app",Promise.reject(a);this.ea({preferredLanguage:b});return X.prototype.Z.call(this)})).then(J(this,function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.g);e=new xf(null,a,this);null!=this.C.licenseRequestTimeout&&Hf(e,Number(this.C.licenseRequestTimeout));
G(this.h,e,"sessionReady",this.ta.bind(this));G(this.h,e,"error",function(a){f=a});return e.initialize()})).then(J(this,function(){for(var a=rb(this.b),b=0;b<a.length;++b)for(var c=a[b],e=0;e<c.v.length;++e){var f=c.v[e];g[f.G]=f}return d()})).then(J(this,function(a){for(var b=0;b<a.length;++b){var c=a[b],d=g[c];if(d)k.push(d);else return Promise.reject(Error("Invalid stream ID chosen: "+c))}var e=["audio","video"];k=k.filter(function(a){return 0>e.indexOf(a.a.split("/")[0])?(v("Ignoring track ID "+
a.G+" due to unsupported type: "+a.a.split("/")[0]),!1):!0});a=k.map(function(a){return a.N.create()});return Promise.all(a)})).then(J(this,function(a){var b=k;q(b.length==a.length);for(var c=[],d=0;d<b.length;++d)try{c[d]=this.g.addSourceBuffer(Ee(b[d]))}catch(e){t("addSourceBuffer() failed",e)}if(b.length!=c.length)a=Error("Error initializing streams."),a.type="storage",a=Promise.reject(a);else{for(d=0;d<a.length;++d)(b=a[d])&&c[d].appendBuffer(b);a=Promise.resolve()}return a})).then(J(this,function(){return Af(e,
this.timeoutMs)})).then(J(this,function(){if(f)return Promise.reject(f);var a=e.a,b=this.a.a[0].b;b||v("The duration of the stream being stored is null.");q(b!=Number.POSITIVE_INFINITY);return tg(this,k,a,b)})).then(J(this,function(a){this.T=a;return f?(ug(this),Promise.reject(f)):Promise.resolve(a)}))};m("shaka.player.OfflineVideoSource.prototype.store",Z.prototype.Ca);Z.prototype.Ba=function(a){this.ha=a};Z.prototype.setNetworkCallback=Z.prototype.Ba;Z.prototype.ta=function(a){this.U.push(a.detail.sessionId)};
function tg(a,b,c,d){var e=new nf(a.fa,a);null!=a.C.segmentRequestTimeout&&of(e,Number(a.C.segmentRequestTimeout));return Fb(e).then(J(a,function(){return pf(e,b,this.U,d,c)})).then(function(a){Hb(e);return Promise.resolve(a)}).catch(function(a){Hb(e);return Promise.reject(a)})}
Z.prototype.Z=function(){q(0<=this.T);var a=new Nb,b,c;return Fb(a).then(J(this,function(){return Pb(a,this.T)})).then(J(this,function(d){var e=[];this.U=d.session_ids;b=d.duration;c={keySystem:d.key_system,distinctiveIdentifierRequired:d.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:d.audio_robustness,videoRobustness:d.video_robustness,withCredentials:d.with_credentials,licenseServerUrl:d.license_server};for(var f=0;f<d.stream_ids.length;++f)e.push(Qb(a,d.stream_ids[f]));return Promise.all(e)})).then(J(this,
function(a){var e=b,f=c,g=new Ke;g.c=5;for(var k=new Je,l=0;l<a.length;++l){var n=a[l],r=new re,u=new qe(n.references),F=new be(null,n.init_segment);r.O=u;r.N=F;r.a=n.mime_type;r.c=n.codecs;r.$=!0;this.l&&(null!=this.l.licenseServerUrl&&(f.licenseServerUrl=this.l.licenseServerUrl),null!=this.l.withCredentials&&(f.withCredentials=this.l.withCredentials),f.licensePostProcessor=this.l.licensePostProcessor,f.licensePreProcessor=this.l.licensePreProcessor,f.serverCertificate=this.l.serverCertificate);
n=lc(f);u=new Fe;u.v.push(r);u.a.push(n);u.contentType=r.a.split("/")[0];k.a.push(u);k.b=e}g.a.push(k);this.a=g;return X.prototype.Z.call(this)})).then(function(){Hb(a);return Promise.resolve()}).catch(function(b){Hb(a);return Promise.reject(b)})};
Z.prototype.Aa=function(a,b){q(0<=this.T);a&&(this.l={licenseServerUrl:a.licenseServerUrl,withCredentials:a.withCredentials,serverCertificate:a.serverCertificate,licensePreProcessor:a.licensePreProcessor,licensePostProcessor:a.licensePostProcessor});var c=null;return vg(this).catch(function(a){return b?(c=a,Promise.resolve()):Promise.reject(a)}).then(J(this,function(){return ug(this)})).then(function(){return Promise.resolve(c)})};Z.prototype.deleteGroup=Z.prototype.Aa;Z.prototype.Da=function(){return this.U};
Z.prototype.na=function(){return!0};function ug(a){var b=new nf(null,null);return Fb(b).then(J(a,function(){return sf(b,this.T)})).then(function(){Hb(b);return Promise.resolve()}).catch(function(a){Hb(b);return Promise.reject(a)})}
function vg(a){var b=document.createElement("video");b.src=window.URL.createObjectURL(a.g);var c=new xf(null,b,a);null!=a.C.licenseRequestTimeout&&Hf(c,Number(a.C.licenseRequestTimeout));return a.Z().then(function(){return c.initialize()}).then(J(a,function(){return Af(c,this.timeoutMs)})).then(function(){return Bf(c)}).then(J(a,function(){c.destroy();this.destroy();return Promise.resolve()})).catch(J(a,function(a){c.destroy();this.destroy();return Promise.reject(a)}))};function wg(a,b,c){Wd.call(this,a,b);this.l=new Pc(c);this.c=c||null;this.f=null;this.c&&this.c.a&&(this.f="highest"==this.c.a?this.i:"lowest"==this.c.a?this.j:this.h)}p(wg,Wd);wg.prototype.b=function(){var a=this.g;return Zb(a,this.a).then(function(b){if(b=ed(Qc(this.l,b),a.a))return Promise.resolve(xg(this,b));b=Error("MPD parse failure.");b.type="mpd";return Promise.reject(b)}.bind(this))};
function xg(a,b){"static"===b.type&&b.a&&a.f&&b.a.forEach(function(a){var b=this.f(a);try{0<b&&(w("Found missing presentationTimeOffset from segment start offset, based on the configured "+this.c.a+" policy.",b),a.J.forEach(function(a){a.m.D||(a.m.D=b*(a.m.u||1));a.H&&a.H.forEach(function(a){a.m&&!a.m.D&&(a.m.D=b*(a.m.u||1))})}))}catch(e){v("Attempt of fixing presentationTimeOffset in manifest failed. Trying to continue anyway.",e,a)}}.bind(a));w("MPD",b);return b}
wg.prototype.h=function(a){var b=0;try{a.J.forEach(function(a){var c=a.m;if(c&&!c.D){var f=c.B&&c.B.V&&c.B.V[0];f.startTime&&(c=f.startTime/(c.u||1),"video"===a.contentType&&(b=c))}})}catch(c){return v("Error when searching for start offset snapping to video segment start.",c),0}return b};
wg.prototype.j=function(a){var b=0;try{a.J.forEach(function(a){if((a=a.m)&&!a.D){var c=a.B&&a.B.V&&a.B.V[0];c.startTime&&(a=c.startTime/(a.u||1),b=0===b?a:Math.min(b,a))}})}catch(c){return v("Error when searching for lowest start offset.",c),0}return b};wg.prototype.i=function(a){var b=0;try{a.J.forEach(function(a){if((a=a.m)&&!a.D){var c=a.B&&a.B.V&&a.B.V[0];c.startTime&&(b=Math.max(b,c.startTime/(a.u||1)))}})}catch(c){return v("Error when searching for highest start offset.",c),0}return b};function yg(a,b,c,d,e,f){Y.call(this,a,b,c,d);this.Ca=f||null;this.Aa=e}p(yg,Y);m("shaka.vimond.player.ModifyableDashVideoSource",yg);yg.prototype.Z=function(){var a=new L(this.l,[new M(this.Ba)]);return(new wg(a,this.ca,this.Ca)).b().then(J(this,function(a){for(var c=0;c<this.T.length;c++)Gd(a,this.T[c],this.ha[c],this.ta[c]);this.a=Ye(new Xe(this.C),a,this.l);c=X.prototype.Z.call(this);try{this.Aa&&a.b&&this.Aa(a.b)}catch(d){v("mpdReady callback failed.",d)}return c}))};
yg.prototype.Oa=function(a){return(new wg(a,this.ca,this.Ca)).b().then(J(this,function(a){a=Ye(new Xe(this.C),a,this.l);return Promise.resolve(a)}))};}.bind(g,this))();
this.shaka=g.shaka;
})();
